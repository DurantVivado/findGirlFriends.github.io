

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&quot;auto&quot;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="博主：来自华中科技大学国家光电研究中心的">
  <meta name="author" content="Durant">
  <meta name="keywords" content="">
  <title>「探秘」Jerasure那些事 - Durant Thorvalds 的米奇妙妙屋</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.6.2/gitalk.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Durant Thorvalds 的米奇妙妙屋" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                联系我
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-02-11 00:00" pubdate>
        2021年2月11日 凌晨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.1k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      113
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">「探秘」Jerasure那些事</h1>
            
            <div class="markdown-body" id="post-body">
              <h1 id="libJerasure"><a href="#libJerasure" class="headerlink" title="libJerasure"></a>libJerasure</h1><div class="note note-warning">
            <p>2007 James给出了RS-RAID一个开源实现。<u><a target="_blank" rel="noopener" href="http://jerasure.org/jerasure/jerasure">official</a> ，<a target="_blank" rel="noopener" href="https://github.com/ceph/Jerasure">github</a></u>，目前的版本是2014年发行的2.0版本，是各种纠删码库的开山之作。</p>
          </div>
<p>Jerasure库包括以下5个模块：</p>
<ul>
<li><code>galois.h/.c</code>提供伽罗华域的算术运算。</li>
<li><code>jerasure.h/.c</code>提供了绝大部分的核心函数。包括矩阵的编解码，位矩阵变换，矩阵转置和位矩阵转置。</li>
<li><code>reedsol.h/.c</code>支持RS编解码和优化和的RS码。</li>
<li><code>cauchy.h/.c</code> 支持cauchy RS编解码和最优cauchy编码。</li>
<li><code>cauchy_best_r6.h/.c</code> 基于cauchy矩阵的RAID-6优化。</li>
<li><code>liberation.h/.c</code> 支持Liberartion RAID-6编码, Blaum-Roth 编码，和Liber8tion RAID-6编码。 Liberation是一种低密度MDS。这三种编码采用位矩阵来实现，其性能<strong>远优于</strong>现有的RS和EVENNODD，在某种情况下也优于目前已知的最好的RDP编码。</li>
</ul>
<p>下标汇总了Jerasure-2.0库常见的参数和其含义：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">参数名</th>
<th style="text-align:center">数据类型</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">k</td>
<td style="text-align:center">int</td>
<td style="text-align:left">数据盘个数</td>
</tr>
<tr>
<td style="text-align:center">m</td>
<td style="text-align:center">int</td>
<td style="text-align:left">校验盘个数</td>
</tr>
<tr>
<td style="text-align:center">w</td>
<td style="text-align:center">int</td>
<td style="text-align:left">字长</td>
</tr>
<tr>
<td style="text-align:center">packetsize</td>
<td style="text-align:center">int</td>
<td style="text-align:left">包大小（必须是<code>sizeof(long)</code>的整数倍）</td>
</tr>
<tr>
<td style="text-align:center">size</td>
<td style="text-align:center">int</td>
<td style="text-align:left">每个设备要编码/解码的字节总数。 这必须是<code>sizeof(long)</code>的倍数。 如果使用位矩阵，则它必须是<code>packetssize * w</code>的倍数。 如果希望对不符合这些限制的数据块进行编码，则必须用零填充数据块，以便满足这些限制。</td>
</tr>
<tr>
<td style="text-align:center">matrix</td>
<td style="text-align:center">int  *</td>
<td style="text-align:left">这是一个具有k * m个元素的数组，表示编码矩阵-即分布矩阵的最后m行。 它的元素必须在0到$2^w -1$之间。第i行和第j列中的元素在`matrix [i * k + j]中。</td>
</tr>
<tr>
<td style="text-align:center">bitmatrix</td>
<td style="text-align:center">int *</td>
<td style="text-align:left">这是$w \cdot m \cdot w \cdot k$元素的数组，组成二进制分配矩阵BDM的最后$wm$行。 第i行和第j列中的元素位于<code>bitmatrix [i * k * w + j]</code>中</td>
</tr>
<tr>
<td style="text-align:center">dataptrs</td>
<td style="text-align:center">char **</td>
<td style="text-align:left">这是k个指针数组，指向大小为字节的编码数据。 其中每一个必须是长字对齐的。</td>
</tr>
<tr>
<td style="text-align:center">coding_ptrs</td>
<td style="text-align:center">char **</td>
<td style="text-align:left">这是m个指针数组，指向大小为字节的编码数据。 其中每一个必须是长字对齐的。</td>
</tr>
<tr>
<td style="text-align:center">erasures</td>
<td style="text-align:center">int *</td>
<td style="text-align:left">这是一组ID已删除的设备。 如第4.1节所述，Id是介于0到k + m-1之间的数字。 如果擦除数为$e$，则擦除的元素$0$到$e -1$标识被擦除的设备，并且<code>erasures [e]</code>必须等于-1。</td>
</tr>
<tr>
<td style="text-align:center">erased</td>
<td style="text-align:center">int *</td>
<td style="text-align:left">这是指定擦除的替代方法。 它是一个$k + m$的元素数组。 数组的元素$i$代表ID为$i$的设备。 如果<code>erased[i]</code>等于0，则设备i正在工作;如果等于1，则其被擦除。</td>
</tr>
<tr>
<td style="text-align:center">schdule</td>
<td style="text-align:center">int **</td>
<td style="text-align:left">这是一个5元素整数数组，用于优化位矩阵的编码计算。  如果计划中有o个操作，则计划必须至少包含o + 1个元素，并且<code>schedule [o][0]</code>应当等于-1。</td>
</tr>
<tr>
<td style="text-align:center">cache</td>
<td style="text-align:center">int <em>*</em></td>
<td style="text-align:left">三维数组，用于保存一系列缓存地址，用于对RAID6解码进行优化。</td>
</tr>
<tr>
<td style="text-align:center">row_k_ones</td>
<td style="text-align:center">bool</td>
<td style="text-align:left">布尔类型，用于对满足$m&gt;1$的解码过程进行优化。解码时，如果对应编码矩阵第一行全部为1或者对应的二进制编码矩阵前w行构成k个单位矩阵，则设置此标志位有助于提升解码速度。</td>
</tr>
<tr>
<td style="text-align:center">decoding_matrix</td>
<td style="text-align:center">int *</td>
<td style="text-align:left">这是用于解码的$k×k$矩阵或$wk×wk$位矩阵。 它是通过使用分布矩阵的相关行并将其求逆而构造的矩阵。</td>
</tr>
<tr>
<td style="text-align:center">dm_ids</td>
<td style="text-align:center">int *</td>
<td style="text-align:left">一维数组，用于指定仍然正常的磁盘编号，帮助生成解码矩阵。</td>
</tr>
</tbody>
</table>
</div>
<p>针对RAID-6，Jerasure作了两类优化：</p>
<ul>
<li><p>对乘2运算进行优化</p>
</li>
<li><p>直接对编码矩阵进行改造，得到最小密度RAID6. 这类矩阵很稀疏，计算量较少。目前有三种</p>
<ul>
<li>Liberation: 要求W必须是素数</li>
<li>Blaum-Roth: 要求W+1必须是素数</li>
<li>Lber8tion: 要求W必须等于8</li>
</ul>
<p>这三种编码效率相当。</p>
</li>
</ul>
<blockquote>
<p>在安装jerasure库之前，我们得安装<a target="_blank" rel="noopener" href="https://github.com/ceph/gf-complete">GF-Complete库</a>，注意如果根目录下没有<code>./configure</code>，我们可以先运行<code>./configure.ac</code></p>
<p>关于安装jerasure库的一些步骤和经验可以看<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40611993/article/details/108560346">这篇非常好的博客</a>。</p>
<p>make完成后<code>/usr/local/lib</code>下应该有这些库。</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">libgf_complete</span><span class="hljs-selector-class">.a</span>   <span class="hljs-selector-tag">libgf_complete</span><span class="hljs-selector-class">.so</span><span class="hljs-selector-class">.1</span>      <span class="hljs-selector-tag">libJerasure</span><span class="hljs-selector-class">.so</span>        <span class="hljs-selector-tag">python3</span><span class="hljs-selector-class">.8</span>
<span class="hljs-selector-tag">libgf_complete</span><span class="hljs-selector-class">.la</span>  <span class="hljs-selector-tag">libgf_complete</span><span class="hljs-selector-class">.so</span><span class="hljs-selector-class">.1</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span>  <span class="hljs-selector-tag">libJerasure</span><span class="hljs-selector-class">.so</span><span class="hljs-selector-class">.2</span>
<span class="hljs-selector-tag">libgf_complete</span><span class="hljs-selector-class">.so</span>  <span class="hljs-selector-tag">libJerasure</span><span class="hljs-selector-class">.la</span>           <span class="hljs-selector-tag">libJerasure</span><span class="hljs-selector-class">.so</span><span class="hljs-selector-class">.2</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span></code></pre>
<p>自己写的代码在编译时需指定动态链接库：</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">gcc</span> <span class="hljs-selector-tag">hello</span><span class="hljs-selector-class">.c</span> <span class="hljs-selector-tag">-lJerasure</span> <span class="hljs-selector-tag">-lgf_complete</span> <span class="hljs-selector-tag">-o</span> <span class="hljs-selector-tag">hello</span></code></pre>
<p>库默认安装在<code>/usr/local/lib</code>，否则你需要用<code>-L &#123;path&#125;</code>指定库文件目录。</p>
</blockquote>
<hr>
<h2 id="S1-1-Galois域算术运算"><a href="#S1-1-Galois域算术运算" class="headerlink" title="$\S1.1 $ Galois域算术运算"></a>$\S1.1 $ Galois域算术运算</h2><p>库：<code>galois.h\galois.c</code></p>
<ul>
<li><p><code>galois_single_multiply(int a, int b, int w)</code> 以及<code>galois_single_divide(int a ,int b, int w)</code></p>
<p>在$GF(2^w)$上执行单元素的乘法和除法。</p>
</li>
</ul>
<ul>
<li><p><code>galois_region_xor(char *r1, char *r2, char *r3, int nbytes)</code></p>
<p>此XOR对字节的两个区域<code>r1</code>和<code>r2</code>进行求和，并将总和放入<code>r3</code>。 请注意，如果我们用总和替换区域之一，则r3可能等于r1或r2。<br> <code>Nbytes</code>必须是机器长字大小的倍数。</p>
</li>
</ul>
<ul>
<li><p><code>galois_w08_region_multiply(char *region, int multby, int nbytes, char *r2, int add)</code>: </p>
<p>这将整个字节区域乘以$GF(2^8)$中的常数<code>multby</code>。 如果<code>r2</code>为NULL，则区域将被覆盖。 否则，如果<code>add</code>为零，则将乘积放在<code>r2</code>中。 如果<code>add</code>不为零，则将乘积与<code>r2</code>中的字节进行异或。</p>
</li>
</ul>
<ul>
<li><code>galois_w16_region_multiply()</code>和<code>galois_w32_region_multiply()</code>与上述函数类似，分别对应$GF(2^{16})$和$GF(2^{32})$.</li>
</ul>
<ul>
<li><p><code>galois_change_technique(gf_t *gf, int w)</code></p>
<p>这使您可以从GF-Complete创建自己的Galois Field算术的自定义实现。 为此，请参阅GF-Complete手册中的<code>create_gf_from_argv()</code>和<code>gf_init_hard()</code>。 这些过程允许您创建<code>gf_t</code>，然后调用<code>galois_change _technique()</code>实现。</p>
</li>
</ul>
<ul>
<li><p><code>galois_init_field()</code>和<code>glois_init_composite_field()</code></p>
<p>会从GF-Complete创建<code>gf_t</code>指针。我们建议，使用<code>create_gf_from_argv()</code>和<code>gf_init_hard()</code>代替。</p>
</li>
</ul>
<ul>
<li><p><code>galois_get_field_ptr(int w)</code></p>
<p>返回一个目前jerasure使用中的指向<code>gf_t</code>的指针，针对指定的w。</p>
</li>
</ul>
<h3 id="1-1-1-内核操作"><a href="#1-1-1-内核操作" class="headerlink" title="1.1.1 内核操作"></a>1.1.1 内核操作</h3><p>库：<code>jerasure.c\jerasure.h</code></p>
<ul>
<li><p><code>void jerasure_do_parity(k,data_ptrs, char *parity_ptr, size)</code></p>
<p>这将从数据ptrs访问的k个内存区域中的每个区域计算数据大小字节的奇偶校验。 它将结果放入奇偶校验ptr指向的大小字节中。 像每个数据ptrs一样，奇偶校验ptr必须是长字对齐的，并且大小必须是sizeof（long）的倍数。</p>
</li>
<li><p><code>void jerasure_matrix_encode(k,m,w,bitmatrix,data_ptrs,coding_ptrs,size,packetsize)</code></p>
<p>这使用位矩阵进行编码。 现在w可以是1到32之间的任何数字。</p>
</li>
<li><p><code>void jerasure_schedule_encode(k, m, w, schedule, data ptrs, coding ptrs, size, packetsize)</code>:</p>
<p>此编码使用从<code>jerasure_dumb_bitmatrix_to_schedule()</code>或<code>jerasure_smart_bitmatrix_schedule()</code>创建的调度进行编码。</p>
</li>
</ul>
<h3 id="1-1-2-解码操作"><a href="#1-1-2-解码操作" class="headerlink" title="1.1.2 解码操作"></a>1.1.2 解码操作</h3><p>这些函数中的每一个都返回一个整数，如果成功则返回0，否则返回-1。 如果擦除太多，则解码可能会失败。</p>
<ul>
<li><strong>int jerasure_matrix_decode(k, m, w matrix, row_k_ones, erasures, data ptrs, coding ptrs, size)</strong></li>
</ul>
<p>此函数使用$GF(2^w)$中的矩阵进行解码。 通过创建解码矩阵并执行矩阵/矢量乘积，然后对所有已擦除的编码设备进行重新编码，可以完成此工作。 完成后，将丢弃解码矩阵。 如果要访问解码矩阵，则应使用下面的<strong>jerasure make decoding matrix()</strong>。</p>
<ul>
<li><strong>int jerasure_bitmatrix_decode(k, m, w bitmatrix, row k ones, erasures, data ptrs, coding ptrs, size, pack)</strong></li>
</ul>
<p><strong>etsize)</strong></p>
<p>​    注意，它不做任何调度-它只是创建解码位矩阵，并直接使用它来进行解码。 同样，完成后它会丢弃解码位矩阵。</p>
<ul>
<li><p><strong>int jerasure_schedule_decode_lazy(k, m, w bitmatrix, erasures, data ptrs, coding ptrs, size, packetsize, int</strong></p>
<p><strong>smart)</strong></p>
<p>这是通过根据解码矩阵创建一个schedule并将其解码来进行解码的。 如果smart是1，则使用 bitmatrix来创建计划。 否则，将使用dumb bitmatrix。 请注意，没有使用变量row_k_ones，因为如果smart为1，则创建的schedule无论如何都会找到该优化。  此过程完成后，将释放计划和分配给解码的所有数据结构。</p>
</li>
</ul>
<ul>
<li><p><strong>int jerasure_schedule_decode_cache(k, m, w cache, erasures, data ptrs, coding ptrs, size, packetsize)</strong></p>
<p>当m = 2时，使用schedule缓存进行解码。</p>
</li>
<li><p><strong>int jerasure_make_decoding_matrix(k, m, w matrix, erased, decoding_matrix, dm_ids)</strong>:</p>
<p>创建解码矩阵。 请注意，解码矩阵和dm id均应分配并传递给此过程，以填充它们。解码矩阵应具有$k^2$个整数，而$dm_ids$应具有$k$整数。</p>
</li>
<li><p><strong>int jerasure_make_decoding_bitmatrix(k, m, w matrix, erased, decoding_matrix, dm_ids)</strong></p>
</li>
</ul>
<p>​    创建解码位矩阵。 同样，应同时定位解码矩阵和dm_id，并将其传递给此过程，以填充它们。此时间解码矩阵应具有$k^2w^2$整数，而$dm_id$仍具有$k$个整数。</p>
<ul>
<li><p><strong>int jerasure_erasures_to_erased(k, m, erasures)</strong></p>
<p>将上面定义的<code>erasure</code>规范转换为上面定义的<code>erased</code>规范。</p>
</li>
</ul>
<h3 id="1-1-3-点积操作"><a href="#1-1-3-点积操作" class="headerlink" title="1.1.3 点积操作"></a>1.1.3 点积操作</h3><ul>
<li><strong>void jerasure_matrix_dotprod(k, w, int<em> matrix_row, int</em> src_ids, int dest_id, data_ptrs, coding_ptrs, size)</strong></li>
</ul>
<p>这将一行编码/解码矩阵乘以数据/幸存者。 源设备的ID（与矢量元素的ID相对应）位于<code>src_id</code>中。 目标设备的ID在目标ID中。  当矩阵中遇到一个1时，将执行正确的XOR /复制操作。 </p>
<ul>
<li><strong>void jerasure bitmatrix dotprod(k, w, int  bitmatrix row, int *src ids, int dest id, data ptrs, coding ptrs,size, packetsize)</strong></li>
</ul>
<p>这是位矩阵的类似过程。 它根据由bitmatrix行指定的矩阵的w行执行w点乘积。</p>
<ul>
<li><strong>void jerasure_do_scheduled_operations(char \</strong>ptrs, schedule, packetsize)**:</li>
</ul>
<p>这将对ptrs指定的指针执行计划。 尽管未指定w，但它以w（packetsize）个字节执行调度。 假定ptrs是与计划匹配的正确大小。 通常，这是k + m。</p>
<h3 id="1-1-4-基础矩阵操作"><a href="#1-1-4-基础矩阵操作" class="headerlink" title="1.1.4 基础矩阵操作"></a>1.1.4 基础矩阵操作</h3><ul>
<li><strong>int jerasure_invert_matrix(int\</strong> mat, int<em> inv, int rows, int w)*</em></li>
</ul>
<p>这求一个$rows\times rows$矩阵的逆，结果保存在inv中。如果矩阵不可逆，返回-1，否则返回0.</p>
<ul>
<li><strong>int jerasure_invert_bitmatrix(int<em> mat, int</em> inv, int rows)</strong>:</li>
</ul>
<p>这是求位矩阵的逆，对应$w=1$，也可以用上面那个函数，不过这个函数明显要快些。它会回收mat。</p>
<p>​    • <strong>int jerasure_invertible_matrix(int *mat, int rows, int w)</strong>:</p>
<p>判断矩阵是否可逆，可逆返回1，否则返回0.</p>
<ul>
<li><strong>void jerasure print matrix(int* matrix, int rows, int cols, int w)</strong>:</li>
</ul>
<p>这个函数会打印矩阵。$w$是用来确定间距的。</p>
<ul>
<li><strong>int*  jerasure matrix multiply(int</strong> <strong>m1, int</strong> <strong>m2, int r1, int c1, int r2, int c2, int w)</strong>:</li>
</ul>
<p>此函数执行矩阵乘法，矩阵m1大小为$r1\times c1$，m2为$r2\times c2$。</p>
<h3 id="1-1-5-统计"><a href="#1-1-5-统计" class="headerlink" title="1.1.5 统计"></a>1.1.5 统计</h3><ul>
<li>jerasures.c 会记录三种类型的数据</li>
</ul>
<ol>
<li>使用<code>galois_region_xor()</code>中进行XOR操作的字节数；</li>
<li>在$GF(2^w)$域中乘上常数的字节数，使用<code>galois_w08_region_multiply</code>,<code>galois_w16_region_multiply</code>和<code>galois_w32_region_multiply</code>。</li>
<li>使用<code>memcpy</code>的字节数量。</li>
</ol>
<p>我们使用函数<strong>void jerasure_get_stats(double* fill_in)</strong>就可以读到这些数据。在调用这个函数后，用于记录的计数器会被置零。比如 fill_in[0]表示异或的数目。</p>
<hr>
<h2 id="S1-2-基础应用教程"><a href="#S1-2-基础应用教程" class="headerlink" title="$\S1.2$ 基础应用教程"></a>$\S1.2$ 基础应用教程</h2><h3 id="例1：构造编码矩阵"><a href="#例1：构造编码矩阵" class="headerlink" title="例1：构造编码矩阵"></a>例1：构造编码矩阵</h3><p><code>\Example\jerasure_01.c</code></p>
<p>这里输入参数是r,c,w，分别代表矩阵的行数，列数，以及有限域大小。对于$(i,j)$的元素对应于$GF(2^w)$中的$2^{ci+j}$。</p>
<p>例如</p>
<pre><code class="hljs angelscript">./jerasure_01 <span class="hljs-number">3</span> <span class="hljs-number">15</span> <span class="hljs-number">8</span></code></pre>
<p>我们可以得到：</p>
<pre><code class="hljs apache"><span class="hljs-section">&lt;HTML&gt;</span><span class="hljs-section">&lt;TITLE&gt;</span><span class="hljs-attribute">jerasure_01</span> <span class="hljs-number">3</span> <span class="hljs-number">15</span> <span class="hljs-number">8</span>&lt;/TITLE&gt;
<span class="hljs-section">&lt;h3&gt;</span><span class="hljs-attribute">jerasure_01</span> <span class="hljs-number">3</span> <span class="hljs-number">15</span> <span class="hljs-number">8</span>&lt;/h<span class="hljs-number">3</span>&gt;
<span class="hljs-section">&lt;pre&gt;</span>
  <span class="hljs-attribute">1</span>   <span class="hljs-number">2</span>   <span class="hljs-number">4</span>   <span class="hljs-number">8</span>  <span class="hljs-number">16</span>  <span class="hljs-number">32</span>  <span class="hljs-number">64</span> <span class="hljs-number">128</span>  <span class="hljs-number">29</span>  <span class="hljs-number">58</span> <span class="hljs-number">116</span> <span class="hljs-number">232</span> <span class="hljs-number">205</span> <span class="hljs-number">135</span>  <span class="hljs-number">19</span>
 <span class="hljs-attribute">38</span>  <span class="hljs-number">76</span> <span class="hljs-number">152</span>  <span class="hljs-number">45</span>  <span class="hljs-number">90</span> <span class="hljs-number">180</span> <span class="hljs-number">117</span> <span class="hljs-number">234</span> <span class="hljs-number">201</span> <span class="hljs-number">143</span>   <span class="hljs-number">3</span>   <span class="hljs-number">6</span>  <span class="hljs-number">12</span>  <span class="hljs-number">24</span>  <span class="hljs-number">48</span>
 <span class="hljs-attribute">96</span> <span class="hljs-number">192</span> <span class="hljs-number">157</span>  <span class="hljs-number">39</span>  <span class="hljs-number">78</span> <span class="hljs-number">156</span>  <span class="hljs-number">37</span>  <span class="hljs-number">74</span> <span class="hljs-number">148</span>  <span class="hljs-number">53</span> <span class="hljs-number">106</span> <span class="hljs-number">212</span> <span class="hljs-number">181</span> <span class="hljs-number">119</span> <span class="hljs-number">238</span>
</code></pre>
<p>我们分析一下结果，对于<code>matrix</code>从(0,0)开始，构造$GF(2^8)$上的45个元素（每个都不超过256），至于为什么128后面是29，参考<a href="https://durantthorvalds.top/2020/11/15/%E7%BA%A0%E5%88%A0%E7%A0%81%E5%9C%A8%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BA%94%E7%94%A8/">纠删码在存储中的应用</a>关于伽罗华域讲解部分。</p>
<h3 id="例2：构造位编码矩阵"><a href="#例2：构造位编码矩阵" class="headerlink" title="例2：构造位编码矩阵"></a>例2：构造位编码矩阵</h3><p><code>\Example\jerasure_02.c</code></p>
<p>我们运行</p>
<pre><code class="hljs angelscript">./jerasure_02 <span class="hljs-number">3</span> <span class="hljs-number">10</span> <span class="hljs-number">4</span></code></pre>
<pre><code class="hljs angelscript"><span class="hljs-number">1000</span> <span class="hljs-number">0001</span> <span class="hljs-number">0010</span> <span class="hljs-number">0100</span> <span class="hljs-number">1001</span> <span class="hljs-number">0011</span> <span class="hljs-number">0110</span> <span class="hljs-number">1101</span> <span class="hljs-number">1010</span> <span class="hljs-number">0101</span>
<span class="hljs-number">0100</span> <span class="hljs-number">1001</span> <span class="hljs-number">0011</span> <span class="hljs-number">0110</span> <span class="hljs-number">1101</span> <span class="hljs-number">1010</span> <span class="hljs-number">0101</span> <span class="hljs-number">1011</span> <span class="hljs-number">0111</span> <span class="hljs-number">1111</span>
<span class="hljs-number">0010</span> <span class="hljs-number">0100</span> <span class="hljs-number">1001</span> <span class="hljs-number">0011</span> <span class="hljs-number">0110</span> <span class="hljs-number">1101</span> <span class="hljs-number">1010</span> <span class="hljs-number">0101</span> <span class="hljs-number">1011</span> <span class="hljs-number">0111</span>
<span class="hljs-number">0001</span> <span class="hljs-number">0010</span> <span class="hljs-number">0100</span> <span class="hljs-number">1001</span> <span class="hljs-number">0011</span> <span class="hljs-number">0110</span> <span class="hljs-number">1101</span> <span class="hljs-number">1010</span> <span class="hljs-number">0101</span> <span class="hljs-number">1011</span>
 				
<span class="hljs-number">1011</span> <span class="hljs-number">0111</span> <span class="hljs-number">1111</span> <span class="hljs-number">1110</span> <span class="hljs-number">1100</span> <span class="hljs-number">1000</span> <span class="hljs-number">0001</span> <span class="hljs-number">0010</span> <span class="hljs-number">0100</span> <span class="hljs-number">1001</span>
<span class="hljs-number">1110</span> <span class="hljs-number">1100</span> <span class="hljs-number">1000</span> <span class="hljs-number">0001</span> <span class="hljs-number">0010</span> <span class="hljs-number">0100</span> <span class="hljs-number">1001</span> <span class="hljs-number">0011</span> <span class="hljs-number">0110</span> <span class="hljs-number">1101</span>
<span class="hljs-number">1111</span> <span class="hljs-number">1110</span> <span class="hljs-number">1100</span> <span class="hljs-number">1000</span> <span class="hljs-number">0001</span> <span class="hljs-number">0010</span> <span class="hljs-number">0100</span> <span class="hljs-number">1001</span> <span class="hljs-number">0011</span> <span class="hljs-number">0110</span>
<span class="hljs-number">0111</span> <span class="hljs-number">1111</span> <span class="hljs-number">1110</span> <span class="hljs-number">1100</span> <span class="hljs-number">1000</span> <span class="hljs-number">0001</span> <span class="hljs-number">0010</span> <span class="hljs-number">0100</span> <span class="hljs-number">1001</span> <span class="hljs-number">0011</span>

<span class="hljs-number">0011</span> <span class="hljs-number">0110</span> <span class="hljs-number">1101</span> <span class="hljs-number">1010</span> <span class="hljs-number">0101</span> <span class="hljs-number">1011</span> <span class="hljs-number">0111</span> <span class="hljs-number">1111</span> <span class="hljs-number">1110</span> <span class="hljs-number">1100</span>
<span class="hljs-number">1010</span> <span class="hljs-number">0101</span> <span class="hljs-number">1011</span> <span class="hljs-number">0111</span> <span class="hljs-number">1111</span> <span class="hljs-number">1110</span> <span class="hljs-number">1100</span> <span class="hljs-number">1000</span> <span class="hljs-number">0001</span> <span class="hljs-number">0010</span>
<span class="hljs-number">1101</span> <span class="hljs-number">1010</span> <span class="hljs-number">0101</span> <span class="hljs-number">1011</span> <span class="hljs-number">0111</span> <span class="hljs-number">1111</span> <span class="hljs-number">1110</span> <span class="hljs-number">1100</span> <span class="hljs-number">1000</span> <span class="hljs-number">0001</span>
</code></pre>
<p>整个矩阵的大小为 $rw\times cw$。我们好好看下这个位矩阵是怎么来的。</p>
<p><img src="/img/image-20210126211602293.png" srcset="/img/loading.gif" alt="image-20210126211602293" style="zoom:67%;" /></p>
<p>所以每个$w\times w$子块是不断左移的，。每次移动的距离为1。</p>
<h3 id="例3：构造柯西矩阵以及判断矩阵可逆性"><a href="#例3：构造柯西矩阵以及判断矩阵可逆性" class="headerlink" title="例3：构造柯西矩阵以及判断矩阵可逆性"></a>例3：构造柯西矩阵以及判断矩阵可逆性</h3><p><code>\Example\jerasure_03.c</code></p>
<p>这会创建一个$k\times k$的柯西矩阵，且$k<2^w$，矩阵$(i,j)$的元素为：$1/\{i\oplus(2^w-j-1)\}$，这儿的减号是普通减法。当$k>2^{w-1}$，存在分母为0 的可能性，这个时候元素被设为0。</p>
<p>我们顺便测试该矩阵是否可逆，如果$k\le 2^{w-1}$就是可逆的，否则不可逆。</p>
<p>运行下列命令</p>
<pre><code class="hljs angelscript">./jerasure_03 <span class="hljs-number">4</span> <span class="hljs-number">3</span></code></pre>
<p>我们得到</p>
<pre><code class="hljs yaml"><span class="hljs-string">&lt;HTML&gt;&lt;TITLE&gt;jerasure_03</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span><span class="hljs-string">&lt;/TITLE&gt;</span>
<span class="hljs-string">&lt;h3&gt;jerasure_03</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span><span class="hljs-string">&lt;/h3&gt;</span>
<span class="hljs-string">&lt;pre&gt;</span>
<span class="hljs-attr">The Cauchy Matrix:</span>
<span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">7</span>
<span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">7</span> <span class="hljs-number">2</span>
<span class="hljs-number">2</span> <span class="hljs-number">7</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span>
<span class="hljs-number">7</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span>

<span class="hljs-attr">Invertible:</span> <span class="hljs-literal">Yes</span>

<span class="hljs-attr">Inverse:</span>
<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">5</span> <span class="hljs-number">3</span>
<span class="hljs-number">2</span> <span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span>
<span class="hljs-number">5</span> <span class="hljs-number">3</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span>
<span class="hljs-number">3</span> <span class="hljs-number">5</span> <span class="hljs-number">2</span> <span class="hljs-number">1</span>

<span class="hljs-string">Inverse</span> <span class="hljs-string">times</span> <span class="hljs-string">matrix</span> <span class="hljs-string">(should</span> <span class="hljs-string">be</span> <span class="hljs-string">identity):</span>
<span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>
<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>
<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span>
<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span>
</code></pre>
<h3 id="例4：构造位柯西矩阵以及判断矩阵可逆性"><a href="#例4：构造位柯西矩阵以及判断矩阵可逆性" class="headerlink" title="例4：构造位柯西矩阵以及判断矩阵可逆性"></a>例4：构造位柯西矩阵以及判断矩阵可逆性</h3><p>与例三作用相同，只不过是求位矩阵。</p>
<p>我们得到的结果如下</p>
<pre><code class="hljs yaml"><span class="hljs-string">&lt;HTML&gt;&lt;TITLE&gt;jerasure_04</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span><span class="hljs-string">&lt;/TITLE&gt;</span>
<span class="hljs-string">&lt;h3&gt;jerasure_04</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span><span class="hljs-string">&lt;/h3&gt;</span>
<span class="hljs-string">&lt;pre&gt;</span>
<span class="hljs-attr">The Cauchy Bit-Matrix:</span>
<span class="hljs-number">010</span> <span class="hljs-number">101</span> <span class="hljs-number">001</span> <span class="hljs-number">111</span>
<span class="hljs-number">011</span> <span class="hljs-number">111</span> <span class="hljs-number">101</span> <span class="hljs-number">100</span>
<span class="hljs-number">101</span> <span class="hljs-number">011</span> <span class="hljs-number">010</span> <span class="hljs-number">110</span>

<span class="hljs-number">101</span> <span class="hljs-number">010</span> <span class="hljs-number">111</span> <span class="hljs-number">001</span>
<span class="hljs-number">111</span> <span class="hljs-number">011</span> <span class="hljs-number">100</span> <span class="hljs-number">101</span>
<span class="hljs-number">011</span> <span class="hljs-number">101</span> <span class="hljs-number">110</span> <span class="hljs-number">010</span>

<span class="hljs-number">001</span> <span class="hljs-number">111</span> <span class="hljs-number">010</span> <span class="hljs-number">101</span>
<span class="hljs-number">101</span> <span class="hljs-number">100</span> <span class="hljs-number">011</span> <span class="hljs-number">111</span>
<span class="hljs-number">010</span> <span class="hljs-number">110</span> <span class="hljs-number">101</span> <span class="hljs-number">011</span>

<span class="hljs-number">111</span> <span class="hljs-number">001</span> <span class="hljs-number">101</span> <span class="hljs-number">010</span>
<span class="hljs-number">100</span> <span class="hljs-number">101</span> <span class="hljs-number">111</span> <span class="hljs-number">011</span>
<span class="hljs-number">110</span> <span class="hljs-number">010</span> <span class="hljs-number">011</span> <span class="hljs-number">101</span>

<span class="hljs-attr">Invertible:</span> <span class="hljs-literal">Yes</span>

<span class="hljs-string">...</span></code></pre>
<p>$k=4,w=3$，这个位矩阵如何理解，</p>
<h3 id="例5：基础RS码构造"><a href="#例5：基础RS码构造" class="headerlink" title="例5：基础RS码构造"></a>例5：基础RS码构造</h3><p><code>\Example\jerasure_05.c</code></p>
<p>输入参数: k , m, w , size, seed</p>
<p>约束：w必须在8，16，32中取，$k+m\le 2^w$，每个设备的总字节数size必须是sizeof(long)的整数倍，seed是随机数种子。</p>
<p>它首先由<code>jerasure_matrix_encode</code>建立一个$m\times k$柯西编码矩阵：每个元素为$\frac{1}{i\oplus (j+m)}$，接下来，它从数据和编码设备的集合中删除m个随机设备。接下来，它使用<code>jerasure_matrix_decode</code>解码并打印恢复后的矩阵。 该矩阵是分布矩阵的最后k行的逆矩阵。 最后，它使用<code>jerasure_matrix_dotprod()</code>演示了如何在擦除前m个设备后从其他数据显式计算第一个数据设备。<br>   这是w = 8的示例，其中有3个数据设备和4个编码设备，每个设备的大小为8个字节：</p>
<p>输出：十六-十进制（一个字节由两个十六进制位表示）。</p>
<pre><code class="hljs angelscript">./jerasure_05 <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">8</span> <span class="hljs-number">8</span> <span class="hljs-number">100</span></code></pre>
<pre><code class="hljs apache"><span class="hljs-section">&lt;HTML&gt;</span><span class="hljs-section">&lt;TITLE&gt;</span><span class="hljs-attribute">jerasure_05</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">8</span> <span class="hljs-number">8</span> <span class="hljs-number">100</span>&lt;/TITLE&gt;
<span class="hljs-section">&lt;h3&gt;</span><span class="hljs-attribute">jerasure_05</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">8</span> <span class="hljs-number">8</span> <span class="hljs-number">100</span>&lt;/h<span class="hljs-number">3</span>&gt;
<span class="hljs-section">&lt;pre&gt;</span>
<span class="hljs-attribute">The</span> Coding Matrix (the last m rows of the Generator Matrix G^T):

 <span class="hljs-attribute">71</span> <span class="hljs-number">167</span> <span class="hljs-number">122</span>
<span class="hljs-attribute">167</span>  <span class="hljs-number">71</span> <span class="hljs-number">186</span>
<span class="hljs-attribute">122</span> <span class="hljs-number">186</span>  <span class="hljs-number">71</span>
<span class="hljs-attribute">186</span> <span class="hljs-number">122</span> <span class="hljs-number">167</span>

<span class="hljs-attribute">Encoding</span> Complete:

<span class="hljs-attribute">Data</span>                            Coding
<span class="hljs-attribute">D0</span> : <span class="hljs-number">8</span>b e<span class="hljs-number">3</span> eb <span class="hljs-number">02</span> <span class="hljs-number">03</span> <span class="hljs-number">5</span>f c<span class="hljs-number">5</span> <span class="hljs-number">99</span>    C<span class="hljs-number">0</span> : ab <span class="hljs-number">09</span> <span class="hljs-number">6</span>d <span class="hljs-number">49</span> <span class="hljs-number">24</span> e<span class="hljs-number">2</span> <span class="hljs-number">6</span>e ae
<span class="hljs-attribute">D1</span> : <span class="hljs-number">14</span> <span class="hljs-number">2</span>f f<span class="hljs-number">4</span> <span class="hljs-number">2</span>b e<span class="hljs-number">7</span> <span class="hljs-number">72</span> <span class="hljs-number">85</span> b<span class="hljs-number">3</span>    C<span class="hljs-number">1</span> : ee ee bb <span class="hljs-number">70</span> <span class="hljs-number">26</span> c<span class="hljs-number">2</span> b<span class="hljs-number">3</span> <span class="hljs-number">9</span>c
<span class="hljs-attribute">D2</span> : <span class="hljs-number">85</span> eb <span class="hljs-number">30</span> <span class="hljs-number">9</span>a ee d<span class="hljs-number">4</span> <span class="hljs-number">5</span>d b<span class="hljs-number">1</span>    C<span class="hljs-number">2</span> : <span class="hljs-number">69</span> c<span class="hljs-number">0</span> <span class="hljs-number">33</span> e<span class="hljs-number">8</span> <span class="hljs-number">1</span>a d<span class="hljs-number">8</span> c<span class="hljs-number">8</span> e<span class="hljs-number">3</span>
                                <span class="hljs-attribute">C3</span> : <span class="hljs-number">4</span>b b<span class="hljs-number">3</span> <span class="hljs-number">6</span>c <span class="hljs-number">32</span> <span class="hljs-number">45</span> ae <span class="hljs-number">92</span> <span class="hljs-number">5</span>b

<span class="hljs-attribute">Erased</span> <span class="hljs-number">4</span> random devices:

<span class="hljs-attribute">Data</span>                            Coding
<span class="hljs-attribute">D0</span> : <span class="hljs-number">8</span>b e<span class="hljs-number">3</span> eb <span class="hljs-number">02</span> <span class="hljs-number">03</span> <span class="hljs-number">5</span>f c<span class="hljs-number">5</span> <span class="hljs-number">99</span>    C<span class="hljs-number">0</span> : <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>
<span class="hljs-attribute">D1</span> : <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>    C<span class="hljs-number">1</span> : <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>
<span class="hljs-attribute">D2</span> : <span class="hljs-number">85</span> eb <span class="hljs-number">30</span> <span class="hljs-number">9</span>a ee d<span class="hljs-number">4</span> <span class="hljs-number">5</span>d b<span class="hljs-number">1</span>    C<span class="hljs-number">2</span> : <span class="hljs-number">69</span> c<span class="hljs-number">0</span> <span class="hljs-number">33</span> e<span class="hljs-number">8</span> <span class="hljs-number">1</span>a d<span class="hljs-number">8</span> c<span class="hljs-number">8</span> e<span class="hljs-number">3</span>
                                <span class="hljs-attribute">C3</span> : <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>

<span class="hljs-attribute">State</span> of the system after decoding:

<span class="hljs-attribute">Data</span>                            Coding
<span class="hljs-attribute">D0</span> : <span class="hljs-number">8</span>b e<span class="hljs-number">3</span> eb <span class="hljs-number">02</span> <span class="hljs-number">03</span> <span class="hljs-number">5</span>f c<span class="hljs-number">5</span> <span class="hljs-number">99</span>    C<span class="hljs-number">0</span> : ab <span class="hljs-number">09</span> <span class="hljs-number">6</span>d <span class="hljs-number">49</span> <span class="hljs-number">24</span> e<span class="hljs-number">2</span> <span class="hljs-number">6</span>e ae
<span class="hljs-attribute">D1</span> : <span class="hljs-number">14</span> <span class="hljs-number">2</span>f f<span class="hljs-number">4</span> <span class="hljs-number">2</span>b e<span class="hljs-number">7</span> <span class="hljs-number">72</span> <span class="hljs-number">85</span> b<span class="hljs-number">3</span>    C<span class="hljs-number">1</span> : ee ee bb <span class="hljs-number">70</span> <span class="hljs-number">26</span> c<span class="hljs-number">2</span> b<span class="hljs-number">3</span> <span class="hljs-number">9</span>c
<span class="hljs-attribute">D2</span> : <span class="hljs-number">85</span> eb <span class="hljs-number">30</span> <span class="hljs-number">9</span>a ee d<span class="hljs-number">4</span> <span class="hljs-number">5</span>d b<span class="hljs-number">1</span>    C<span class="hljs-number">2</span> : <span class="hljs-number">69</span> c<span class="hljs-number">0</span> <span class="hljs-number">33</span> e<span class="hljs-number">8</span> <span class="hljs-number">1</span>a d<span class="hljs-number">8</span> c<span class="hljs-number">8</span> e<span class="hljs-number">3</span>
                                <span class="hljs-attribute">C3</span> : <span class="hljs-number">4</span>b b<span class="hljs-number">3</span> <span class="hljs-number">6</span>c <span class="hljs-number">32</span> <span class="hljs-number">45</span> ae <span class="hljs-number">92</span> <span class="hljs-number">5</span>b

<span class="hljs-attribute">Suppose</span> we erase the first <span class="hljs-number">4</span> devices.  Here is the decoding matrix:

<span class="hljs-attribute">130</span>  <span class="hljs-number">25</span> <span class="hljs-number">182</span>
<span class="hljs-attribute">252</span> <span class="hljs-number">221</span>  <span class="hljs-number">25</span>
<span class="hljs-attribute">108</span> <span class="hljs-number">252</span> <span class="hljs-number">130</span>

<span class="hljs-attribute">And</span> dm_ids:

  <span class="hljs-attribute">4</span>   <span class="hljs-number">5</span>   <span class="hljs-number">6</span>

<span class="hljs-attribute">After</span> calling jerasure_matrix_dotprod, we calculate the value of device #<span class="hljs-number">0</span> to be:

<span class="hljs-attribute">D0</span> : <span class="hljs-number">8</span>b e<span class="hljs-number">3</span> eb <span class="hljs-number">02</span> <span class="hljs-number">03</span> <span class="hljs-number">5</span>f c<span class="hljs-number">5</span> <span class="hljs-number">99</span>
</code></pre>
<p>在这个例子中，</p>
<p>第一个编码块的0字节为：</p>
<script type="math/tex; mode=display">
byte 0 of C_0 = (71 × byte 0 of D_0) ⊕ (167 × byte 0 of D_1) ⊕ (122 × byte 0 of D_2)</script><p>但是，请记住，该实现实际上一次对一组字节执行点积。 因此，在此示例中，每个设备包含8个字节，点积实际上是：</p>
<script type="math/tex; mode=display">
8 bytes of C_0 = (71 × 8 bytes of D_0) ⊕ (167 × 8 bytes of D_1) ⊕ (122 × 8 bytes of D_2)</script><h3 id=""><a href="#" class="headerlink" title=" "></a> </h3><h3 id="例6：基础位RS码构造"><a href="#例6：基础位RS码构造" class="headerlink" title="例6：基础位RS码构造"></a>例6：基础位RS码构造</h3><p><code>\Example\jerasure_06.c</code></p>
<p>输入参数：k,m,w,packet_size,seed.</p>
<p>其中packet_size必须是<code>sizeof(long)=4</code>的整数倍。</p>
<pre><code class="hljs angelscript">./jerasure_06 <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">8</span> <span class="hljs-number">100</span></code></pre>
<p><img src="/img/image-20210127170433218.png" srcset="/img/loading.gif" alt="image-20210127170433218"></p>
<p><img src="/img/image-20210127170530595.png" srcset="/img/loading.gif" alt="image-20210127170530595"></p>
<p><img src="/img/image-20210127170550129.png" srcset="/img/loading.gif" alt="image-20210127170550129"></p>
<blockquote>
<p>疑问：为什么RS矩阵的w必须是8，16，32，而位矩阵则只要w在[0,32）以内就行？</p>
</blockquote>
<p>在这种编码中，根据编码矩阵第一行中的六个，计算出C0的第一个数据包：</p>
<script type="math/tex; mode=display">
C_0p_0 = D_0p_0 ⊕ D_0p_1 ⊕ D_0p_2 ⊕ D_1p_2 ⊕ D_2p_0 ⊕ D_2p_2</script><h3 id="例7：带schedule的位RS码构造"><a href="#例7：带schedule的位RS码构造" class="headerlink" title="例7：带schedule的位RS码构造"></a>例7：带schedule的位RS码构造</h3><p><code>\Example\jerasure_07.C</code></p>
<p>它执行与jerasure 06中相同的编码/解码，除了它使用位矩阵schedule而不是位矩阵操作。 数据包的大小设置为sizeof（long）个字节。 它创建了一个“dumb”和“smart”的编码时间表，对其进行编码，并打印出每一个进行了多少XOR。<br>   接下来，它擦除m个随机设备，并使用<code>jerasure_schedule_decode_lazy()</code>进行解码。 最后，为了细致化操作，它调用了<code>jerasure_do_scheduled_operations()</code>。</p>
<pre><code class="hljs angelscript">./jerasure_07 <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">102</span></code></pre>
<p><img src="/img/image-20210127165645630.png" srcset="/img/loading.gif" alt="image-20210127165645630"></p>
<p><img src="/img/image-20210127165723454.png" srcset="/img/loading.gif" alt="image-20210127165723454"></p>
<p><img src="/img/image-20210127165746318.png" srcset="/img/loading.gif" alt="image-20210127165746318"></p>
<h3 id="-1"><a href="#-1" class="headerlink" title=" "></a> </h3><h3 id="例8：带schedule-cache的简单RAID-6构造"><a href="#例8：带schedule-cache的简单RAID-6构造" class="headerlink" title="例8：带schedule cache的简单RAID-6构造"></a>例8：带schedule cache的简单RAID-6构造</h3><p>它建立一个RAID-6编码矩阵，该矩阵的第一行由1组成，第二行$j$列的元素等于$GF(2^w)$中的$2^j$。 它将其转换为位矩阵，并创建智能编码时间表和用于解码的时间表缓存。<br>   然后将其编码两次: 首先使用smart schedule，然后使用schedule 缓存，方法是将两个编码设备设置为已擦除设备。 接下来，它删除两个随机设备，并使用schedule缓存对其进行解码。 接下来，它删除第一个编码设备，并使用<code>jerasure do parity()</code>对其进行重新计算以演示该过程。 最后，它将释放schedule缓存。</p>
<hr>
<h2 id="S1-3-经典RS码"><a href="#S1-3-经典RS码" class="headerlink" title="$\S1.3$ 经典RS码"></a>$\S1.3$ 经典RS码</h2><p>依赖：<code>reed_sol.h</code>, <code>reed_sol.c</code></p>
<h3 id="1-3-1-Vandermonde分布矩阵"><a href="#1-3-1-Vandermonde分布矩阵" class="headerlink" title="1.3.1 Vandermonde分布矩阵"></a>1.3.1 Vandermonde分布矩阵</h3><ul>
<li><p><code>int *reed_sol_vandermonde_coding_matrix(k,m,w)</code></p>
<p>这将基于扩展的范德蒙德矩阵返回$GF(2^w)$中分布矩阵的最后$m$行。 这是一个$m×k$矩阵，可以与jerasure.c中的矩阵例程一起使用。 此矩阵的第一行保证全为1。 第一列也保证全为1。 </p>
</li>
<li><p><code>int *reed sol_extended_vandermonde_matrix(int rows, int cols, w)</code></p>
<p>这会创建一个扩展的范德蒙德矩阵。</p>
</li>
<li><p><code>int *reed_sol_big_vandermonde_distribution_matrix(int rows, int cols, w)</code></p>
<p>这将扩展矩阵转化为分布矩阵。</p>
</li>
</ul>
<h3 id="1-3-2-针对RAID-6的RS码优化"><a href="#1-3-2-针对RAID-6的RS码优化" class="headerlink" title="1.3.2 针对RAID-6的RS码优化"></a>1.3.2 针对RAID-6的RS码优化</h3><p>在RAID-6中，$m=2$，使用奇偶校验从其他编码设备中计算出第一编码设备P，使用以下数据从数据设备Di中计算出第二编码设备Q：</p>
<script type="math/tex; mode=display">
Q=\sum\limits_{i=0}^{k-1}2^iD_i</script><ul>
<li><p><code>int reed_sol_r6_encode(k,w,data_ptr,coding_ptr,size)</code> 编码函数。</p>
</li>
<li><p><code>int *reed_sol_r6_coding_matrix(k,w)</code>:为了进行解码，该函数返回分布矩阵的最后两行。第一行全为1，第二行为$2^j$，$j$为列数。</p>
</li>
<li><code>reed_sol_galois_w08_region_multby_2(char *region, int nbytes)</code>:这会使用Anvin的优化[Anv07]在GF（2^8）中执行快速乘以2。 区域必须是长字对齐的，并且nbytes必须是字长的倍数。</li>
<li><p><code>reed_sol_galois_w16_region_multby_2(char *region, int nbytes)</code>:</p>
</li>
<li><p><code>reed_sol_galois_w32_region_multby_2(char *region, int nbytes)</code></p>
</li>
</ul>
<h3 id="1-3-3-实例"><a href="#1-3-3-实例" class="headerlink" title="1.3.3 实例"></a>1.3.3 实例</h3><h3 id="例8：传统RS编码"><a href="#例8：传统RS编码" class="headerlink" title="例8：传统RS编码"></a>例8：传统RS编码</h3><p><code>\Example\reed_sol_01.c</code></p>
<p>输入：k,m,w,seed</p>
<pre><code class="hljs angelscript">./reed_sol_01 <span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">8</span> <span class="hljs-number">105</span></code></pre>
<pre><code class="hljs apache"><span class="hljs-attribute">Last</span> m rows of the generator Matrix (G^T):

  <span class="hljs-attribute">1</span>   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>
  <span class="hljs-attribute">1</span> <span class="hljs-number">217</span>  <span class="hljs-number">92</span> <span class="hljs-number">172</span>
  <span class="hljs-attribute">1</span>  <span class="hljs-number">70</span> <span class="hljs-number">143</span> <span class="hljs-number">200</span>

<span class="hljs-attribute">Encoding</span> Complete:

<span class="hljs-attribute">Data</span>                            Coding
<span class="hljs-attribute">D0</span> : <span class="hljs-number">6</span>f c<span class="hljs-number">1</span> a<span class="hljs-number">7</span> <span class="hljs-number">58</span> a<span class="hljs-number">0</span> b<span class="hljs-number">4</span> <span class="hljs-number">17</span> <span class="hljs-number">74</span>    C<span class="hljs-number">0</span> : <span class="hljs-number">1</span>c <span class="hljs-number">28</span> <span class="hljs-number">9</span>e <span class="hljs-number">71</span> <span class="hljs-number">06</span> bb <span class="hljs-number">51</span> <span class="hljs-number">22</span>
<span class="hljs-attribute">D1</span> : <span class="hljs-number">82</span> <span class="hljs-number">13</span> <span class="hljs-number">7</span>f c<span class="hljs-number">0</span> <span class="hljs-number">9</span>f <span class="hljs-number">3</span>f db a<span class="hljs-number">4</span>    C<span class="hljs-number">1</span> : <span class="hljs-number">7</span>c <span class="hljs-number">0</span>e <span class="hljs-number">9</span>d <span class="hljs-number">11</span> ee <span class="hljs-number">20</span> <span class="hljs-number">79</span> ef
<span class="hljs-attribute">D2</span> : b<span class="hljs-number">5</span> <span class="hljs-number">90</span> <span class="hljs-number">6</span>d d<span class="hljs-number">0</span> <span class="hljs-number">92</span> ea ac <span class="hljs-number">98</span>    C<span class="hljs-number">2</span> : <span class="hljs-number">55</span> <span class="hljs-number">0</span>c a<span class="hljs-number">8</span> f<span class="hljs-number">2</span> <span class="hljs-number">99</span> dd <span class="hljs-number">25</span> e<span class="hljs-number">6</span>
<span class="hljs-attribute">D3</span> : <span class="hljs-number">44</span> <span class="hljs-number">6</span>a <span class="hljs-number">2</span>b <span class="hljs-number">39</span> ab da <span class="hljs-number">31</span> <span class="hljs-number">6</span>a    

<span class="hljs-attribute">Erased</span> <span class="hljs-number">3</span> random devices:

<span class="hljs-attribute">Data</span>                            Coding
<span class="hljs-attribute">D0</span> : <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>    C<span class="hljs-number">0</span> : <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>
<span class="hljs-attribute">D1</span> : <span class="hljs-number">82</span> <span class="hljs-number">13</span> <span class="hljs-number">7</span>f c<span class="hljs-number">0</span> <span class="hljs-number">9</span>f <span class="hljs-number">3</span>f db a<span class="hljs-number">4</span>    C<span class="hljs-number">1</span> : <span class="hljs-number">7</span>c <span class="hljs-number">0</span>e <span class="hljs-number">9</span>d <span class="hljs-number">11</span> ee <span class="hljs-number">20</span> <span class="hljs-number">79</span> ef
<span class="hljs-attribute">D2</span> : b<span class="hljs-number">5</span> <span class="hljs-number">90</span> <span class="hljs-number">6</span>d d<span class="hljs-number">0</span> <span class="hljs-number">92</span> ea ac <span class="hljs-number">98</span>    C<span class="hljs-number">2</span> : <span class="hljs-number">55</span> <span class="hljs-number">0</span>c a<span class="hljs-number">8</span> f<span class="hljs-number">2</span> <span class="hljs-number">99</span> dd <span class="hljs-number">25</span> e<span class="hljs-number">6</span>
<span class="hljs-attribute">D3</span> : <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>    

<span class="hljs-attribute">State</span> of the system after decoding:

<span class="hljs-attribute">Data</span>                            Coding
<span class="hljs-attribute">D0</span> : <span class="hljs-number">6</span>f c<span class="hljs-number">1</span> a<span class="hljs-number">7</span> <span class="hljs-number">58</span> a<span class="hljs-number">0</span> b<span class="hljs-number">4</span> <span class="hljs-number">17</span> <span class="hljs-number">74</span>    C<span class="hljs-number">0</span> : <span class="hljs-number">1</span>c <span class="hljs-number">28</span> <span class="hljs-number">9</span>e <span class="hljs-number">71</span> <span class="hljs-number">06</span> bb <span class="hljs-number">51</span> <span class="hljs-number">22</span>
<span class="hljs-attribute">D1</span> : <span class="hljs-number">82</span> <span class="hljs-number">13</span> <span class="hljs-number">7</span>f c<span class="hljs-number">0</span> <span class="hljs-number">9</span>f <span class="hljs-number">3</span>f db a<span class="hljs-number">4</span>    C<span class="hljs-number">1</span> : <span class="hljs-number">7</span>c <span class="hljs-number">0</span>e <span class="hljs-number">9</span>d <span class="hljs-number">11</span> ee <span class="hljs-number">20</span> <span class="hljs-number">79</span> ef
<span class="hljs-attribute">D2</span> : b<span class="hljs-number">5</span> <span class="hljs-number">90</span> <span class="hljs-number">6</span>d d<span class="hljs-number">0</span> <span class="hljs-number">92</span> ea ac <span class="hljs-number">98</span>    C<span class="hljs-number">2</span> : <span class="hljs-number">55</span> <span class="hljs-number">0</span>c a<span class="hljs-number">8</span> f<span class="hljs-number">2</span> <span class="hljs-number">99</span> dd <span class="hljs-number">25</span> e<span class="hljs-number">6</span>
<span class="hljs-attribute">D3</span> : <span class="hljs-number">44</span> <span class="hljs-number">6</span>a <span class="hljs-number">2</span>b <span class="hljs-number">39</span> ab da <span class="hljs-number">31</span> <span class="hljs-number">6</span>a    
</code></pre>
<h3 id="例9：三种重要矩阵"><a href="#例9：三种重要矩阵" class="headerlink" title="例9：三种重要矩阵"></a>例9：三种重要矩阵</h3><p><code>\Example\reed_sol_02.c</code></p>
<p>输入：k m w</p>
<p>输出：1. $(k+m)\times k $的扩展范德蒙德矩阵；2. 含单位矩阵块的分布矩阵；3. $m\times k$的编码矩阵，通过设置<code>row_k_ones</code>为1，可以进行提速。</p>
<p>注意：w可在1-32取任何值。</p>
<pre><code class="hljs angelscript">./reed_sol_02 <span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">8</span></code></pre>
<pre><code class="hljs yaml"><span class="hljs-attr">Extended Vandermonde Matrix:</span>

  <span class="hljs-number">1</span>   <span class="hljs-number">0</span>   <span class="hljs-number">0</span>   <span class="hljs-number">0</span>
  <span class="hljs-number">1</span>   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>
  <span class="hljs-number">1</span>   <span class="hljs-number">2</span>   <span class="hljs-number">4</span>   <span class="hljs-number">8</span>
  <span class="hljs-number">1</span>   <span class="hljs-number">3</span>   <span class="hljs-number">5</span>  <span class="hljs-number">15</span>
  <span class="hljs-number">1</span>   <span class="hljs-number">4</span>  <span class="hljs-number">16</span>  <span class="hljs-number">64</span>
  <span class="hljs-number">1</span>   <span class="hljs-number">5</span>  <span class="hljs-number">17</span>  <span class="hljs-number">85</span>
  <span class="hljs-number">0</span>   <span class="hljs-number">0</span>   <span class="hljs-number">0</span>   <span class="hljs-number">1</span>

<span class="hljs-string">Vandermonde</span> <span class="hljs-string">Generator</span> <span class="hljs-string">Matrix</span> <span class="hljs-string">(G^T):</span>

  <span class="hljs-number">1</span>   <span class="hljs-number">0</span>   <span class="hljs-number">0</span>   <span class="hljs-number">0</span>
  <span class="hljs-number">0</span>   <span class="hljs-number">1</span>   <span class="hljs-number">0</span>   <span class="hljs-number">0</span>
  <span class="hljs-number">0</span>   <span class="hljs-number">0</span>   <span class="hljs-number">1</span>   <span class="hljs-number">0</span>
  <span class="hljs-number">0</span>   <span class="hljs-number">0</span>   <span class="hljs-number">0</span>   <span class="hljs-number">1</span>
  <span class="hljs-number">1</span>   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>
  <span class="hljs-number">1</span> <span class="hljs-number">217</span>  <span class="hljs-number">92</span> <span class="hljs-number">172</span>
  <span class="hljs-number">1</span>  <span class="hljs-number">70</span> <span class="hljs-number">143</span> <span class="hljs-number">200</span>

<span class="hljs-attr">Vandermonde Coding Matrix:</span>

  <span class="hljs-number">1</span>   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>
  <span class="hljs-number">1</span> <span class="hljs-number">217</span>  <span class="hljs-number">92</span> <span class="hljs-number">172</span>
  <span class="hljs-number">1</span>  <span class="hljs-number">70</span> <span class="hljs-number">143</span> <span class="hljs-number">200</span>
</code></pre>
<h3 id="例10：使用Anvin优化的RAID-6矩阵"><a href="#例10：使用Anvin优化的RAID-6矩阵" class="headerlink" title="例10：使用Anvin优化的RAID-6矩阵"></a>例10：使用Anvin优化的RAID-6矩阵</h3><p><code>\Example\reed_sol_03.c</code></p>
<p>输入参数：k w seed</p>
<pre><code class="hljs angelscript">./reed_sol_03 <span class="hljs-number">4</span> <span class="hljs-number">8</span> <span class="hljs-number">100</span></code></pre>
<pre><code class="hljs apache"><span class="hljs-attribute">Last</span> <span class="hljs-number">2</span> rows of the Generator Matrix:

  <span class="hljs-attribute">1</span>   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>   <span class="hljs-number">1</span>
  <span class="hljs-attribute">1</span>   <span class="hljs-number">2</span>   <span class="hljs-number">4</span>   <span class="hljs-number">8</span>

<span class="hljs-attribute">Encoding</span> Complete:

<span class="hljs-attribute">Data</span>                            Coding
<span class="hljs-attribute">D0</span> : <span class="hljs-number">8</span>b <span class="hljs-number">03</span> <span class="hljs-number">14</span> e<span class="hljs-number">7</span> <span class="hljs-number">85</span> ee <span class="hljs-number">42</span> c<span class="hljs-number">5</span>    C<span class="hljs-number">0</span> : a<span class="hljs-number">4</span> <span class="hljs-number">24</span> <span class="hljs-number">86</span> dd f<span class="hljs-number">1</span> ab <span class="hljs-number">31</span> f<span class="hljs-number">6</span>
<span class="hljs-attribute">D1</span> : <span class="hljs-number">7</span>d <span class="hljs-number">58</span> <span class="hljs-number">3</span>a <span class="hljs-number">05</span> ea b<span class="hljs-number">1</span> a<span class="hljs-number">7</span> <span class="hljs-number">77</span>    C<span class="hljs-number">1</span> : cc c<span class="hljs-number">1</span> fc de b<span class="hljs-number">5</span> <span class="hljs-number">61</span> <span class="hljs-number">80</span> <span class="hljs-number">7</span>a
<span class="hljs-attribute">D2</span> : <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">26</span> <span class="hljs-number">69</span> c<span class="hljs-number">3</span> <span class="hljs-number">47</span> b<span class="hljs-number">9</span> <span class="hljs-number">49</span>    
<span class="hljs-attribute">D3</span> : <span class="hljs-number">16</span> <span class="hljs-number">5</span>b <span class="hljs-number">8</span>e <span class="hljs-number">56</span> <span class="hljs-number">5</span>d b<span class="hljs-number">3</span> <span class="hljs-number">6</span>d <span class="hljs-number">0</span>d    

<span class="hljs-attribute">Erased</span> <span class="hljs-number">2</span> random devices:

<span class="hljs-attribute">Data</span>                            Coding
<span class="hljs-attribute">D0</span> : <span class="hljs-number">8</span>b <span class="hljs-number">03</span> <span class="hljs-number">14</span> e<span class="hljs-number">7</span> <span class="hljs-number">85</span> ee <span class="hljs-number">42</span> c<span class="hljs-number">5</span>    C<span class="hljs-number">0</span> : <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>
<span class="hljs-attribute">D1</span> : <span class="hljs-number">7</span>d <span class="hljs-number">58</span> <span class="hljs-number">3</span>a <span class="hljs-number">05</span> ea b<span class="hljs-number">1</span> a<span class="hljs-number">7</span> <span class="hljs-number">77</span>    C<span class="hljs-number">1</span> : cc c<span class="hljs-number">1</span> fc de b<span class="hljs-number">5</span> <span class="hljs-number">61</span> <span class="hljs-number">80</span> <span class="hljs-number">7</span>a
<span class="hljs-attribute">D2</span> : <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">26</span> <span class="hljs-number">69</span> c<span class="hljs-number">3</span> <span class="hljs-number">47</span> b<span class="hljs-number">9</span> <span class="hljs-number">49</span>    
<span class="hljs-attribute">D3</span> : <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>    

<span class="hljs-attribute">State</span> of the system after decoding:

<span class="hljs-attribute">Data</span>                            Coding
<span class="hljs-attribute">D0</span> : <span class="hljs-number">8</span>b <span class="hljs-number">03</span> <span class="hljs-number">14</span> e<span class="hljs-number">7</span> <span class="hljs-number">85</span> ee <span class="hljs-number">42</span> c<span class="hljs-number">5</span>    C<span class="hljs-number">0</span> : a<span class="hljs-number">4</span> <span class="hljs-number">24</span> <span class="hljs-number">86</span> dd f<span class="hljs-number">1</span> ab <span class="hljs-number">31</span> f<span class="hljs-number">6</span>
<span class="hljs-attribute">D1</span> : <span class="hljs-number">7</span>d <span class="hljs-number">58</span> <span class="hljs-number">3</span>a <span class="hljs-number">05</span> ea b<span class="hljs-number">1</span> a<span class="hljs-number">7</span> <span class="hljs-number">77</span>    C<span class="hljs-number">1</span> : cc c<span class="hljs-number">1</span> fc de b<span class="hljs-number">5</span> <span class="hljs-number">61</span> <span class="hljs-number">80</span> <span class="hljs-number">7</span>a
<span class="hljs-attribute">D2</span> : <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">26</span> <span class="hljs-number">69</span> c<span class="hljs-number">3</span> <span class="hljs-number">47</span> b<span class="hljs-number">9</span> <span class="hljs-number">49</span>    
<span class="hljs-attribute">D3</span> : <span class="hljs-number">16</span> <span class="hljs-number">5</span>b <span class="hljs-number">8</span>e <span class="hljs-number">56</span> <span class="hljs-number">5</span>d b<span class="hljs-number">3</span> <span class="hljs-number">6</span>d <span class="hljs-number">0</span>d</code></pre>
<p>它主要使用的是<strong>reed sol r6 encode()</strong>, <strong>reed sol r6 coding matrix()</strong>, 两个函数。</p>
<h3 id="例11：快速乘法"><a href="#例11：快速乘法" class="headerlink" title="例11：快速乘法"></a>例11：快速乘法</h3><p><code>\Example\reed_sol_04.c</code></p>
<p>输入参数：w seed</p>
<pre><code class="hljs angelscript">./reed_sol_04 <span class="hljs-number">8</span> <span class="hljs-number">100</span></code></pre>
<pre><code class="hljs angelscript">Char  <span class="hljs-number">0</span>: <span class="hljs-number">139</span> *<span class="hljs-number">2</span> =  <span class="hljs-number">11</span>
Char  <span class="hljs-number">1</span>:   <span class="hljs-number">3</span> *<span class="hljs-number">2</span> =   <span class="hljs-number">6</span>
Char  <span class="hljs-number">2</span>:  <span class="hljs-number">20</span> *<span class="hljs-number">2</span> =  <span class="hljs-number">40</span>
Char  <span class="hljs-number">3</span>: <span class="hljs-number">231</span> *<span class="hljs-number">2</span> = <span class="hljs-number">211</span>
Char  <span class="hljs-number">4</span>: <span class="hljs-number">133</span> *<span class="hljs-number">2</span> =  <span class="hljs-number">23</span>
Char  <span class="hljs-number">5</span>: <span class="hljs-number">238</span> *<span class="hljs-number">2</span> = <span class="hljs-number">193</span>
Char  <span class="hljs-number">6</span>:  <span class="hljs-number">66</span> *<span class="hljs-number">2</span> = <span class="hljs-number">132</span>
Char  <span class="hljs-number">7</span>: <span class="hljs-number">197</span> *<span class="hljs-number">2</span> = <span class="hljs-number">151</span>
Char  <span class="hljs-number">8</span>: <span class="hljs-number">125</span> *<span class="hljs-number">2</span> = <span class="hljs-number">250</span>
Char  <span class="hljs-number">9</span>:  <span class="hljs-number">88</span> *<span class="hljs-number">2</span> = <span class="hljs-number">176</span>
Char <span class="hljs-number">10</span>:  <span class="hljs-number">58</span> *<span class="hljs-number">2</span> = <span class="hljs-number">116</span>
Char <span class="hljs-number">11</span>:   <span class="hljs-number">5</span> *<span class="hljs-number">2</span> =  <span class="hljs-number">10</span>
Char <span class="hljs-number">12</span>: <span class="hljs-number">234</span> *<span class="hljs-number">2</span> = <span class="hljs-number">201</span>
Char <span class="hljs-number">13</span>: <span class="hljs-number">177</span> *<span class="hljs-number">2</span> = <span class="hljs-number">127</span>
Char <span class="hljs-number">14</span>: <span class="hljs-number">167</span> *<span class="hljs-number">2</span> =  <span class="hljs-number">83</span>
Char <span class="hljs-number">15</span>: <span class="hljs-number">119</span> *<span class="hljs-number">2</span> = <span class="hljs-number">238</span>
</code></pre>
<h2 id="1-4-柯西编码矩阵"><a href="#1-4-柯西编码矩阵" class="headerlink" title="1.4 柯西编码矩阵"></a>1.4 柯西编码矩阵</h2><p><code>cauchy.h/cauchy.c</code></p>
<ul>
<li>构建一个普通的柯西编码矩阵，$M[i,j]=\frac{1}{i\oplus(m+j)}$;</li>
<li>对每一列j，将每一列除以$M[0,j]$，这样的话，行0的每个元素就会变为1.</li>
<li>之后，对于行$i&gt;0$:<ul>
<li>计算二进制下，每行1的数目；</li>
<li>除以元素$M [i,j]$的1后，计算二进制下，每行1的数目；</li>
<li>只要j取值使得1的数目增加，就把行i除上$M[i,j]$；</li>
</ul>
</li>
</ul>
<p>例如$k=m=w=3$下，我们得到如下初始柯西矩阵：</p>
<pre><code class="hljs basic"><span class="hljs-symbol">6 </span><span class="hljs-number">7</span> <span class="hljs-number">2</span>
<span class="hljs-symbol">5 </span><span class="hljs-number">2</span> <span class="hljs-number">7</span>
<span class="hljs-symbol">1 </span><span class="hljs-number">3</span> <span class="hljs-number">4</span></code></pre>
<blockquote>
<p>下面我们详细讲解一下包含最少1的cauchy good矩阵是如何得到的。</p>
<p>首先在前提下，我们写出位矩阵和对应的1的个数：</p>
<pre><code class="hljs yaml">  <span class="hljs-number">100</span> 	<span class="hljs-number">001</span> 	<span class="hljs-number">010</span>		<span class="hljs-number">101</span>		<span class="hljs-number">011</span>		<span class="hljs-number">111</span>		<span class="hljs-number">110</span>
  <span class="hljs-number">010</span>		<span class="hljs-number">101</span>		<span class="hljs-number">011</span>		<span class="hljs-number">111</span>		<span class="hljs-number">110</span>		<span class="hljs-number">100</span>		<span class="hljs-number">001</span>
  <span class="hljs-number">001</span>		<span class="hljs-number">010</span>		<span class="hljs-number">101</span>		<span class="hljs-number">011</span>		<span class="hljs-number">111</span>		<span class="hljs-number">110</span>		<span class="hljs-number">100</span>
<span class="hljs-string">&gt;(dec)</span>    <span class="hljs-number">1</span>		 <span class="hljs-number">2</span>		 <span class="hljs-number">4</span>		 <span class="hljs-number">3</span> 		 <span class="hljs-number">6</span>  	 <span class="hljs-number">7</span> 		 <span class="hljs-number">5</span>
<span class="hljs-string">&gt;(num_1&#x27;s)3</span>		 <span class="hljs-number">4</span>		 <span class="hljs-number">5</span> 		 <span class="hljs-number">7</span>		 <span class="hljs-number">7</span>		 <span class="hljs-number">6</span>		 <span class="hljs-number">4</span>

<span class="hljs-string">&gt;step1:原始矩阵，如果我们对第1行分别除上第一列的元素：</span>

<span class="hljs-string">&gt;1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span>
<span class="hljs-string">&gt;4</span> <span class="hljs-number">3</span> <span class="hljs-number">6</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">total</span> <span class="hljs-number">1</span><span class="hljs-string">&#x27;s = 5 + 7 + 7 = 19 </span>
<span class="hljs-string">&gt;3 7 2 </span>
<span class="hljs-string"></span>
<span class="hljs-string">&gt;step2:再对第二行除上每个元素以找到最少1的那个，</span>
<span class="hljs-string">&gt;(a) 除上4.</span>
<span class="hljs-string">&gt;1 1 1</span>
<span class="hljs-string">&gt;1 2 4 -&gt; total 1&#x27;</span><span class="hljs-string">s</span> <span class="hljs-string">=</span> <span class="hljs-number">3</span> <span class="hljs-string">+</span> <span class="hljs-number">4</span> <span class="hljs-string">+</span> <span class="hljs-number">5</span> <span class="hljs-string">=</span> <span class="hljs-number">12</span> 
<span class="hljs-string">&gt;3</span> <span class="hljs-number">7</span> <span class="hljs-number">2</span>

<span class="hljs-string">&gt;(b)</span> <span class="hljs-string">除上3.</span>
<span class="hljs-string">&gt;1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> 
<span class="hljs-string">&gt;5</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">total</span> <span class="hljs-number">1</span><span class="hljs-string">&#x27;s = 4 + 3 + 4 = 11</span>
<span class="hljs-string">&gt;3 7 2 </span>
<span class="hljs-string"></span>
<span class="hljs-string">&gt;(c) 除上6.</span>
<span class="hljs-string">&gt;1 1 1 </span>
<span class="hljs-string">&gt;7 5 1 -&gt; total 1&#x27;</span><span class="hljs-string">s</span> <span class="hljs-string">=</span> <span class="hljs-number">6</span> <span class="hljs-string">+</span> <span class="hljs-number">4</span> <span class="hljs-string">+</span> <span class="hljs-number">3</span> <span class="hljs-string">=</span> <span class="hljs-number">13</span>
<span class="hljs-string">&gt;3</span> <span class="hljs-number">7</span> <span class="hljs-number">2</span> 
<span class="hljs-string">&gt;可知除上3得到的矩阵1的数目最少。</span>
<span class="hljs-string">&gt;step3:对第三行也进行类似于第二步的操作，最终我们得到cauchy</span> <span class="hljs-string">good矩阵</span>
<span class="hljs-string">&gt;1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-string">-&gt;</span> <span class="hljs-number">3</span><span class="hljs-string">+3+3=9</span>
<span class="hljs-string">&gt;5</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-string">-&gt;</span> <span class="hljs-number">4</span><span class="hljs-string">+3+4=11</span>
<span class="hljs-string">&gt;3</span> <span class="hljs-number">7</span> <span class="hljs-number">2</span> <span class="hljs-string">-&gt;</span> <span class="hljs-number">3</span><span class="hljs-string">+5+6=14</span>
<span class="hljs-string">&gt;一共是</span> <span class="hljs-number">9</span><span class="hljs-string">+13+14=34个1</span>
<span class="hljs-string">&gt;原始矩阵有46个1，而[PX06]给出</span> <span class="hljs-string">的矩阵有39个1，我们的矩阵明显更优秀一些。</span></code></pre>
</blockquote>
<ul>
<li><p><code>int *cauchy_original_coding_matrix(k,m,w)</code></p>
<p>返回柯西编码矩阵的原始形式。</p>
</li>
<li><p><code>int *cauchy_xy_coding_matrix(k,m,w,int*X, int *Y)</code></p>
<p>指定集合X，Y创建柯西矩阵。集合X拥有m个元素，集合Y有k个元素。集合没有重复元素，并且两个集合没有交集。</p>
</li>
<li><p><code>void cauchy_improve_coding_matrix(k,m,w,matrix)</code></p>
<p>这个提升在于，先将每一列除上0行元素。</p>
</li>
<li><p><code>int *cauchy_good_general_coding_matrix()</code></p>
<p>这会返回一个好矩阵，当$m=2，w\le 11, k\le 1023$，它会返回最优的RAID-6 矩阵。它会引用最前面两个函数。</p>
</li>
<li><p><code>int cauchy_n_ones(int n, int w)</code>:</p>
<p>这将返回$GF(2^w)$中数字n的位矩阵表示形式中的1。 它比生成位矩阵和计数位要有效得多。</p>
</li>
</ul>
<h3 id="例12：计算柯西位矩阵块1的个数"><a href="#例12：计算柯西位矩阵块1的个数" class="headerlink" title="例12：计算柯西位矩阵块1的个数"></a>例12：计算柯西位矩阵块1的个数</h3><p><code>\Example\cauchy_01.c</code></p>
<p>输入：n,w</p>
<p>输出：位矩阵和1的个数。</p>
<pre><code class="hljs angelscript">./cauchy_01 <span class="hljs-number">5</span> <span class="hljs-number">3</span></code></pre>
<pre><code class="hljs apache"><span class="hljs-section">&lt;HTML&gt;</span><span class="hljs-section">&lt;title&gt;</span><span class="hljs-attribute">cauchy_01</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span>&lt;/title&gt;
<span class="hljs-section">&lt;HTML&gt;</span><span class="hljs-section">&lt;h3&gt;</span><span class="hljs-attribute">cauchy_01</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span>&lt;/h<span class="hljs-number">3</span>&gt;
<span class="hljs-section">&lt;pre&gt;</span>
<span class="hljs-attribute">Converted</span> the value <span class="hljs-number">5</span> (<span class="hljs-number">0</span>x<span class="hljs-number">5</span>) to the following bitmatrix:

<span class="hljs-attribute">110</span>
<span class="hljs-attribute">001</span>
<span class="hljs-attribute">100</span>

<span class="hljs-comment"># Ones: 4</span>
</code></pre>
<h3 id="例13：柯西位矩阵编解码"><a href="#例13：柯西位矩阵编解码" class="headerlink" title="例13：柯西位矩阵编解码"></a>例13：柯西位矩阵编解码</h3><p><code>\Example\cauchy_02.c</code></p>
<p>输入：k,m,w,seed</p>
<p>在该例子，packetsize为4. 它首先执行<code>cauchy_original_coding_matrix()</code>来创建一个柯西矩阵，之后转化为位矩阵并编码两次：第一次是<code>jerasure_matrix_encode()</code>，第二次是异或次数更少的<code>jerasure_schedule_encode()</code>。同样它也解码两次，分布调用<code>jerasure_bitmatrix_decode()</code>和<code>jerasure_schedule_decode_lazy()</code></p>
<pre><code class="hljs angelscript">./cauchy_02 <span class="hljs-number">3</span> <span class="hljs-number">3</span> <span class="hljs-number">3</span> <span class="hljs-number">100</span></code></pre>
<p><img src="/img/image-20210131182921044.png" srcset="/img/loading.gif" alt="image-20210131182921044"></p>
<p><img src="/img/image-20210131182947015.png" srcset="/img/loading.gif" alt="image-20210131182947015"></p>
<h3 id="-2"><a href="#-2" class="headerlink" title=" "></a> </h3><h3 id="例14：改进的柯西位矩阵编解码"><a href="#例14：改进的柯西位矩阵编解码" class="headerlink" title="例14：改进的柯西位矩阵编解码"></a>例14：改进的柯西位矩阵编解码</h3><p><code>\Example\cauchy_03.c</code></p>
<p>功能与例13相同。它使用<code>cauchy_xy_coding_matrix()</code>创建矩阵，并使用<code>cauchy_improve_coding_matrix</code>进行优化。</p>
<p><img src="/img/image-20210131184008267.png" srcset="/img/loading.gif" alt="image-20210131184008267"></p>
<p><img src="/img/image-20210131184030092.png" srcset="/img/loading.gif" alt="image-20210131184030092"></p>
<p>可以看到异或运算从296次减少到200次，优化效果明显。</p>
<h3 id="例15：最好的柯西编码矩阵"><a href="#例15：最好的柯西编码矩阵" class="headerlink" title="例15：最好的柯西编码矩阵"></a>例15：最好的柯西编码矩阵</h3><p><code>\Example\cauchy_04.c</code></p>
<p>功能与例13相同。它使用的是<code>cauchy_good_general_coding_matrix()</code>。注意：在$m = 2,w\le11, k\le 1023$这些都是最优的柯西编码矩阵（但不是最优的RAID-6矩阵）。</p>
<h3 id="1-4-1-扩展最优Cauchy-RAID-6矩阵的参数空间"><a href="#1-4-1-扩展最优Cauchy-RAID-6矩阵的参数空间" class="headerlink" title="1.4.1 扩展最优Cauchy RAID-6矩阵的参数空间"></a>1.4.1 扩展最优Cauchy RAID-6矩阵的参数空间</h3><p>很容易证明，只要$k &lt;2^w$，那么第0行中全为1并且第1行中具有不同非零元素的任何矩阵都是有效的MDS RAID-6 矩阵。 因此，对于给定值w的最佳RAID-6矩阵是这样的矩阵，其第1行中的k个元素是在其位矩阵中数量最少的k个元素。  <code>Cauchy.c</code>将这些元素存储在$k≤1023$和$w≤11$的全局变量中。文件<code>cauchy_best_r6.c</code>与<code>cauchy.c</code>相同，只不过它包括<code>w≤32</code>的这些值。<br>   这些值不在cauchy.c中的原因仅仅是为了减小目标文件的大小。</p>
<h2 id="1-5-最小密度RAID-6-编码"><a href="#1-5-最小密度RAID-6-编码" class="headerlink" title="1.5 最小密度RAID-6 编码"></a>1.5 最小密度RAID-6 编码</h2><p>最小密度RAID-6代码是基于位矩阵的MDS代码，该二进制矩阵满足非零数的下限。 与柯西编码不同，位矩阵元素不对应于GF(2^w)中的元素。 取而代之的是，位矩阵本身具有适当的MDS属性。 对于相同的参数，最小密度RAID-6代码的执行速度比Reed-Solomon和Cauchy Reed-Solomon代码快。  Liberation编码，Liber8tion编码和Blaum-Roth编码是jerasure支持的这种编码的三个示例。<br>   对于这些代码中的每一个，m必须等于2，k必须小于或等于w。  w的值受代码[PBV11]的限制：</p>
<p>​    •对于Liberation编码，w必须是质数。<br>   •对于Blaum-Roth编码，w +1必须是质数。<br>   •对于Liber8tion编码，w必须等于8。</p>
<p><code>liberation.c\liberation.h</code>实现了如下步骤：</p>
<ul>
<li><code>int *liberation_coding_bitmatrix(k,w)</code></li>
</ul>
<p>这分配并返回用于自由编码的位矩阵。 尽管w必须是大于2的质数，但此过程未强制执行。 如果给它一个非素数w，则将获得一个非MDS编码矩阵。</p>
<ul>
<li><code>int *liber8tion_coding_bitmatrix(int k)</code></li>
</ul>
<p>这会分配并且返回针对libera8tion编码的矩阵。liber8tion中的8表示$w=8$。</p>
<ul>
<li><code>int *blaum_roth_coding_matrix(int k, int w)</code></li>
</ul>
<p>这会分配并且返回针对Blaum Roth的编码矩阵。</p>
<h3 id="-3"><a href="#-3" class="headerlink" title=" "></a> </h3><h3 id="例16：liberation编码矩阵"><a href="#例16：liberation编码矩阵" class="headerlink" title="例16：liberation编码矩阵"></a>例16：liberation编码矩阵</h3><p><code>\Example\liberation_01.c</code></p>
<p>输入参数：k, w, seed .</p>
<p>w是一个大于2的质数，且$k\le w$。</p>
<pre><code class="hljs angelscript">./liberation_01 <span class="hljs-number">3</span> <span class="hljs-number">3</span> <span class="hljs-number">100</span></code></pre>
<p><img src="/img/image-20210201151829328.png" srcset="/img/loading.gif" alt="image-20210201151829328"></p>
<p>可以看到同样的参数下，liberation码得到的矩阵明显更稀疏。编码产生的异或数更少，所以计算开销更少。</p>
<p>矩阵大小为$2w\times kw$，该码的特点为，前k+1个块都是单位矩阵，最后k-1个矩阵有些规律。</p>
<h3 id="例-17-文件编码解码"><a href="#例-17-文件编码解码" class="headerlink" title="例 17 文件编码解码"></a><strong>例 17</strong> 文件编码解码</h3><p><code>./Example/encode.c</code></p>
<ul>
<li>encoder.c编码文件：</li>
</ul>
<pre><code class="hljs 1c">./encoder &#x27;inputfile&#x27; k m &#x27;coding_technique&#x27; w (packetsize) (buffersize)</code></pre>
<p>‘inputfile’:  输入文件或负数S：要编码的文件或负数S，指示应使用大小为<code>-S</code>的随机文件而不是现有文件</p>
<p>k：将文件划分的数据块的数量</p>
<p>m：根据数据块生成的校验块的数量</p>
<p>coding_technique：使用的编码算法。</p>
<ul>
<li>“reed_sol_van”：范德蒙德RS码，w=8，16，32</li>
<li>“reed_sol_r6_op”：针对RAID-6优化的RS码，m=2，w=8，16，32</li>
<li>“cauchy_orig”：原生柯西编码</li>
<li>“cauchy_good”：优化的柯西编码</li>
<li>“liberation”：最小密度RAID-6中的liberation，k小于等于w，w大于2，且为质数</li>
<li>“blaum_roth”：最小密度RAID-6中的blaum roth，k小于等于w，w大于2，且w+1为质数</li>
<li>“liber8tion”：最小密度RAID-6中的liber8tion，k小于等于w，w=8，m=2</li>
<li>“no_coding”：无编码</li>
</ul>
<p>w：word size。</p>
<p>packet size：就是packet size 。一般为4的整数倍。</p>
<p>buffer size：每次处理的数据大小，例如1024。</p>
<p>例子：</p>
<pre><code class="hljs angelscript">./encoder /home/durantthorvalds/jerasure-master/test.pdf <span class="hljs-number">6</span> <span class="hljs-number">2</span> liberation <span class="hljs-number">7</span> <span class="hljs-number">1024</span> <span class="hljs-number">500000</span>
Encoding (MB/sec): <span class="hljs-number">3294.5325077314</span>
En_Total (MB/sec): <span class="hljs-number">372.5363687737</span>
</code></pre>
<pre><code class="hljs angelscript">drwxrwxrwx <span class="hljs-number">5</span> durantthorvalds durantthorvalds    <span class="hljs-number">4096</span>  <span class="hljs-number">2</span>月  <span class="hljs-number">1</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> ..
-rw-rw-r-- <span class="hljs-number">1</span> durantthorvalds durantthorvalds <span class="hljs-number">2637824</span>  <span class="hljs-number">2</span>月  <span class="hljs-number">1</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> test_k1.pdf
-rw-rw-r-- <span class="hljs-number">1</span> durantthorvalds durantthorvalds <span class="hljs-number">2637824</span>  <span class="hljs-number">2</span>月  <span class="hljs-number">1</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> test_k2.pdf
-rw-rw-r-- <span class="hljs-number">1</span> durantthorvalds durantthorvalds <span class="hljs-number">2637824</span>  <span class="hljs-number">2</span>月  <span class="hljs-number">1</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> test_k3.pdf
-rw-rw-r-- <span class="hljs-number">1</span> durantthorvalds durantthorvalds <span class="hljs-number">2637824</span>  <span class="hljs-number">2</span>月  <span class="hljs-number">1</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> test_k4.pdf
-rw-rw-r-- <span class="hljs-number">1</span> durantthorvalds durantthorvalds <span class="hljs-number">2637824</span>  <span class="hljs-number">2</span>月  <span class="hljs-number">1</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> test_k5.pdf
-rw-rw-r-- <span class="hljs-number">1</span> durantthorvalds durantthorvalds <span class="hljs-number">2637824</span>  <span class="hljs-number">2</span>月  <span class="hljs-number">1</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> test_k6.pdf
-rw-rw-r-- <span class="hljs-number">1</span> durantthorvalds durantthorvalds <span class="hljs-number">2637824</span>  <span class="hljs-number">2</span>月  <span class="hljs-number">1</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> test_m1.pdf
-rw-rw-r-- <span class="hljs-number">1</span> durantthorvalds durantthorvalds <span class="hljs-number">2637824</span>  <span class="hljs-number">2</span>月  <span class="hljs-number">1</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> test_m2.pdf
-rw-rw-r-- <span class="hljs-number">1</span> durantthorvalds durantthorvalds      <span class="hljs-number">90</span>  <span class="hljs-number">2</span>月  <span class="hljs-number">1</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> test_meta.txt
</code></pre>
<p>packetsize 为1k。这儿的6个数据文件大小刚好为源文件的大小.注意文件大小既是7的倍数，也是1024的倍数。</p>
<p>按照上述说明执行命令后，我们会发现在Examples文件夹中创建了一个Coding文件夹，顾名思义，这里存放着编码好的数据块和编码块，以及一个meta文件，存放文件的编码信息。每个数据块文件都会被命名为”_k#”（数据块）和”_m#”（校验块）然后跟着源文件的扩展名。例如 40kb-image.jpg 就会生成一个 40kb-image_k1.jpg。</p>
<p><code>test_meta.txt</code>是这次encoding的相关参数，这些参数将会用于decoding过程。</p>
<pre><code class="hljs angelscript">/home/durantthorvalds/jerasure-master/test.pdf
<span class="hljs-number">15431554</span>
<span class="hljs-number">6</span> <span class="hljs-number">2</span> <span class="hljs-number">7</span> <span class="hljs-number">1024</span> <span class="hljs-number">688128</span>
liberation
<span class="hljs-number">4</span>
<span class="hljs-number">23</span></code></pre>
<ul>
<li>decoder解码文件：</li>
</ul>
<pre><code class="hljs 1c">./decoder &#x27;inputfile&#x27;</code></pre>
<p>在解码之前，我们假设一种不幸的情况，有两个文件块丢失了。</p>
<pre><code class="hljs elixir">durantthorvalds<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~/jerasure-master/Examples/Coding</span><span class="hljs-variable">$ </span>rm test_k1.pdf test_m1.pdf

durantthorvalds<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~/jerasure-master/Examples</span><span class="hljs-variable">$ </span>./decoder /home/durantthorvalds/jerasure-master/test.pdf 
Decoding (MB/sec): <span class="hljs-number">3815.5760207509</span>
De_Total (MB/sec): <span class="hljs-number">818.9580808033</span>

durantthorvalds<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~/jerasure-master/Examples</span><span class="hljs-variable">$ </span>diff Coding/test_decoded.pdf /home/durantthorvalds/jerasure-master/test.pdf</code></pre>
<p><code>diff</code>没有输出表示两文件完全相同。</p>
<p>另外如果损坏文件数超过m，解码也会失败！</p>
<h2 id="1-6-合理地选择Buffer和Packetsize"><a href="#1-6-合理地选择Buffer和Packetsize" class="headerlink" title="1.6 合理地选择Buffer和Packetsize"></a>1.6 合理地选择Buffer和Packetsize</h2><p>在我们的测试中，缓冲区和数据包的大小对性能的影响与所使用的代码一样多。 多位作者（例如[PLS + 09，PGM13]）多次对此进行了演示。 以下时序使用Liberation代码对k = 6和w = 2的256MB随机创建的数据进行编码。这些时序于2014年在MacBook Pro上拍摄，并显示了数据包和缓冲区的大小如何影响性能。</p>
<pre><code class="hljs apache"><span class="hljs-attribute">UNIX</span>&gt; encoder -<span class="hljs-number">268435456</span> <span class="hljs-number">6</span> <span class="hljs-number">2</span> liberation <span class="hljs-number">7</span> <span class="hljs-number">1024</span> <span class="hljs-number">50000000</span>
<span class="hljs-attribute">Encoding</span> (MB/sec): <span class="hljs-number">1593</span>.<span class="hljs-number">9637842733</span>
<span class="hljs-attribute">En_Total</span> (MB/sec): <span class="hljs-number">672</span>.<span class="hljs-number">1876668353</span>
<span class="hljs-attribute">UNIX</span>&gt; encoder -<span class="hljs-number">268435456</span> <span class="hljs-number">6</span> <span class="hljs-number">2</span> liberation <span class="hljs-number">7</span> <span class="hljs-number">1024</span> <span class="hljs-number">5000000</span>
<span class="hljs-attribute">Encoding</span> (MB/sec): <span class="hljs-number">2490</span>.<span class="hljs-number">9393470499</span>
<span class="hljs-attribute">En_Total</span> (MB/sec): <span class="hljs-number">1383</span>.<span class="hljs-number">3866387346</span>
<span class="hljs-attribute">UNIX</span>&gt; encoder -<span class="hljs-number">268435456</span> <span class="hljs-number">6</span> <span class="hljs-number">2</span> liberation <span class="hljs-number">7</span> <span class="hljs-number">10240</span> <span class="hljs-number">5000000</span>
<span class="hljs-attribute">Encoding</span> (MB/sec): <span class="hljs-number">2824</span>.<span class="hljs-number">2836957036</span>
<span class="hljs-attribute">En_Total</span> (MB/sec): <span class="hljs-number">1215</span>.<span class="hljs-number">1816805228</span>
<span class="hljs-attribute">UNIX</span>&gt; encoder -<span class="hljs-number">268435456</span> <span class="hljs-number">6</span> <span class="hljs-number">2</span> liberation <span class="hljs-number">7</span> <span class="hljs-number">102400</span> <span class="hljs-number">5000000</span>
<span class="hljs-attribute">Encoding</span> (MB/sec): <span class="hljs-number">1969</span>.<span class="hljs-number">8973976058</span>
<span class="hljs-attribute">En_Total</span> (MB/sec): <span class="hljs-number">517</span>.<span class="hljs-number">6967197425</span></code></pre>
<p>结论是：</p>
<ul>
<li>在packetsize相同时，buffer越大，编码速度可能越快；</li>
<li>在buffersize相同时，packetsize越大，编码速度越快。</li>
</ul>
<h2 id="1-7-改变默认的伽罗华域"><a href="#1-7-改变默认的伽罗华域" class="headerlink" title="1.7 改变默认的伽罗华域"></a>1.7 改变默认的伽罗华域</h2><p>当我们需要改变本原多项式，或者其它类似操作就需要改参数。下面两个例子展示了这些。</p>
<p><code>reed_sol_test_gf</code>和<code>reed_sol_time_gf</code></p>
<p>输入：k，m，w，seed</p>
<p> 它至少需要五个命令行参数。 前四个是k，m，w和种子。 接下来是Galois字段的规范，该字段使用从GF-Complete的argv（）创建gf的过程。 如果给它一个短横线，它将选择默认值。 然后，程序创建用于Reed-Solomon编码的生成器矩阵，进行编码和解码，并确保解码成功。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E7%BA%A0%E5%88%A0%E7%A0%81/">纠删码</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/jerasure/">jerasure</a>
                    
                      <a class="hover-with-bg" href="/tags/%E7%BA%A0%E5%88%A0%E7%A0%81%E5%BA%93/">纠删码库</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/02/11/%E3%80%8C%E9%98%85%E8%AF%BB%E3%80%8D%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%9C%89%E8%B6%A3%E9%A2%98%E7%9B%AE%F0%9F%8E%A8/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">「阅读」程序员的有趣题目🎨</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/02/10/%E6%9C%80%E5%B0%8F%E5%AF%86%E5%BA%A6RAID-6%E7%BC%96%E7%A0%81/">
                        <span class="hidden-mobile">「理论」最小密度RAID-6编码</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    function loadValine() {
      addScript('https://cdn.staticfile.org/valine/1.4.14/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "8oX7VCxy9tyFQIvF8qwLorP0-gzGzoHsz",
          app_key: "F0939INl4cKXpCw2HgTIUb6B",
          placeholder: "说点什么,（支持Markdown）",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: false,
          recordIP: false,
          serverURLs: "https://8ox7vcxy.lc-cn-n1-shared.com",
        });
      });
    }
    waitElementVisible('vcomments', loadValine);
  </script>
  <noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments
      powered by Valine.</a></noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "「探秘」Jerasure那些事&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  








  <script  src="https://cdn.staticfile.org/mermaid/8.5.0/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>




  

  

  

  

  

  





<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!--<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>
</html>
