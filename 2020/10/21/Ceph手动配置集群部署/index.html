

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&quot;auto&quot;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="åšä¸»ï¼šæ¥è‡ªåä¸­ç§‘æŠ€å¤§å­¦å›½å®¶å…‰ç”µç ”ç©¶ä¸­å¿ƒçš„">
  <meta name="author" content="Durant">
  <meta name="keywords" content="">
  <title>ã€æ¨èã€‘Cephæ‰‹åŠ¨é…ç½®é›†ç¾¤éƒ¨ç½² - Durant Thorvalds çš„ç±³å¥‡å¦™å¦™å±‹</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.6.2/gitalk.css" />
  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                è”ç³»æˆ‘
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-10-21 00:00" pubdate>
        2020å¹´10æœˆ21æ—¥ å‡Œæ™¨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      21.3k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      292
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">ã€æ¨èã€‘Cephæ‰‹åŠ¨é…ç½®é›†ç¾¤éƒ¨ç½²</h1>
            
            <div class="markdown-body" id="post-body">
              <div class="note note-primary">
            <p>TODO: æœ€è¿‘ä¸€æ¬¡æ›´æ–° : 2020/11/21 21:11</p>
          </div>
<h1 id="å½“å‰æœ€æµè¡Œçš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿâ€”â€”Cephå°é²œ"><a href="#å½“å‰æœ€æµè¡Œçš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿâ€”â€”Cephå°é²œ" class="headerlink" title="å½“å‰æœ€æµè¡Œçš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿâ€”â€”Cephå°é²œ"></a>å½“å‰æœ€æµè¡Œçš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿâ€”â€”Cephå°é²œ</h1><blockquote>
<p>é¦–å…ˆä»‹ç»ä¸€äº›ä½¿ç”¨çš„ç½‘ç«™å¤‡æŸ¥ï¼Œå»ºè®®ä¿å­˜åˆ°chromeæ”¶è—å¤¹ï¼</p>
<p><a target="_blank" rel="noopener" href="http://ceph.org.cn/">Cephä¸­å›½ç¤¾åŒº</a>ï¼šåŒ…æ‹¬ä¸­æ–‡æ–‡æ¡£ï¼ˆéæœ€æ–°ï¼‰ï¼Œä»¥åŠæ–°é—»ç­‰ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/">æœ€æ–°çš„è‹±æ–‡æ–‡æ¡£</a>ï¼šæœ€æ–°çš„è‹±æ–‡æ–‡æ¡£ï¼ŒåŒ…æ‹¬nautiluså’ŒOctopusç‰ˆæœ¬ï¼Œä½ ä¸€å®šä¸æƒ³é”™è¿‡ï¼</p>
<p><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/api/">APIæ–‡æ¡£</a></p>
<p><a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/start/quick-start-preflight/#ntp">å¿«é€Ÿå®‰è£…å…¥é—¨</a>ï¼šé€‚åˆæ–°æ‰‹ï¼ŒåŒ…æ‹¬åŸºç¡€çš„é…ç½®ç­‰ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ceph/ceph">Cephæºç </a>ï¼šå–œæ¬¢gitçš„ç­’å­å¯ä»¥çœ‹è¿™å„¿ï¼ŒåŒ…æ‹¬ç¼–è¯‘æ­¥éª¤ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://tracker.ceph.com/">å®˜æ–¹çš„é—®é¢˜tracker</a>ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://tracker.ceph.com/projects/ceph/roadmap">å®˜æ–¹çš„roadmap</a>ï¼ˆç‰ˆæœ¬é—®é¢˜ï¼‰</p>
</blockquote>
<p>ä½ åœ¨å¯»æ‰¾ã€‚ã€‚ã€‚</p>
<p>æºç ç¼–è¯‘å¯ä»¥ç›´æ¥å» <a href="#here">è¿™å„¿</a></p>
<p><img src="\img\ceph-logo.png" srcset="/img/loading.gif" alt="Logo"></p>
<h2 id="ç‰ˆæœ¬é—®é¢˜"><a href="#ç‰ˆæœ¬é—®é¢˜" class="headerlink" title="ç‰ˆæœ¬é—®é¢˜"></a>ç‰ˆæœ¬é—®é¢˜</h2><ul>
<li>x.0.z - å¼€å‘ç‰ˆï¼ˆç»™æ—©æœŸæµ‹è¯•è€…å’Œå‹‡å£«ä»¬ï¼‰</li>
<li>x.1.z - å€™é€‰ç‰ˆï¼ˆç”¨äºæµ‹è¯•é›†ç¾¤ã€é«˜æ‰‹ä»¬ï¼‰</li>
<li>x.2.z - ç¨³å®šã€ä¿®æ­£ç‰ˆï¼ˆç»™ç”¨æˆ·ä»¬ï¼‰</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç‰ˆæœ¬åç§°</th>
<th>å‘è¡Œæ—¶é—´/EOL</th>
<th>å»ºè®®çš„éƒ¨ç½²å·¥å…·</th>
</tr>
</thead>
<tbody>
<tr>
<td>Argonaut ã€€0.48ç‰ˆæœ¬(LTS)</td>
<td>2012å¹´6æœˆ3æ—¥</td>
<td></td>
</tr>
<tr>
<td>Bobtail ã€€ã€€0.56ç‰ˆæœ¬(LTS)</td>
<td>2013å¹´1æœˆ1æ—¥</td>
<td></td>
</tr>
<tr>
<td>Cuttlefish  0.61ç‰ˆæœ¬</td>
<td>2013å¹´5æœˆ7æ—¥</td>
<td></td>
</tr>
<tr>
<td>Dumpling  0.67ç‰ˆæœ¬(LTS)</td>
<td>2013å¹´8æœˆ14æ—¥</td>
<td></td>
</tr>
<tr>
<td>Emperor ã€€ 0.72ç‰ˆæœ¬</td>
<td>2013å¹´11æœˆ9æ—¥</td>
<td></td>
</tr>
<tr>
<td>Firefly ã€€ã€€ 0.80ç‰ˆæœ¬(LTS)</td>
<td>2014å¹´5æœˆ</td>
<td></td>
</tr>
<tr>
<td>Giant ã€€ Stable</td>
<td>October 2014 - April 2015</td>
<td></td>
</tr>
<tr>
<td>Hammer   LTS</td>
<td>April 2015 - November 2016</td>
<td></td>
</tr>
<tr>
<td>Infernalis   Stable</td>
<td>November 2015 - June 2016</td>
<td></td>
</tr>
<tr>
<td>Jewel 10</td>
<td>2016å¹´4æœˆ</td>
<td>ceph-deploy</td>
</tr>
<tr>
<td>Kraken 11</td>
<td>2017å¹´10æœˆ</td>
<td>ceph-deploy</td>
</tr>
<tr>
<td>Luminous 12</td>
<td>2017å¹´10æœˆ</td>
<td>ceph-deploy</td>
</tr>
<tr>
<td>mimic 13</td>
<td>2018å¹´5æœˆ</td>
<td>ceph-deploy</td>
</tr>
<tr>
<td>Nautilus 14.2.12</td>
<td>2019å¹´3æœˆ /2021å¹´6æœˆ</td>
<td><a target="_blank" rel="noopener" href="https://rook.io/">Rook</a> (Kubernetes-preferred,fully integrated with new orchestration API,  docker-dependent)</td>
</tr>
<tr>
<td>Octopus 15.2.5</td>
<td>2020å¹´3æœˆ /2022å¹´6æœˆ</td>
<td><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/cephadm/#cephadm">Cephadm</a>ï¼ˆfully integrated with new orchestration API,  docker-dependentï¼‰</td>
</tr>
<tr>
<td>Pacific 16</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯¦è§</p>
<p><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/releases/general/">https://docs.ceph.com/en/latest/releases/general/</a></p>
<p>å¦‚æœä½ é‡åˆ°é—®é¢˜ï¼ŒNo problem,è¿™å„¿æœ‰ä¸€ä¸ªåºå¤§çš„ç¤¾åŒºæ¥ååŠ©ä½ ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/rados/troubleshooting/community/">Ceph ç¤¾åŒº</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/rados/troubleshooting/log-and-debug/">æ—¥å¿—å’Œè°ƒè¯•</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/rados/troubleshooting/troubleshooting-mon/">Troubleshooting Monitors</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/rados/troubleshooting/troubleshooting-osd/">Troubleshooting OSDs</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/rados/troubleshooting/troubleshooting-pg/">Troubleshooting PGs</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/rados/troubleshooting/memory-profiling/">Memory Profiling</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/rados/troubleshooting/cpu-profiling/">CPU Profiling</a></li>
</ul>
<h1 id="Quick-Deployment-å¿«é€Ÿéƒ¨ç½²"><a href="#Quick-Deployment-å¿«é€Ÿéƒ¨ç½²" class="headerlink" title="Quick Deployment:å¿«é€Ÿéƒ¨ç½²"></a>Quick Deployment:å¿«é€Ÿéƒ¨ç½²</h1><div class="note note-danger">
            <p>Important:</p><p>ceph-deploy ä¸å†ç»å¸¸æ€§ç»´æŠ¤ï¼Œ å¹¶ä¸”åœ¨é«˜äºNautilusçš„ç‰ˆæœ¬æ²¡æœ‰è¿›è¡Œè¿‡æµ‹è¯•ã€‚ä¸æ¨èä½¿ç”¨!</p>
          </div>
<p><strong>Cephadm</strong>ï¼šCephadmå®Œç¾æ”¯æŒæ–°çš„ç¼–æ’APIã€CLIå’Œä»ªè¡¨ç›˜ç‰¹æ€§ï¼Œå¯ç”¨äºå¿«é€Ÿéƒ¨ç½²OctopusåŠæ›´æ–°ç‰ˆæœ¬çš„Cephé›†ç¾¤ã€‚Cephadmæ›´åŠ ç®€å•ï¼Œä¸”ä¸ä¾èµ–å…¶å®ƒè‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ï¼Œä½†è¯¥å·¥å…·ä¸æ”¯æŒéƒ¨ç½²æ—§ç‰ˆæœ¬çš„Cephï¼ˆå¦‚14çš„Nautilusï¼‰ï¼Œæ‰€æœ‰Cephè¿›ç¨‹ä¹Ÿæ˜¯è¿è¡Œåœ¨å®¹å™¨ä¸­çš„ï¼Œæ„å‘³ç€åœ¨ä¿®æ”¹æºç çš„æƒ…å†µä¸‹è¿˜éœ€è¦åˆ¶ä½œæ–°çš„é•œåƒï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚<strong>å®˜æ–¹æ–‡æ¡£ä¸­æŒ‡å‡ºï¼ŒCephadmæš‚æ—¶ä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒã€‚</strong></p>
<p><strong>Rook</strong>ï¼šå¯ä»¥æŠŠCephéƒ¨ç½²åœ¨Kubernetesé›†ç¾¤ä¸­è¿è¡Œã€‚ä¸1ç±»ä¼¼çš„æ˜¯ï¼ŒCephä¹Ÿæ˜¯è¿è¡Œåœ¨å®¹å™¨ä¸­çš„ã€‚</p>
<blockquote>
<p>ä¸Šè¿°çš„ä¸¤ç§æ–¹æ³•éƒ½æ˜¯å®¹å™¨éƒ¨ç½²</p>
</blockquote>
<p>ç¬¬ä¸‰æ–¹éƒ¨ç½²å·¥å…·</p>
<p>ã€æ¨èğŸ‘ã€‘ <strong>ceph-ansible</strong>. å®ƒè¢«å¹¿æ³›ä½¿ç”¨ã€‚ceph-ansibleæœªä¸Nautliuså’ŒOctopusä¸­å¼•å…¥çš„æ–°çš„Orchestrator APIé›†æˆåœ¨ä¸€èµ·ï¼Œè¿™æ„å‘³ç€æ›´æ–°çš„ç®¡ç†åŠŸèƒ½å’Œä»ªè¡¨æ¿é›†æˆä¸å¯ç”¨ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/SUSE/DeepSea">DeepSea</a>ä½¿ç”¨Saltå®‰è£…Cephã€‚</p>
<p><a target="_blank" rel="noopener" href="https://jaas.ai/ceph-mon">jaas.ai/ceph-mon</a>ä½¿ç”¨Jujuå®‰è£…Cephã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/openstack/puppet-ceph">github.com/openstack/puppet-ceph</a> é€šè¿‡Puppetå®‰è£…Cephã€‚</p>
<p>å®˜æ–¹çš„æœ€ä½è¦æ±‚æ˜¯ <strong>3</strong> Monitors + <strong>3</strong> Managers + <strong>3</strong> OSDs ã€‚ æˆ‘ä»¬å°è¯•ç”¨è™šæ‹Ÿæœºæ­å»ºæœ€å°é›†ç¾¤ã€‚</p>
<p>åœ¨è¿è¡Œceph-monå®ˆæŠ¤ç¨‹åºçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿˜åº”è¯¥è®¾ç½®ä¸€ä¸ªceph-mgrå®ˆæŠ¤ç¨‹åºã€‚</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">è™šæ‹ŸæœºèŠ‚ç‚¹åç§°</th>
<th style="text-align:center">èŒè´£</th>
<th style="text-align:center">IPåœ°å€</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ceph-master (w/ source-code compiled)</td>
<td style="text-align:center">mon0 + mgr0+osd0(éƒ¨ç½²èŠ‚ç‚¹)</td>
<td style="text-align:center">192.168.161.134</td>
</tr>
<tr>
<td style="text-align:center">ceph-node1</td>
<td style="text-align:center">mon1+mgr1</td>
<td style="text-align:center">192.168.161.130</td>
</tr>
<tr>
<td style="text-align:center">ceph-node2</td>
<td style="text-align:center">mon2+mgr2</td>
<td style="text-align:center">192.168.161.131</td>
</tr>
<tr>
<td style="text-align:center">ceph-osd1</td>
<td style="text-align:center">osd1</td>
<td style="text-align:center">192.168.161.132</td>
</tr>
<tr>
<td style="text-align:center">ceph-osd2</td>
<td style="text-align:center">osd2</td>
<td style="text-align:center">192.168.161.133</td>
</tr>
</tbody>
</table>
</div>
<div class="note note-primary">
            <p>å°æŠ€å·§ï¼šæˆ‘ä»¬å¯ä»¥å…ˆåœ¨1å°è™šæ‹Ÿæœºä¸Šé…ç½®å¥½é€šç”¨çš„é¢„å¤‡ç¯å¢ƒï¼Œå†å…‹éš†å‡ºå¦å¤–çš„2å°ï¼Œéšåè°ƒæ•´éƒ¨åˆ†é…ç½®åå³å¯ï¼ˆå¦‚IPã€ä¸»æœºåç­‰ï¼‰ã€‚å…‹éš†åè®°å¾—é‡æ–°ç”Ÿæˆç½‘å¡MACåœ°å€</p>
          </div>
<h3 id="å®‰è£…å‰å‡†å¤‡"><a href="#å®‰è£…å‰å‡†å¤‡" class="headerlink" title="å®‰è£…å‰å‡†å¤‡"></a>å®‰è£…å‰å‡†å¤‡</h3><p>å…³é—­firewalldï¼Œè®¾ç½®selinuxä¸ºdisabledçŠ¶æ€ï¼Œè®¾ç½®sshå…å¯†ç™»å½•ï¼Œé…ç½®æ—¶é’ŸåŒæ­¥æœåŠ¡ã€‚</p>
<blockquote>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://blog.51cto.com/14210294/2353243">https://blog.51cto.com/14210294/2353243</a></p>
</blockquote>
<pre><code class="hljs nginx"><span class="hljs-attribute">sudo</span> ufw status<span class="hljs-comment">#æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ active:å¼€å¯ inactiveï¼šå…³é—­</span></code></pre>
<pre><code class="hljs puppet"><span class="hljs-comment"># monä½œä¸ºæ§åˆ¶èŠ‚ç‚¹</span>
sudo apt install openssh-server
ssh-keygen -t rsa 
ssh-copy-<span class="hljs-keyword">id</span> &#123;<span class="hljs-built_in">hostname</span>&#125;@&#123;ip&#125;<span class="hljs-comment">#å¤åˆ¶å¯†é’¥åˆ°å„èŠ‚ç‚¹</span>
<span class="hljs-keyword">ssh</span> &#123;<span class="hljs-built_in">hostname</span>&#125;@&#123;ip&#125;</code></pre>
<p>monèŠ‚ç‚¹ä½œä¸ºæ—¶é’ŸåŒæ­¥èŠ‚ç‚¹</p>
<pre><code class="hljs stylus">sudo apt install ntp
sudo vim /etc/ntp.conf
#åœ¨/etc/ntp.confæ·»åŠ 
<span class="hljs-selector-id">#server</span> <span class="hljs-number">127.127</span>.<span class="hljs-number">1.0</span>
<span class="hljs-selector-id">#fudge</span> <span class="hljs-number">127.127</span>.<span class="hljs-number">1.0</span> stratum <span class="hljs-number">10</span>
#å¹¶æ³¨é‡Šä¸‹åˆ—å››è¡Œ
<span class="hljs-selector-id">#pool</span> <span class="hljs-number">0</span><span class="hljs-selector-class">.ubuntu</span><span class="hljs-selector-class">.pool</span><span class="hljs-selector-class">.ntp</span><span class="hljs-selector-class">.org</span> iburst
<span class="hljs-selector-id">#pool</span> <span class="hljs-number">1</span><span class="hljs-selector-class">.ubuntu</span><span class="hljs-selector-class">.pool</span><span class="hljs-selector-class">.ntp</span><span class="hljs-selector-class">.org</span> iburst
<span class="hljs-selector-id">#pool</span> <span class="hljs-number">2</span><span class="hljs-selector-class">.ubuntu</span><span class="hljs-selector-class">.pool</span><span class="hljs-selector-class">.ntp</span><span class="hljs-selector-class">.org</span> iburst
<span class="hljs-selector-id">#pool</span> <span class="hljs-number">3</span><span class="hljs-selector-class">.ubuntu</span><span class="hljs-selector-class">.pool</span><span class="hljs-selector-class">.ntp</span><span class="hljs-selector-class">.org</span> iburst</code></pre>
<p>åœ¨å…¶å®ƒèŠ‚ç‚¹</p>
<pre><code class="hljs routeros">sudo apt install ntpdate
sudo /etc/init.d<span class="hljs-built_in">/ntp </span>restart 
sudo systemctl <span class="hljs-builtin-name">enable</span> ntp.service #å¯åŠ¨ntp
sudo ntpdate &#123;mon-hostname&#125;</code></pre>
<p>ä¼šå¾—åˆ°çŸ«æ­£çš„æ—¶é—´</p>
<pre><code class="hljs routeros">Nov 06:31:02 ntpdate[8540]: adjust time<span class="hljs-built_in"> server </span>192.168.161.129 offset 0.097653 sec</code></pre>
<p>æœ‰å¯èƒ½å‡ºç° name or server not known é”™è¯¯</p>
<p>åœ¨æ¯ä¸ªèŠ‚ç‚¹ \etc\hosts åŠ å…¥æ‰€æœ‰å…¶å®ƒèŠ‚ç‚¹æ˜ å°„ï¼Œæ¯”å¦‚</p>
<pre><code class="hljs accesslog"><span class="hljs-number">192.168.161.129</span>  ceph-master</code></pre>
<p>å†ping æˆ–è€… nslookupæµ‹è¯•ä¸€ä¸‹å°±è¡Œã€‚</p>
<div class="note note-warning">
            <p>ä¸è¦åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹åŒæ—¶å®‰è£…ntpå’Œntpdate</p>
          </div>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥å’ŒaliyunæœåŠ¡å™¨åŒæ­¥ï¼Œåœ¨ntp.confæœ«å°¾åŠ ä¸Š<code>server ntp.aliyun.com</code></p>
<p>å†é‡å¯</p>
<pre><code class="hljs routeros">sudo /etc/init.d<span class="hljs-built_in">/ntp </span>restart</code></pre>
<p>æµ‹è¯•èƒ½å¦è¿é€šå…¶å®ƒèŠ‚ç‚¹</p>
<pre><code class="hljs routeros">ansible all -m<span class="hljs-built_in"> ping </span>#æ³¨æ„è¿™å„¿ä¸èƒ½åŠ sudoï¼Œå¦åˆ™ä¼špermission denied</code></pre>
<p>å¦‚æœæ²¡æœ‰é—®é¢˜</p>
<pre><code class="hljs arcade">node1 | <span class="hljs-function"><span class="hljs-params">SUCCESS</span> =&gt;</span> &#123;
    <span class="hljs-string">&quot;ansible_facts&quot;</span>: &#123;
        <span class="hljs-string">&quot;discovered_interpreter_python&quot;</span>: <span class="hljs-string">&quot;/usr/bin/python&quot;</span>
    &#125;,
    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;ping&quot;</span>: <span class="hljs-string">&quot;pong&quot;</span>
&#125;
node2 | <span class="hljs-function"><span class="hljs-params">SUCCESS</span> =&gt;</span> &#123;
    <span class="hljs-string">&quot;ansible_facts&quot;</span>: &#123;
        <span class="hljs-string">&quot;discovered_interpreter_python&quot;</span>: <span class="hljs-string">&quot;/usr/bin/python3&quot;</span>
    &#125;,
    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;ping&quot;</span>: <span class="hljs-string">&quot;pong&quot;</span>
&#125;
node3 | <span class="hljs-function"><span class="hljs-params">SUCCESS</span> =&gt;</span> &#123;
    <span class="hljs-string">&quot;ansible_facts&quot;</span>: &#123;
        <span class="hljs-string">&quot;discovered_interpreter_python&quot;</span>: <span class="hljs-string">&quot;/usr/bin/python3&quot;</span>
    &#125;,
    <span class="hljs-string">&quot;changed&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;ping&quot;</span>: <span class="hljs-string">&quot;pong&quot;</span>
&#125;</code></pre>
<h2 id="ceph-ansible-ğŸ˜"><a href="#ceph-ansible-ğŸ˜" class="headerlink" title="ceph-ansible ğŸ˜"></a>ceph-ansible <a target="_blank" rel="noopener" href="https://docs.ceph.com/projects/ceph-ansible/en/latest/index.html#configuration-and-usage">ğŸ˜</a></h2><blockquote>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zyxnhr/p/10543814.html">https://www.cnblogs.com/zyxnhr/p/10543814.html</a> å†™çš„éå¸¸ç»†è‡´ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/liuzhupeng/article/details/106767126">https://blog.csdn.net/liuzhupeng/article/details/106767126</a></p>
</blockquote>
<p> ä¸‰è¦ç´ ï¼šinventory file, playbook and configurationã€‚</p>
<p>Dependency: <code>python2</code>æ‰€æœ‰èŠ‚ç‚¹</p>
<ol>
<li><h3 id="æˆ‘ä»¬é¦–å…ˆå®‰è£…ceph-ansble"><a href="#æˆ‘ä»¬é¦–å…ˆå®‰è£…ceph-ansble" class="headerlink" title="æˆ‘ä»¬é¦–å…ˆå®‰è£…ceph-ansble."></a>æˆ‘ä»¬é¦–å…ˆå®‰è£…ceph-ansble.</h3></li>
</ol>
<pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/ceph/</span>ceph-ansible.git
git checkout <span class="hljs-variable">$branch</span> <span class="hljs-comment">#é»˜è®¤masteråˆ†æ”¯</span>
pip install -r requirements.txt 
sudo apt install ansible
</code></pre>
<ol>
<li><h3 id="å†é…ç½®inventory"><a href="#å†é…ç½®inventory" class="headerlink" title="å†é…ç½®inventory"></a>å†é…ç½®inventory</h3></li>
</ol>
<p>åœ¨ /etc/ansible/</p>
<pre><code class="hljs csharp">[<span class="hljs-meta">mons</span>]
node1
node2
node3

[<span class="hljs-meta">osds</span>]
node1
node2
node3

[<span class="hljs-meta">rgws</span>]
node1
node2
node3

[<span class="hljs-meta">clients</span>]
node1
node2
node3

[<span class="hljs-meta">mgrs</span>]
node1
node2
node3</code></pre>
<ol>
<li><h3 id="ç„¶ååœ¨ä¸‹è½½ä¸‹æ¥çš„ansibleç›®å½•ä¸‹æ‹·è´æ–‡ä»¶ï¼Œæ ¹æ®èŠ‚ç‚¹çš„è§’è‰²æ‹·è´å…·ä½“çš„æ–‡ä»¶"><a href="#ç„¶ååœ¨ä¸‹è½½ä¸‹æ¥çš„ansibleç›®å½•ä¸‹æ‹·è´æ–‡ä»¶ï¼Œæ ¹æ®èŠ‚ç‚¹çš„è§’è‰²æ‹·è´å…·ä½“çš„æ–‡ä»¶" class="headerlink" title="ç„¶ååœ¨ä¸‹è½½ä¸‹æ¥çš„ansibleç›®å½•ä¸‹æ‹·è´æ–‡ä»¶ï¼Œæ ¹æ®èŠ‚ç‚¹çš„è§’è‰²æ‹·è´å…·ä½“çš„æ–‡ä»¶"></a>ç„¶ååœ¨ä¸‹è½½ä¸‹æ¥çš„ansibleç›®å½•ä¸‹æ‹·è´æ–‡ä»¶ï¼Œæ ¹æ®èŠ‚ç‚¹çš„è§’è‰²æ‹·è´å…·ä½“çš„æ–‡ä»¶</h3></li>
</ol>
<pre><code class="hljs stylus">#é™¤äº†site<span class="hljs-selector-class">.yml</span>.sampleï¼Œall<span class="hljs-selector-class">.yml</span>.sampleæ˜¯å¿…é¡»è¦ä¿®æ”¹çš„ä¹‹å¤–ï¼Œå…¶ä»–æ–‡ä»¶æ ¹æ®è¦å®‰è£…çš„è§’è‰²è‡ªè¡Œä¿®æ”¹

cp site<span class="hljs-selector-class">.yml</span><span class="hljs-selector-class">.sample</span> site.yml

cp group_vars/osds<span class="hljs-selector-class">.yml</span><span class="hljs-selector-class">.sample</span> group_vars/osds.yml

cp group_vars/clients<span class="hljs-selector-class">.yml</span><span class="hljs-selector-class">.sample</span> group_vars/clients.yml

cp group_vars/mons<span class="hljs-selector-class">.yml</span><span class="hljs-selector-class">.sample</span> group_vars/mons.yml

cp group_vars/mgrs<span class="hljs-selector-class">.yml</span><span class="hljs-selector-class">.sample</span> group_vars/mgrs.yml

cp group_vars/all<span class="hljs-selector-class">.yml</span><span class="hljs-selector-class">.sample</span> group_vars/all.yml</code></pre>
<ol>
<li><h3 id="é…ç½®all-yml"><a href="#é…ç½®all-yml" class="headerlink" title="é…ç½®all.yml"></a>é…ç½®all.yml</h3></li>
</ol>
<p>æˆ‘ä»¬éœ€è¦ä¿®æ”¹osds.ymléƒ¨åˆ†ï¼š</p>
<pre><code class="hljs yaml"><span class="hljs-string">--</span>
<span class="hljs-attr">dummy:</span>
<span class="hljs-attr">ceph_release_num:</span>
  <span class="hljs-attr">octopus:</span> <span class="hljs-number">15</span>
<span class="hljs-attr">cluster:</span> <span class="hljs-string">ceph-test</span>
<span class="hljs-attr">ceph_origin:</span> <span class="hljs-string">repository</span>
<span class="hljs-attr">ceph_repository:</span> <span class="hljs-string">community</span>
<span class="hljs-attr">ceph_mirror:</span> <span class="hljs-string">https://mirrors.aliyun.com/ceph/</span>
<span class="hljs-attr">ceph_stable_key:</span> <span class="hljs-string">https://mirrors.aliyun.com/ceph/keys/release.asc</span>
<span class="hljs-attr">ceph_stable_release:</span> <span class="hljs-string">octopus</span>
<span class="hljs-attr">monitor_interface:</span> <span class="hljs-string">ens33</span>
<span class="hljs-attr">monitor_address:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.161</span><span class="hljs-number">.135</span>
<span class="hljs-attr">ip_version:</span> <span class="hljs-string">ipv4</span>
<span class="hljs-attr">public_network:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.161</span><span class="hljs-number">.0</span><span class="hljs-string">/24</span>
<span class="hljs-attr">cluster_network:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; public_network | regex_replace(&#x27; &#x27;, &#x27;&#x27;) &#125;&#125;</span>&quot;</span>
<span class="hljs-attr">osd_mkfs_type:</span> <span class="hljs-string">xfs</span>
<span class="hljs-attr">osd_mkfs_options_xfs:</span> <span class="hljs-string">-f</span> <span class="hljs-string">-i</span> <span class="hljs-string">size=2048</span>
<span class="hljs-attr">osd_mount_options_xfs:</span> <span class="hljs-string">noatime,largeio,inode64,swalloc</span>
<span class="hljs-attr">osd_objectstore:</span> <span class="hljs-string">bluestore</span></code></pre>
<p>devicesï¼šæŒ‡å®šosdä½¿ç”¨çš„ç¡¬ç›˜</p>
<p>osd_scenarioï¼šå¯ç”¨å¹¶ç½®journal  ã€ç¬”è€…æ²¡æœ‰æ‰¾åˆ°ã€‘</p>
<p>ä¸‹é¢æ˜¯ä¸€äº›trick</p>
<pre><code class="hljs elixir"><span class="hljs-variable">$ </span>sudo fdisk -l <span class="hljs-comment">#æŸ¥çœ‹ç£ç›˜ä¿¡æ¯</span></code></pre>
<p>æŸ¥çœ‹ä½ çš„æ›´æ”¹</p>
<pre><code class="hljs vim">$<span class="hljs-keyword">grep</span> -v <span class="hljs-string">&#x27;^#&#x27;</span> <span class="hljs-keyword">all</span>.yml | <span class="hljs-keyword">grep</span> -v <span class="hljs-string">&#x27;^&amp;&#x27;</span> <span class="hljs-keyword">all</span>.yml</code></pre>
<p>æˆ–è€…æŸ¥çœ‹æ‰€æœ‰ä¿®æ”¹åæ–‡ä»¶</p>
<pre><code class="hljs \">grep -Ev &quot;^$|^\s*#&quot;  *.yml</code></pre>
<ol>
<li><h3 id="é…ç½®osd"><a href="#é…ç½®osd" class="headerlink" title="é…ç½®osd"></a>é…ç½®osd</h3></li>
</ol>
<pre><code class="hljs arcade">devices:
   - <span class="hljs-regexp">/dev/</span>vdb
   - <span class="hljs-regexp">/dev/</span>vdc
   - <span class="hljs-regexp">/dev/</span>vdd</code></pre>
<ol>
<li><h3 id="å®šä¹‰ansibleçš„å…¥å£æ–‡ä»¶"><a href="#å®šä¹‰ansibleçš„å…¥å£æ–‡ä»¶" class="headerlink" title="å®šä¹‰ansibleçš„å…¥å£æ–‡ä»¶"></a>å®šä¹‰ansibleçš„å…¥å£æ–‡ä»¶</h3></li>
</ol>
<pre><code class="hljs vala">- hosts:
  - mons
<span class="hljs-meta">#  - agents</span>
  - osds
<span class="hljs-meta">#  - mdss</span>
<span class="hljs-meta">#  - rgws</span>
<span class="hljs-meta">#  - nfss</span>
<span class="hljs-meta">#  - restapis</span>
<span class="hljs-meta">#  - rbdmirrors</span>
  - clients
  - mgrs
<span class="hljs-meta">#  - iscsi-gws</span></code></pre>
<ol>
<li><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3></li>
</ol>
<pre><code class="hljs 1c">ansible-playbook  site.yml <span class="hljs-meta">#æ³¨æ„åŒæ ·æ²¡æœ‰sudo</span></code></pre>
<pre><code class="hljs routeros">PLAY RECAP *********************************************************************
node1                      : <span class="hljs-attribute">ok</span>=340  <span class="hljs-attribute">changed</span>=33   <span class="hljs-attribute">unreachable</span>=0    <span class="hljs-attribute">failed</span>=0    <span class="hljs-attribute">skipped</span>=547  <span class="hljs-attribute">rescued</span>=0    <span class="hljs-attribute">ignored</span>=0   
node2                      : <span class="hljs-attribute">ok</span>=109  <span class="hljs-attribute">changed</span>=12   <span class="hljs-attribute">unreachable</span>=0    <span class="hljs-attribute">failed</span>=0    <span class="hljs-attribute">skipped</span>=261  <span class="hljs-attribute">rescued</span>=0    <span class="hljs-attribute">ignored</span>=0   
node3                      : <span class="hljs-attribute">ok</span>=112  <span class="hljs-attribute">changed</span>=12   <span class="hljs-attribute">unreachable</span>=0    <span class="hljs-attribute">failed</span>=0    <span class="hljs-attribute">skipped</span>=260  <span class="hljs-attribute">rescued</span>=0    <span class="hljs-attribute">ignored</span>=0   


INSTALLER STATUS ***************************************************************
Install Ceph Monitor           : Complete (0:00:32)
Install Ceph Manager           : Complete (0:00:09)
Install Ceph OSD               : Complete (0:00:34)
Install Ceph<span class="hljs-built_in"> Client </span>           : Complete (0:00:31)

</code></pre>
<p>å¦‚æœ<code>failed=1</code>é‚£å°±è¯´æ˜å®‰è£…å¤±è´¥ï¼Œä½ éœ€è¦æ ¹æ®é”™è¯¯è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœæ‰“å°çš„ä¿¡æ¯å¤ªå°‘ï¼Œä½ å¯ä»¥ä½¿ç”¨</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">ansible-playbook</span> <span class="hljs-selector-tag">-vvv</span> <span class="hljs-selector-tag">site</span><span class="hljs-selector-class">.yml</span></code></pre>
<p>æ¥æ‰“å°æ›´å¤šä¿¡æ¯ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹é›†ç¾¤å¥åº·çŠ¶å†µ </p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">ceph -s</span></code></pre>
<p>æœ‰å¯èƒ½ä¼šæç¤ºceph RADOS object not found.</p>
<hr>
<p>å½“ç„¶å¦‚æœä½ æƒ³æ›´åŠ ç»†è‡´çš„å¼€å‘cephï¼Œå»ºè®®è¿›è¡Œ<strong>æ‰‹åŠ¨éƒ¨ç½²</strong>ï¼</p>
<h2 id="æ‰‹åŠ¨éƒ¨ç½²"><a href="#æ‰‹åŠ¨éƒ¨ç½²" class="headerlink" title="æ‰‹åŠ¨éƒ¨ç½²"></a>æ‰‹åŠ¨éƒ¨ç½²</h2><h2 id="1-éƒ¨ç½²ceph-mon"><a href="#1-éƒ¨ç½²ceph-mon" class="headerlink" title="1. éƒ¨ç½²ceph-mon"></a>1. éƒ¨ç½²ceph-mon</h2><p>å®‰è£…å®Œæˆä¹‹ååœ¨<code>/etc/ceph</code>ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶<code>ceph.conf</code>ï¼Œå†…å®¹å¤§è‡´å¦‚ä¸‹ï¼Œæ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹å³å¯ï¼š</p>
<pre><code class="hljs routeros">[global]
fsid = &#123;cluster-id&#125;
mon initial members = &#123;hostname&#125;[, &#123;hostname&#125;]
mon host = &#123;ip-address&#125;[, &#123;ip-address&#125;]
public<span class="hljs-built_in"> network </span>= &#123;network&#125;[, &#123;network&#125;]
cluster<span class="hljs-built_in"> network </span>= &#123;network&#125;[, &#123;network&#125;]
auth cluster required = cephx
auth<span class="hljs-built_in"> service </span>required = cephx
auth<span class="hljs-built_in"> client </span>required = cephx
osd journal size = &#123;n&#125;
osd<span class="hljs-built_in"> pool default </span>size = &#123;n&#125;  # Write an object n times.
osd<span class="hljs-built_in"> pool default </span>min size = &#123;n&#125; # Allow writing n copies <span class="hljs-keyword">in</span> a degraded state.
osd<span class="hljs-built_in"> pool default </span>pg num = &#123;n&#125;
osd<span class="hljs-built_in"> pool default </span>pgp num = &#123;n&#125;
osd crush chooseleaf<span class="hljs-built_in"> type </span>= &#123;n&#125;
</code></pre>
<p>ä¸ºç›‘æ§èŠ‚ç‚¹åˆ›å»ºå¯†é’¥ï¼š</p>
<pre><code class="hljs shell">ceph-authtool --create-keyring /etc/ceph/ceph.mon.keyring --gen-key -n mon. --cap mon &#x27;allow *&#x27;</code></pre>
<p>åˆ›å»ºclient.adminç”¨æˆ·å¹¶åˆ›å»ºå¯†é’¥ï¼š</p>
<pre><code class="hljs shell">ceph-authtool --create-keyring /etc/ceph/ceph.client.admin.keyring --gen-key -n client.admin --cap mon &#x27;allow *&#x27; --cap osd &#x27;allow *&#x27; --cap mds &#x27;allow *&#x27; --cap mgr &#x27;allow *&#x27;</code></pre>
<p>åˆ›å»ºclient.bootstrap-osdç”¨æˆ·å¹¶åˆ›å»ºå¯†é’¥ï¼š</p>
<pre><code class="hljs shell">ceph-authtool --create-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring --gen-key -n client.bootstrap-osd --cap mon &#x27;profile bootstrap-osd&#x27;</code></pre>
<p>å°†åˆšæ‰ç”Ÿæˆçš„ä¸¤ä¸ªå¯†é’¥åŠ å…¥ceph.mon.keyringä¸­ï¼š</p>
<pre><code class="hljs shell">ceph-authtool /etc/ceph/ceph.mon.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring
ceph-authtool /etc/ceph/ceph.mon.keyring --import-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring</code></pre>
<p>æ­¤æ—¶ceph.mon.keyringä¸­åº”æœ‰å¦‚ä¸‹å¯†é’¥ï¼š</p>
<pre><code class="hljs nix">[mon.]
	<span class="hljs-attr">key</span> = AQBWAa1f8zAHJBAAf0cyxMAZjsZeL7+x+<span class="hljs-attr">czsLw==</span>
	caps <span class="hljs-attr">mon</span> = <span class="hljs-string">&quot;allow *&quot;</span>
[client.admin]
	<span class="hljs-attr">key</span> = AQDPAa1fxm0VMRAAXMJ+<span class="hljs-attr">QU7sA9knr5ZWsluLxg==</span>
	caps <span class="hljs-attr">mds</span> = <span class="hljs-string">&quot;allow *&quot;</span>
	caps <span class="hljs-attr">mgr</span> = <span class="hljs-string">&quot;allow *&quot;</span>
	caps <span class="hljs-attr">mon</span> = <span class="hljs-string">&quot;allow *&quot;</span>
	caps <span class="hljs-attr">osd</span> = <span class="hljs-string">&quot;allow *&quot;</span>
[client.bootstrap-osd]
	<span class="hljs-attr">key</span> = AQAWAq1fATC1ChAAb2wMiO+k/<span class="hljs-attr">hwlMEmddDLAcg==</span>
	caps <span class="hljs-attr">mgr</span> = <span class="hljs-string">&quot;allow r&quot;</span>
	caps <span class="hljs-attr">mon</span> = <span class="hljs-string">&quot;profile bootstrap-osd&quot;</span></code></pre>
<p>ç”Ÿæˆç›‘æ§æ˜ å°„ï¼š</p>
<pre><code class="hljs shell">monmaptool --create --add &#123;hostname&#125; &#123;ip-address&#125; --fsid &#123;uuid&#125; /etc/ceph/monmap
</code></pre>
<p>åˆ›å»ºé»˜è®¤çš„æ•°æ®ç›®å½•ï¼Œå…¶ä¸­ç›®å½•åæ˜¯{cluster-name}-{hostname}æ ¼å¼ï¼š</p>
<pre><code class="hljs shell">sudo mkdir /var/lib/ceph/mon/&#123;cluster-name&#125;-&#123;hostname&#125;
</code></pre>
<p>åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹ï¼š</p>
<pre><code class="hljs shell">sudo ceph-mon [--cluster &#123;cluster-name&#125;] --mkfs -i &#123;hostname&#125; --monmap /etc/ceph/monmap --keyring /etc/ceph/ceph.mon.keyring</code></pre>
<p>å¯åŠ¨monï¼š</p>
<pre><code class="hljs shell">ceph-mon -i &#123;hostname&#125; -c /etc/ceph/ceph.conf --cluster ceph</code></pre>
<p>è¿™å„¿ä¸èƒ½æ ¹æ®å®˜æ–¹æ¨èçš„systemctlã€‚ </p>
<p>ä¹‹åæˆ‘ä»¬ç”¨ </p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">ceph -s</span></code></pre>
<p>æŸ¥çœ‹é›†ç¾¤</p>
<p>è¿™é‡Œç¬”è€…é‡åˆ°é—®é¢˜ï¼š</p>
<pre><code class="hljs pgsql">[errno <span class="hljs-number">2</span>] RADOS <span class="hljs-keyword">object</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">found</span> (error connecting <span class="hljs-keyword">to</span> the <span class="hljs-keyword">cluster</span>)</code></pre>
<p>æç¤ºRADOSå¯¹è±¡æ²¡æœ‰æ‰¾åˆ°ï¼Œä½†æ˜¯æˆ‘è¿˜æ²¡æœ‰åˆ°é‚£ä¸€æ­¥å‘¢ï¼</p>
<p>åŸæ¥æ˜¯æ²¡æœ‰åŠ sudo</p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">sudo ceph -s</span></code></pre>
<pre><code class="hljs yaml"><span class="hljs-attr">cluster:</span>
  <span class="hljs-attr">id:</span>     <span class="hljs-string">250a1431-6cf3-4d0b-a964-361cd8d10dad</span>
  <span class="hljs-attr">health:</span> <span class="hljs-string">HEALTH_WARN</span>
          <span class="hljs-number">1</span> <span class="hljs-string">monitors</span> <span class="hljs-string">have</span> <span class="hljs-string">not</span> <span class="hljs-string">enabled</span> <span class="hljs-string">msgr2</span>
 
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">mon:</span> <span class="hljs-number">1</span> <span class="hljs-string">daemons,</span> <span class="hljs-string">quorum</span> <span class="hljs-string">ceph-master</span> <span class="hljs-string">(age</span> <span class="hljs-string">25m)</span>
  <span class="hljs-attr">mgr:</span> <span class="hljs-literal">no</span> <span class="hljs-string">daemons</span> <span class="hljs-string">active</span>
  <span class="hljs-attr">osd: 0 osds:</span> <span class="hljs-number">0</span> <span class="hljs-string">up,</span> <span class="hljs-number">0</span> <span class="hljs-string">in</span>
 
<span class="hljs-attr">data:</span>
  <span class="hljs-attr">pools:</span>   <span class="hljs-number">0</span> <span class="hljs-string">pools,</span> <span class="hljs-number">0</span> <span class="hljs-string">pgs</span>
  <span class="hljs-attr">objects:</span> <span class="hljs-number">0</span> <span class="hljs-string">objects,</span> <span class="hljs-number">0</span> <span class="hljs-string">B</span>
  <span class="hljs-attr">usage:</span>   <span class="hljs-number">0</span> <span class="hljs-string">B</span> <span class="hljs-string">used,</span> <span class="hljs-number">0</span> <span class="hljs-string">B</span> <span class="hljs-string">/</span> <span class="hljs-number">0</span> <span class="hljs-string">B</span> <span class="hljs-string">avail</span>
  <span class="hljs-attr">pgs:</span></code></pre>
<p>è¿™æ˜¯æœ€<strong>åŸºæœ¬</strong>çš„é›†ç¾¤ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªmonitorï¼Œé©¬ä¸Šæˆ‘ä»¬å°±è¿›è¡Œå¿…è¦çš„æ‰©å±•ï¼</p>
<p>è¿™å„¿æœ‰ä¸€ä¸ª <code>HEALTH_WARN</code>å¤§å®¶åº”è¯¥æ³¨æ„åˆ°äº†ï¼Œè¿™æ˜¯å› ä¸º msgr æ²¡æœ‰enableã€‚</p>
<pre><code class="hljs routeros">sudo ceph<span class="hljs-built_in"> health </span>detail #è¯¦ç»†æŸ¥çœ‹å¥åº·çŠ¶å†µ</code></pre>
<h2 id="2-éƒ¨ç½²ceph-mgr"><a href="#2-éƒ¨ç½²ceph-mgr" class="headerlink" title="2. éƒ¨ç½²ceph-mgr"></a>2. éƒ¨ç½²ceph-mgr</h2><p>å‰é¢æˆ‘ä»¬è¯´æ¯ä¸€ä¸ªmonèŠ‚ç‚¹æœ€å¥½åŠ ä¸€ä¸ªmgrå®ˆæŠ¤è¿›ç¨‹ã€‚åå­—å«<code>open-stack</code></p>
<h2 id="æ–°å»ºç”¨æˆ·"><a href="#æ–°å»ºç”¨æˆ·" class="headerlink" title="æ–°å»ºç”¨æˆ·"></a>æ–°å»ºç”¨æˆ·</h2><p>åˆ›å»ºç”¨æˆ· openstack ç”¨äº MGR ç›‘æ§</p>
<pre><code class="hljs dsconfig"><span class="hljs-string">ceph </span><span class="hljs-string">auth </span><span class="hljs-built_in">get-or-create</span> <span class="hljs-string">mgr.</span><span class="hljs-string">openstack </span><span class="hljs-string">mon </span><span class="hljs-string">&#x27;allow *&#x27;</span> <span class="hljs-string">osd </span><span class="hljs-string">&#x27;allow *&#x27;</span> <span class="hljs-string">mds </span><span class="hljs-string">&#x27;allow *&#x27;</span> [<span class="hljs-string">mgr.</span><span class="hljs-string">openstack]</span> <span class="hljs-string">key </span>= <span class="hljs-string">AQBqhxNaKcVpLhAA/</span><span class="hljs-string">P1GVlu3yRugvXkLfgauLA=</span>=</code></pre>
<h2 id="ä¿®æ”¹ç”¨æˆ·"><a href="#ä¿®æ”¹ç”¨æˆ·" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·"></a>ä¿®æ”¹ç”¨æˆ·</h2><p>å‡å¦‚ç”¨æˆ·å·²ç»å­˜åœ¨, ç”¨è¿‡ä¸‹é¢æ–¹æ³•è¿›è¡Œæƒé™ä¿®æ”¹</p>
<pre><code class="hljs apache"><span class="hljs-attribute">ceph</span> auth caps mgr.openstack mon &#x27;<span class="hljs-literal">allow</span> *&#x27; osd &#x27;<span class="hljs-literal">allow</span> *&#x27; mds &#x27;<span class="hljs-literal">allow</span> *&#x27;
[mgr.openstack]
        <span class="hljs-attribute">key</span> = AQBqhxNaKcVpLhAA/P<span class="hljs-number">1</span>GVlu<span class="hljs-number">3</span>yRugvXkLfgauLA==</code></pre>
<h2 id="åˆ é™¤ç”¨æˆ·"><a href="#åˆ é™¤ç”¨æˆ·" class="headerlink" title="åˆ é™¤ç”¨æˆ·"></a>åˆ é™¤ç”¨æˆ·</h2><p>æç¤ºä¸€ä¸‹åˆ é™¤ç”¨æˆ·æ–¹æ³•</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">ceph</span> <span class="hljs-selector-tag">auth</span> <span class="hljs-selector-tag">del</span> <span class="hljs-selector-tag">mgr</span><span class="hljs-selector-class">.openstack</span></code></pre>
<h2 id="å¯¼å‡ºå¯†é’¥"><a href="#å¯¼å‡ºå¯†é’¥" class="headerlink" title="å¯¼å‡ºå¯†é’¥"></a>å¯¼å‡ºå¯†é’¥</h2><p>éœ€è¦å§ä¹‹å‰åˆ›å»ºçš„ç”¨æˆ·å¯†ç å­˜æ”¾è‡³å¯¹åº”ä½ç½®</p>
<pre><code class="hljs crystal">mkdir /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">mgr</span>/<span class="hljs-title">ceph</span>-<span class="hljs-title">openstack</span></span>
ceph auth get mgr.openstack -o /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">mgr</span>/<span class="hljs-title">ceph</span>-<span class="hljs-title">openstack</span>/<span class="hljs-title">keyring</span></span>
exported keyring <span class="hljs-keyword">for</span> mgr.openstack</code></pre>
<h2 id="å¯åŠ¨-mgr"><a href="#å¯åŠ¨-mgr" class="headerlink" title="å¯åŠ¨ mgr"></a>å¯åŠ¨ mgr</h2><pre><code class="hljs ebnf"><span class="hljs-attribute">ceph-mgr -i openstack</span></code></pre>
<p>ç„¶åéƒ¨ç½²å®Œæˆä¹‹åçŠ¶æ€å¦‚ä¸‹ï¼š</p>
<h2 id="3-éƒ¨ç½²ceph-osd"><a href="#3-éƒ¨ç½²ceph-osd" class="headerlink" title="3.éƒ¨ç½²ceph-osd"></a>3.éƒ¨ç½²ceph-osd</h2><p>ä¿®æ”¹<code>/etc/ceph/ceph.conf</code></p>
<pre><code class="hljs awk">[osd]
run_dir = <span class="hljs-regexp">/data0/</span><span class="hljs-variable">$name</span> 
osd data = <span class="hljs-regexp">/data0/</span><span class="hljs-variable">$name</span>
osd journal = <span class="hljs-regexp">/data0/</span><span class="hljs-variable">$name</span>/journal
osd max object name len = <span class="hljs-number">256</span>
osd max object namespace len = <span class="hljs-number">64</span></code></pre>
<p>ç¬”è€…è¿™é‡Œæœªä¸“é—¨åˆ†é…ç£ç›˜ï¼Œ<code>/data0/$name</code>å†™çš„æ˜¯<code>/var/lib/ceph/osd/ceph-0</code>ï¼Œä¸ºäº†ç¡®ä¿ä½“éªŒï¼Œå»ºè®®ä¸“é—¨ä¸ºosdå’Œjournalåˆ†åŒºï¼Œæœ€å¥½æ˜¯xfsç³»ç»Ÿã€‚</p>
<p>å®˜æ–¹ç»™äº†short-formå’Œlong formä¸¤ç§æ–¹å¼ï¼Œæˆ‘ä»¬é€‰æ‹©long formã€‚æˆ‘ä»¬å…ˆåˆ‡æ¢åˆ°rootæƒé™ï¼š</p>
<p>å› ä¸ºä¸‹é¢æ˜¯è„šæœ¬æ¨¡å¼ï¼Œ$\$var$ç›¸å½“äºç¯å¢ƒå˜é‡ã€‚<strong>æ³¨æ„ï¼Œbashçš„ç­‰å·ä¸¤ç«¯ä¸èƒ½æœ‰ç©ºæ ¼ï¼</strong></p>
<pre><code class="hljs crystal">sudo bash <span class="hljs-comment"># è¿è¡Œè¿è¡Œbashè„šæœ¬</span>
UUID=$(uuidgen) <span class="hljs-comment">#å’Œé›†ç¾¤IDä¸€æ ·ï¼ŒOSDä¹Ÿè¦ç”Ÿæˆå”¯ä¸€ID </span>
OSD_SECRET=$(ceph-authtool --gen-print-key) <span class="hljs-comment">#ç”Ÿæˆå¯†åŒ™</span>
sudo cp /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">bootstrap</span>-<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>.<span class="hljs-title">keyring</span> /<span class="hljs-title">etc</span>/<span class="hljs-title">ceph</span>/</span>
ID=$(echo <span class="hljs-string">&quot;&#123;\&quot;cephx_secret\&quot;: \&quot;$OSD_SECRET\&quot;&#125;&quot;</span> | \
   ceph osd new $UUID -i - \
   -n client.bootstrap-osd -k /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">bootstrap</span>-<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>.<span class="hljs-title">keyring</span>) <span class="hljs-comment">#ç”ŸæˆOSD-IDï¼Œä»0å¼€å§‹</span></span>
   
 mkdir /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>-$<span class="hljs-title">ID</span></span></code></pre>
<blockquote>
<p>sudo su , sudo su-, sudo bash å‡å¯è¿›å…¥rootï¼ŒåŒºåˆ«æ˜¯ sudo bashæ›´å…¨é¢ï¼Œå¯ä»¥è¿è¡Œè„šæœ¬ï¼Œå¼€å¤´çš„å‘½ä»¤å¤´æ˜¯ç»¿å­—ï¼Œsudo su- å…è®¸ä¸€å®šåœºåˆä¸ç”¨è¾“å…¥å¯†ç ï¼Œè€Œsudo suæ˜¯è¿›å…¥ä¸€èˆ¬çš„rootæ¨¡å¼ã€‚</p>
</blockquote>
<div class="note note-warning">
            <p>æŒ‚è½½osdçš„è·¯å¾„åº”è¯¥ä¸è¿è¡Œæ“ä½œç³»ç»Ÿçš„è·¯å¾„åˆ†å¼€ã€‚å¹¶å»ºè®®é‡‡ç”¨xfsæ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸æ˜¯brtfsæˆ–è€…ext4.</p>
          </div>
<p>æˆ‘ä»¬å»ºè®®é¢å¤–åˆ†é…ä¸€å®šç©ºé—´ä¸“é—¨ç”¨ä½œosdå­˜å‚¨ï¼Œä»¥åŠæ—¥å¿—å­˜å‚¨ï¼Œå¹¶ä¸”å°†å…¶æŒ‚è½½åˆ°<code>/var/lib/ceph/osd/ceph-&#123;osd_num&#125;</code></p>
<pre><code class="hljs crystal">sudo mkfs.xfs /dev/&#123;DEV&#125;
sudo mount /dev/&#123;DEV&#125; /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>-$<span class="hljs-title">ID</span></span></code></pre>
<p>å¦‚æœä½ åƒç¬”è€…ä¸€æ ·ç²—å¿ƒï¼Œå¿˜äº†å°†osdå­˜å‚¨å’Œosåˆ†å¼€ï¼Œé‚£ä¹ˆåªèƒ½è¿›è¡Œå¦‚ä¸‹æ“ä½œ</p>
<pre><code class="hljs crystal">sudo mount /dev/sda1 /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>-0</span></code></pre>
<pre><code class="hljs crystal">ceph-authtool --create-keyring /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>-$<span class="hljs-title">ID</span>/<span class="hljs-title">keyring</span> \</span>
     --name osd.$ID --add-key $OSD_SECRET 
ceph-osd -i $ID --mkfs --osd-uuid $UUID <span class="hljs-comment">#åˆå§‹åŒ–OSDåˆå§‹ç›®å½•</span>
chown -R <span class="hljs-symbol">ceph:</span>ceph /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>-$<span class="hljs-title">ID</span> <span class="hljs-comment">#ç›®å½•æ‹¥æœ‰è€…ï¼Œè°¨æ…æ‰§è¡Œï¼Œå¦åˆ™sudoå®¹æ˜“æŒ‚</span></span></code></pre>
<p>å¯åŠ¨osd</p>
<pre><code class="hljs routeros">systemctl <span class="hljs-builtin-name">enable</span> ceph-osd@<span class="hljs-variable">$ID</span>
systemctl start ceph-osd@<span class="hljs-variable">$ID</span></code></pre>
<p>â€‹    æ£€æŸ¥osdæ˜¯å¦å¯åŠ¨ ceph -s</p>
<pre><code class="hljs yaml"><span class="hljs-attr">cluster:</span>
  <span class="hljs-attr">id:</span>     <span class="hljs-string">250a1431-6cf3-4d0b-a964-361cd8d10dad</span>
  <span class="hljs-attr">health:</span> <span class="hljs-string">HEALTH_WARN</span>
          <span class="hljs-literal">no</span> <span class="hljs-string">active</span> <span class="hljs-string">mgr</span>
          <span class="hljs-number">1</span> <span class="hljs-string">monitors</span> <span class="hljs-string">have</span> <span class="hljs-string">not</span> <span class="hljs-string">enabled</span> <span class="hljs-string">msgr2</span>
 
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">mon:</span> <span class="hljs-number">1</span> <span class="hljs-string">daemons,</span> <span class="hljs-string">quorum</span> <span class="hljs-string">ceph-master</span> <span class="hljs-string">(age</span> <span class="hljs-string">72m)</span>
  <span class="hljs-attr">mgr:</span> <span class="hljs-literal">no</span> <span class="hljs-string">daemons</span> <span class="hljs-string">active</span>
  <span class="hljs-attr">osd: 1 osds:</span> <span class="hljs-number">0</span> <span class="hljs-string">up,</span> <span class="hljs-number">0</span> <span class="hljs-string">in</span>
 
<span class="hljs-attr">data:</span>
  <span class="hljs-attr">pools:</span>   <span class="hljs-number">0</span> <span class="hljs-string">pools,</span> <span class="hljs-number">0</span> <span class="hljs-string">pgs</span>
  <span class="hljs-attr">objects:</span> <span class="hljs-number">0</span> <span class="hljs-string">objects,</span> <span class="hljs-number">0</span> <span class="hljs-string">B</span>
  <span class="hljs-attr">usage:</span>   <span class="hljs-number">0</span> <span class="hljs-string">B</span> <span class="hljs-string">used,</span> <span class="hljs-number">0</span> <span class="hljs-string">B</span> <span class="hljs-string">/</span> <span class="hljs-number">0</span> <span class="hljs-string">B</span> <span class="hljs-string">avail</span>
  <span class="hljs-attr">pgs:</span></code></pre>
<p>è¿™å°±è¯´æ˜æˆ‘ä»¬æ­å»ºäº†ä¸€ä¸ªosdã€‚</p>
<hr>
<h1 id="Build-amp-Make-ç¼–è¯‘æºç "><a href="#Build-amp-Make-ç¼–è¯‘æºç " class="headerlink" title="Build &amp;Make:ç¼–è¯‘æºç "></a>Build &amp;Make:ç¼–è¯‘æºç </h1><p><span id="here">æ‚¨åˆ°ç«™äº†ï¼</span></p>
<p><del>ç‰ˆæœ¬14.2.12ï¼šNautilus</del></p>
<p>ç‰ˆæœ¬15.2.5ï¼šOctopus âˆš ï¼ˆæœ€æ–°ç‰ˆï¼‰</p>
<blockquote>
<p>å‚è€ƒï¼š</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaochina/p/12275313.html">Nautilusç‰ˆæœ¬éƒ¨ç½²</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40071358/article/details/106924184">Octopusç‰ˆæœ¬éƒ¨ç½²</a></p>
</blockquote>
<p>ç¡¬ä»¶é…ç½®</p>
<ul>
<li>Ubuntu18.04 LTSï¼ˆBionic Beaverï¼‰ </li>
</ul>
<p>è£…å®Œè™šæ‹Ÿæœºï¼Œä½ åº”è¯¥1. <a target="_blank" rel="noopener" href="https://blog.csdn.net/adullperson/article/details/105184861">è®¾ç½®å…±äº«æ–‡ä»¶å¤¹</a> 2. æ”¹å˜é•œåƒä¸ºæ¸…åæºå¹¶update 3. ä¸‹è½½ä¸­æ–‡è¾“å…¥æ³•vimï¼Œchromeç­‰ 4. å¿«ç…§ä¿å­˜ ã€ç”±äºä»å®˜ç½‘å’Œgithubä¸‹è½½cephæºç å’Œtarballå¾ˆæ…¢ï¼Œæˆ‘æ”¾åœ¨æˆ‘çš„ç½‘ç›˜ä¸Šã€‘</p>
<blockquote>
<p>å¦‚æœä½ ï¼Œå‘ç°ç¡¬ç›˜åˆ†é…å°äº†ï¼Œæƒ³æ‰©å®¹ï¼Œåˆä¸æƒ³é‡æ–°è£…ç³»ç»Ÿï¼Œçœ‹<a target="_blank" rel="noopener" href="https://blog.csdn.net/daemon_2017/article/details/80660372">è¿™é‡Œ</a>ã€‚ä»¥åŠç£ç›˜æ¸…ç†<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_37407756/article/details/79903837">æŠ€å·§</a>ã€‚</p>
</blockquote>
<ul>
<li>è¿å­˜16g+ç¡¬ç›˜80g å››æ ¸ï¼ˆæ ¹æ®å®é™…æƒ…å†µï¼‰</li>
</ul>
<p>ï¼ˆå®˜ç½‘è¦æ±‚æœ€å°‘60gç©ºé—´ï¼šA debug build of Ceph may take around 40 gigabytes. If you want to build Ceph in a virtual machine (VM) please make sure total disk space on the VM is at least 60 gigabytes.ï¼‰</p>
<p>ï¼ˆåˆå§‹4g+20gå‡ºç°ç¡¬ç›˜ä¸è¶³é—®é¢˜ï¼Œä¸€æ€’ä¹‹ä¸‹ã€‚ã€‚ï¼‰</p>
<p>å®‰è£…æ­¥éª¤ï¼š</p>
<p>ä¸‹è½½æºç æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>GitHub </li>
</ol>
<pre><code class="hljs awk">git clone --recursive git:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/ceph/</span>ceph <span class="hljs-comment">#recursiveæ˜¯ä¿è¯ä¸‹è½½æ‰€æœ‰å­æ¨¡å—ï¼Œå¤§å°åº”è¯¥æœ‰100å¤šM</span></code></pre>
<ol>
<li>tarball</li>
</ol>
<p>ã€Githubä¸‹è½½å¤ªæ…¢ï¼Ÿbaiduç½‘ç›˜ã€‘ï¼šé“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1siz1Bag4Y4XduMLaqc21TQ">https://pan.baidu.com/s/1siz1Bag4Y4XduMLaqc21TQ</a><br>æå–ç ï¼šxahe </p>
<p>å¦‚æœæ˜¯è™šæ‹Ÿæœºçš„è¯ï¼šéœ€è¦æ”¯æŒå…±äº«æ–‡ä»¶å¤¹ã€‚</p>
<pre><code class="hljs dts">tar -<span class="hljs-class">zxvf </span>&#123;æ–‡ä»¶å&#125; <span class="hljs-meta">#è§£å‹</span>
<span class="hljs-class">cd </span>&#123;æ–‡ä»¶å&#125;</code></pre>
<pre><code class="hljs sql">git submodule <span class="hljs-keyword">update</span> <span class="hljs-comment">--init --recursive #æ£€æŸ¥æœ‰æ²¡æœ‰æ¨¡å—ç¼ºå¤±ï¼Œè¯•äº†ä¸€ä¸‹æ²¡å•¥åµç”¨</span>
sudo ./<span class="hljs-keyword">install</span>-deps.sh <span class="hljs-comment">#å®‰è£…æ‰€æœ‰ä¾èµ–ï¼Œéœ€è¦å¤§é‡æ—¶é—´ï¼Œå»ºè®®ç½‘å¥½çš„æ—¶å€™è¿›è¡Œ</span>
sudo ./do_cmake.sh -DCMAKE_BUILD_TYPE=RelWithDebInfo -DWITH_SEASTAR=<span class="hljs-keyword">ON</span> -DWITH_MGR_DASHBOARD_FRONTEND=<span class="hljs-keyword">OFF</span> -DWITH_PYTHON2=<span class="hljs-keyword">OFF</span> -DWITH_PYTHON3=<span class="hljs-keyword">ON</span> -DMGR_PYTHON_VERSION=<span class="hljs-number">3</span> <span class="hljs-comment">#è¿™ä¸€æ­¥ å¦‚æœè¿™éƒ¨æŠ¥é”™å°±è¯•è¯• sudo ./run-make-check.sh åªè¦æœ€åbuildæ–‡ä»¶å¤¹æœ‰makefileå°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬ä¸éœ€è¦è°ƒè¯•ä¿¡æ¯ï¼Œéœ€è¦seastarï¼Œä¸éœ€è¦å‰ç«¯ï¼Œé‡‡ç”¨python3</span>
cd <span class="hljs-keyword">build</span>
sudo make -j4 vstart<span class="hljs-comment"># ä¿è¯èƒ½è¿è¡Œtest clusterå°±è¡Œï¼Œè¿™é‡Œ-j4æ˜¯çº¿ç¨‹æ•°ï¼Œæ ¹æ®å®é™…æƒ…å†µè®¾å®š</span>
sudo make -j4 <span class="hljs-keyword">all</span> <span class="hljs-comment">#ç¼–è¯‘æ‰€æœ‰ç»„ä»¶ï¼Œéœ€è¦å¾ˆå¤šç©ºé—´ï¼Œæ ¹æ®éœ€è¦è¿›è¡Œ</span>
sudo make <span class="hljs-keyword">install</span> <span class="hljs-comment">#åˆ«å¿˜äº†è¿›è¡Œå®‰è£…</span></code></pre>
<p>ç¼ºå•¥è¡¥å•¥ (lib+XX+-devæ ¼å¼)</p>
<p>æ¯”å¦‚ç¬”è€…è£…äº†ä»¥ä¸‹åº“ </p>
<pre><code class="hljs cmake">sudo apt <span class="hljs-keyword">install</span> libhwloc-dev
sudo apt <span class="hljs-keyword">install</span> libsctp-dev
sudo apt <span class="hljs-keyword">install</span> libyaml-cpp-dev
sudo apt <span class="hljs-keyword">install</span> ragel</code></pre>
<p>ç¼–è¯‘å¯èƒ½è¦5-8å°æ—¶ã€‚å»ºè®®å¼€ä¸ª<code>top</code>çª—å£ï¼Œçœ‹çœ‹<code>cc1plus</code>è¿™ä¸ªè¿›ç¨‹åœ¨ä¸åœ¨ï¼Œå¦‚æœä¸åœ¨ï¼Œè€Œä¸”å†…å­˜æ²¡æ€ä¹ˆå ç”¨ï¼Œè¯´æ˜ç¨‹åºæ­»äº†ã€‚<code>ctrl+c</code>ç»ˆæ­¢å†é‡æ–°ç¼–è¯‘ã€‚</p>
<hr>
<p>æŒ‰ç…§å®˜æ–¹çš„æµ‹è¯•clusteråªç”¨ç¼–è¯‘åˆ°vstartå°±è¡Œäº†</p>
<p><code>sudo make -j4 vstart</code></p>
<p>å¦‚æœä½ é‡åˆ°é—®é¢˜ï¼Œè¯·å¯¹ç—‡ä¸‹è¯ï¼</p>
<h2 id="P1-æœªä¸githubè¿œç¨‹åº“å»ºç«‹è”ç³»"><a href="#P1-æœªä¸githubè¿œç¨‹åº“å»ºç«‹è”ç³»" class="headerlink" title="P1:æœªä¸githubè¿œç¨‹åº“å»ºç«‹è”ç³»"></a>P1:æœªä¸githubè¿œç¨‹åº“å»ºç«‹è”ç³»</h2><pre><code class="hljs gradle">CMake Error at src<span class="hljs-regexp">/CMakeFiles/gi</span>t-data/grabRef.cmake:<span class="hljs-number">48</span> (<span class="hljs-keyword">file</span>):
  <span class="hljs-keyword">file</span> failed to open <span class="hljs-keyword">for</span> reading (No such <span class="hljs-keyword">file</span> or directory):

    <span class="hljs-regexp">/home/</span>ceph<span class="hljs-regexp">/Sharing Hub/</span>ceph-master<span class="hljs-regexp">/src/</span>CMakeFiles<span class="hljs-regexp">/git-data/</span>head-ref
<span class="hljs-keyword">Call</span> Stack (most recent <span class="hljs-keyword">call</span> first):
  cmake<span class="hljs-regexp">/modules/G</span>etGitRevisionDescription.cmake:<span class="hljs-number">75</span> (<span class="hljs-keyword">include</span>)
  src/CMakeLists.txt:<span class="hljs-number">216</span> (get_git_head_revision)


CMake Error at src<span class="hljs-regexp">/CMakeFiles/gi</span>t-data/grabRef.cmake:<span class="hljs-number">48</span> (<span class="hljs-keyword">file</span>):
  <span class="hljs-keyword">file</span> failed to open <span class="hljs-keyword">for</span> reading (No such <span class="hljs-keyword">file</span> or directory):

    <span class="hljs-regexp">/home/</span>ceph<span class="hljs-regexp">/Sharing Hub/</span>ceph-master<span class="hljs-regexp">/src/</span>CMakeFiles<span class="hljs-regexp">/git-data/</span>head-ref
<span class="hljs-keyword">Call</span> Stack (most recent <span class="hljs-keyword">call</span> first):
  cmake<span class="hljs-regexp">/modules/G</span>etGitRevisionDescription.cmake:<span class="hljs-number">75</span> (<span class="hljs-keyword">include</span>)
  cmake<span class="hljs-regexp">/modules/G</span>etGitRevisionDescription.cmake:<span class="hljs-number">85</span> (get_git_head_revision)
  src/CMakeLists.txt:<span class="hljs-number">217</span> (git_describe)


CMake Error at src/CMakeLists.txt:<span class="hljs-number">221</span> (<span class="hljs-keyword">if</span>):
  <span class="hljs-keyword">if</span> given arguments:

    <span class="hljs-string">&quot;STREQUAL&quot;</span> <span class="hljs-string">&quot;GITDIR-NOTFOUND&quot;</span>

  Unknown arguments specified


-- Configuring incomplete, errors occurred!
See also <span class="hljs-string">&quot;/home/ceph/Sharing Hub/ceph-master/CMakeFiles/CMakeOutput.log&quot;</span>.
See also <span class="hljs-string">&quot;/home/ceph/Sharing Hub/ceph-master/CMakeFiles/CMakeError.log&quot;</span>.
</code></pre>
<p>æ³¨æ„ï¼šåƒä¸‡ä¸è¦è¿è¡Œ<code>make_deb.sh</code>å¦åˆ™æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«åˆ é™¤</p>
<p>åŸå› ï¼šæœªä¸è¿œç¨‹åº“å»ºç«‹è”ç³»ï¼š</p>
<p>è§£å†³ï¼šåœ¨ä¸»ç›®å½•ä¸‹ä¾æ¬¡æ‰§è¡Œ</p>
<pre><code class="hljs awk">git init
git remote add origin https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/ceph/</span>ceph.git
git add .
git commit -m <span class="hljs-string">&quot;123&quot;</span></code></pre>
<h2 id="P2ï¼š-Pythonå’ŒCephä½¿ç”¨äº†ä¸åŒçš„OpenSSLåº“"><a href="#P2ï¼š-Pythonå’ŒCephä½¿ç”¨äº†ä¸åŒçš„OpenSSLåº“" class="headerlink" title="P2ï¼š Pythonå’ŒCephä½¿ç”¨äº†ä¸åŒçš„OpenSSLåº“"></a>P2ï¼š Pythonå’ŒCephä½¿ç”¨äº†ä¸åŒçš„OpenSSLåº“</h2><pre><code class="hljs apache"><span class="hljs-attribute">CMake</span> Error at src/pybind/CMakeLists.txt:<span class="hljs-number">67</span> (message):
  <span class="hljs-attribute">Python</span> and Ceph link to different OpenSSL versions: <span class="hljs-number">1</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>

   <span class="hljs-attribute">vs</span> <span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>n
</code></pre>
<p>å­—é¢æ„æ€ã€‚Pythonå’ŒCephä½¿ç”¨äº†ä¸åŒçš„OpenSSLåº“ã€‚</p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/ceph/ceph/pull/22659ï¼Œhttps://tracker.ceph.com/issues/36425">https://github.com/ceph/ceph/pull/22659ï¼Œhttps://tracker.ceph.com/issues/36425</a></p>
<p>é—®é¢˜ï¼šé»˜è®¤pyth2é“¾æ¥åˆ°openssl1.0.2n(æ—©æœŸç‰ˆæœ¬)</p>
<p>ç°åœ¨çš„cephæ˜¯é€šè¿‡python3ç¼–è¯‘ã€‚python3ç›´æ¥è¿æ¥åˆ°openssl1.1.1ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹å‚æ•°å¼ºåˆ¶ç”¨python3ç¼–è¯‘ã€‚</p>
<pre><code class="hljs routeros"><span class="hljs-attribute">-DWITH_PYTHON2</span>=OFF <span class="hljs-attribute">-DWITH_PYTHON3</span>=ON <span class="hljs-attribute">-DMGR_PYTHON_VERSION</span>=3</code></pre>
<p>åªè¦å¼€å§‹ç¼–è¯‘å°±å¯ä»¥åœä¸‹æ¥äº†ï¼Œå› ä¸ºè¿™æ˜¯å•çº¿ç¨‹å¾ˆæ…¢ï¼Œä½†æ˜¯åŸºæœ¬çš„makefileå·²ç»æœ‰äº†ã€‚</p>
<p><code>sudo make -j4</code></p>
<p>è¿™é‡Œ<code>-j4</code>è¡¨ç¤ºä½¿ç”¨4çº¿ç¨‹ç¼–è¯‘ï¼Œä¼šæ¯”å•çº¿ç¨‹å¿«å¾ˆå¤šã€‚</p>
<p>æŠ€å·§ï¼šbuildè¿‡ç¨‹éšæ—¶æŸ¥çœ‹Makefileï¼Œæ£€æŸ¥ç¼–è¯‘è¿›åº¦ã€‚å¦‚æœæŸä¸ªtargetæœ‰é—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€è¦å•ç‹¬buildè¿™ä¸ªtargetå³å¯ï¼Œæ¯”å¦‚</p>
<pre><code class="hljs puppet">sudo make -<span class="hljs-keyword">j4</span> &#123;æŒ‚æ‰çš„<span class="hljs-literal">target</span>ï¼Œåœ¨makefileæœ€åå¯ä»¥æ‰¾åˆ°&#125;</code></pre>
<h2 id="p3-å†…å­˜ä¸è¶³"><a href="#p3-å†…å­˜ä¸è¶³" class="headerlink" title="p3:å†…å­˜ä¸è¶³"></a>p3:å†…å­˜ä¸è¶³</h2><pre><code class="hljs shell">c++: fatal error: Killed signal terminated program cc1plus</code></pre>
<p>è¿™æ˜¯å› ä¸ºå†…å­˜ä¸å¤Ÿäº†ã€‚è¿™é‡Œæœ‰ä¸ªæ–¹æ³•ï¼š</p>
<pre><code class="hljs jboss-cli">sudo sh -c &#x27;<span class="hljs-keyword">echo</span> 1 &gt; <span class="hljs-string">/proc/sys/vm/drop_caches</span>&#x27;
sudo sh -c &#x27;<span class="hljs-keyword">echo</span> 2 &gt; <span class="hljs-string">/proc/sys/vm/drop_caches</span>&#x27;
sudo sh -c &#x27;<span class="hljs-keyword">echo</span> 3 &gt; <span class="hljs-string">/proc/sys/vm/drop_caches</span>&#x27;</code></pre>
<p>åˆ©ç”¨ä¸Šè¿°å‘½ä»¤æ¸…ç†ç¼“å­˜åŒºçš„å†…å­˜ã€‚</p>
<h2 id="p4-npmé—®é¢˜ï¼Œä¸build-MGR-DASHBOARD-FRONTENDå°±æ²¡æœ‰é—®é¢˜"><a href="#p4-npmé—®é¢˜ï¼Œä¸build-MGR-DASHBOARD-FRONTENDå°±æ²¡æœ‰é—®é¢˜" class="headerlink" title="p4:npmé—®é¢˜ï¼Œä¸build MGR_DASHBOARD_FRONTENDå°±æ²¡æœ‰é—®é¢˜"></a>p4:npmé—®é¢˜ï¼Œä¸build MGR_DASHBOARD_FRONTENDå°±æ²¡æœ‰é—®é¢˜</h2><pre><code class="hljs gams">Environment <span class="hljs-keyword">variables</span> have <span class="hljs-comment">been set</span>
sh: 1: ng: not <span class="hljs-comment">found</span>
npm <span class="hljs-comment">ERR! file sh</span>
npm <span class="hljs-comment">ERR! code ELIFECYCLE</span>
npm <span class="hljs-comment">ERR! errno ENOENT</span>
npm <span class="hljs-comment">ERR! syscall spawn</span>
npm <span class="hljs-comment">ERR! ceph-dashboard@0.0.0 build:</span> `<span class="hljs-comment">npm run env_build &amp;&amp; ng build</span> <span class="hljs-comment">&quot;--progress=false&quot;</span>`
npm <span class="hljs-comment">ERR! spawn ENOENT</span>
npm <span class="hljs-comment">ERR!</span> 
npm <span class="hljs-comment">ERR! Failed at the ceph-dashboard@0.0.0 build script.</span>
npm <span class="hljs-comment">ERR! This is probably not a problem with npm. There is likely additional logging output above.</span>

npm <span class="hljs-comment">ERR! A complete log of this run can be found in:</span>
npm <span class="hljs-comment">ERR!</span>     /home/<span class="hljs-comment">ceph</span>/.npm/<span class="hljs-comment">_logs</span>/<span class="hljs-number">2020</span><span class="hljs-number">-10</span><span class="hljs-number">-24</span>T05_33_57_314Z-debug.<span class="hljs-built_in">log</span>
src/<span class="hljs-comment">pybind</span>/mgr/<span class="hljs-comment">dashboard</span>/CMakeFiles/<span class="hljs-comment">mgr-dashboard-frontend-build.dir</span>/build.make:<span class="hljs-number">3072</span>: recipe <span class="hljs-keyword">for</span> target <span class="hljs-comment">&#x27;../src/pybind/mgr/dashboard/frontend/dist&#x27;</span> failed
make[<span class="hljs-number">2</span>]: *** [../<span class="hljs-comment">src</span>/pybind/<span class="hljs-comment">mgr</span>/dashboard/<span class="hljs-comment">frontend</span>/dist] Error <span class="hljs-number">1</span>
CMakeFiles/<span class="hljs-comment">Makefile2:4897: recipe for target</span> <span class="hljs-comment">&#x27;src/pybind/mgr/dashboard/CMakeFiles/mgr-dashboard-frontend-build.dir/all&#x27;</span><span class="hljs-comment"> failed</span>
make[1]: *** [src/pybind/mgr/dashboard/CMakeFiles/mgr-dashboard-frontend-build.dir/all] Error <span class="hljs-comment">2</span>
make[1]: *** Waiting <span class="hljs-comment">for unfinished jobs....</span></code></pre>
<p><strong>æ³¨æ„ï¼šbuilt target xxxè¡¨ç¤ºè¿™ä¸ªä»»åŠ¡å·²ç»æˆåŠŸç¼–è¯‘å®Œäº†ã€‚</strong> </p>
<p>è¿›è¡Œåˆ°50%æç¤ºæ²¡æœ‰æ‰¾åˆ°ngè¿™ä¸ªå‘½ä»¤,æŸ¥äº†ä¸€ä¸‹ï¼Œæ˜¯å› ä¸ºæ²¡æœ‰ä¸‹npmåŒ…çš„åŸå› ï¼Œè§£å†³åŠæ³•ï¼Œå¦‚æœé‡åˆ°æ‰¾ä¸åˆ°ä¾èµ–æƒ…å†µå¯ä»¥æ ¹æ®æç¤ºæ‰¾ç¼ºå¤±ä¾èµ–ï¼Œé€çº§å¯»æ‰¾ï¼š</p>
<p>In case others come here with this issue as I have, here is how I solved it system-wide on MacOS. Hope this helps.</p>
<p>Verify node is installed:</p>
<pre><code class="hljs crmsh">$ <span class="hljs-keyword">node</span> <span class="hljs-title">-v</span>
v11.<span class="hljs-number">2.0</span></code></pre>
<p>Verify npm is installed:</p>
<pre><code class="hljs angelscript">$ npm -v
<span class="hljs-number">6.4</span><span class="hljs-number">.1</span></code></pre>
<p>Verify your npm global install file path is configured (known as <a target="_blank" rel="noopener" href="https://docs.npmjs.com/files/folders#prefix-configuration">prefix</a>). Mine is under ~/.npm-packages:</p>
<pre><code class="hljs routeros">$ npm<span class="hljs-built_in"> config </span>ls -l | grep prefix
prefix = <span class="hljs-string">&quot;/Users/christiangroleau/.npm-packages&quot;</span></code></pre>
<p>If not, you can place it into your ~/.npmrc file:</p>
<pre><code class="hljs jboss-cli"><span class="hljs-keyword">echo</span> prefix=~<span class="hljs-string">/.npm-packages</span> &gt;&gt; ~<span class="hljs-string">/.npmrc</span></code></pre>
<p>Verify that your prefix path is listed in your system PATH:</p>
<pre><code class="hljs awk">$ echo <span class="hljs-variable">$PATH</span>
<span class="hljs-regexp">/Users/</span>christiangroleau<span class="hljs-regexp">/.npm-packages/</span>bin:<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin:/u</span>sr<span class="hljs-regexp">/bin:/</span>bin:<span class="hljs-regexp">/usr/</span>sbin:/sbin</code></pre>
<p>If not, invoke the following:</p>
<pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.npm-packages/bin:<span class="hljs-variable">$PATH</span>&quot;</span></code></pre>
<p>Finally, you can reinstall angular-cli (in my case I needed to install it globally):</p>
<pre><code class="hljs coffeescript">$ <span class="hljs-built_in">npm</span> install -g @angular/cli</code></pre>
<p>Verify installation:</p>
<pre><code class="hljs brainfuck"><span class="hljs-comment">$</span> <span class="hljs-comment">ng</span> <span class="hljs-literal">-</span><span class="hljs-comment">v</span>
<span class="hljs-comment">Mg</span>++ <span class="hljs-comment">version:</span>
<span class="hljs-comment">	Mg</span>++ <span class="hljs-comment">1</span><span class="hljs-string">.</span><span class="hljs-comment">5beta1</span> <span class="hljs-comment">(formerly</span> <span class="hljs-comment">MicroGnuEmacs</span> <span class="hljs-comment">Adv</span><span class="hljs-string">.</span><span class="hljs-comment">)</span></code></pre>
<h2 id="p5-npmè¢«é”"><a href="#p5-npmè¢«é”" class="headerlink" title="p5: npmè¢«é”"></a>p5: npmè¢«é”</h2><pre><code class="hljs gams">Environment <span class="hljs-keyword">variables</span> have <span class="hljs-comment">been set</span>
panic: aborting <span class="hljs-comment">due to terminal initialize failure</span>
Aborted <span class="hljs-comment">(core dumped)</span>
npm <span class="hljs-comment">ERR! code ELIFECYCLE</span>
npm <span class="hljs-comment">ERR! errno 134</span>
npm <span class="hljs-comment">ERR! ceph-dashboard@0.0.0 build:</span> `<span class="hljs-comment">npm run env_build &amp;&amp; ng build</span> <span class="hljs-comment">&quot;--progress=false&quot;</span>`
npm <span class="hljs-comment">ERR! Exit status 134</span>
npm <span class="hljs-comment">ERR!</span> 
npm <span class="hljs-comment">ERR! Failed at the ceph-dashboard@0.0.0 build script.</span>
npm <span class="hljs-comment">ERR! This is probably not a problem with npm. There is likely additional logging output above.</span>

npm <span class="hljs-comment">ERR! A complete log of this run can be found in:</span>
npm <span class="hljs-comment">ERR!</span>     /home/<span class="hljs-comment">ceph</span>/.npm/<span class="hljs-comment">_logs</span>/<span class="hljs-number">2020</span><span class="hljs-number">-10</span><span class="hljs-number">-24</span>T12_17_18_469Z-debug.<span class="hljs-built_in">log</span>
src/<span class="hljs-comment">pybind</span>/mgr/<span class="hljs-comment">dashboard</span>/CMakeFiles/<span class="hljs-comment">mgr-dashboard-frontend-build.dir</span>/build.make:<span class="hljs-number">3072</span>: recipe <span class="hljs-keyword">for</span> target <span class="hljs-comment">&#x27;../src/pybind/mgr/dashboard/frontend/dist&#x27;</span> failed
make[<span class="hljs-number">2</span>]: *** [../<span class="hljs-comment">src</span>/pybind/<span class="hljs-comment">mgr</span>/dashboard/<span class="hljs-comment">frontend</span>/dist] Error <span class="hljs-number">134</span>
CMakeFiles/<span class="hljs-comment">Makefile2:4897: recipe for target</span> <span class="hljs-comment">&#x27;src/pybind/mgr/dashboard/CMakeFiles/mgr-dashboard-frontend-build.dir/all&#x27;</span><span class="hljs-comment"> failed</span>
make[1]: *** [src/pybind/mgr/dashboard/CMakeFiles/mgr-dashboard-frontend-build.dir/all] Error <span class="hljs-comment">2</span>
make[1]: *** Waiting <span class="hljs-comment">for unfinished jobs....</span>
[ 40%] Built <span class="hljs-comment">target os</span>
[ 46%] Built <span class="hljs-comment">target rbd_internal</span>
[ 51%] Built <span class="hljs-comment">target rgw_common</span>
Makefile:140: recipe <span class="hljs-comment">for target</span> <span class="hljs-comment">&#x27;all&#x27;</span><span class="hljs-comment"> failed</span>
make: *** [all] Error <span class="hljs-comment">2</span>
</code></pre>
<p>è¿™ä¸ªé—®é¢˜å¾ˆæ¶å¿ƒï¼ŒèŠ±äº†æˆ‘å¾ˆä¹…æ—¶é—´ã€‚</p>
<p>é¦–å…ˆä¸‹è½½npm</p>
<p> <code>$sudo apt install npm</code></p>
<p>ç„¶åï¼Œæ‰¾åˆ°<code>/ceph-14.2.4/build/src/pybind/mgr/dashboard/node-env/lib</code>ä¸‹çš„<code>node-modules</code></p>
<ul>
<li><code>sudo npm cache clean --force</code></li>
<li>delete <code>node_modules</code> folder, use <code>rm -r</code></li>
<li>delete <code>package-lock.json</code> file </li>
<li><code>sudo npm install</code></li>
</ul>
<p><strong>æ³¨æ„æ³¨æ„æ³¨æ„ï¼</strong>ï¼Œæ…ç”¨<code>rm -rf</code>ï¼Œåæœè‡ªè´Ÿï¼</p>
<h2 id="p6-gitæ–‡ä»¶æ²¡ç‰ˆæœ¬å·"><a href="#p6-gitæ–‡ä»¶æ²¡ç‰ˆæœ¬å·" class="headerlink" title="p6: gitæ–‡ä»¶æ²¡ç‰ˆæœ¬å·"></a>p6: gitæ–‡ä»¶æ²¡ç‰ˆæœ¬å·</h2><pre><code class="hljs angelscript">/home/ceph/ceph<span class="hljs-number">-15.2</span><span class="hljs-number">.5</span>/build/src/include/ceph_ver.h:<span class="hljs-number">4</span>:<span class="hljs-number">26</span>: error: expected â€˜=â€™, â€˜,â€™, â€˜;â€™, â€˜asmâ€™ <span class="hljs-keyword">or</span> â€˜__attribute__â€™ before â€˜/â€™ token
    <span class="hljs-number">4</span> | #define CEPH_GIT_VER <span class="hljs-built_in">ref</span>s/heads/master
      |                          ^
/home/ceph/ceph<span class="hljs-number">-15.2</span><span class="hljs-number">.5</span>/src/ceph_ver.c:<span class="hljs-number">6</span>:<span class="hljs-number">34</span>: note: <span class="hljs-keyword">in</span> expansion of macro â€˜CONCAT_VER_SYMBOLâ€™
    <span class="hljs-number">6</span> | #define DEFINE_VER_SYMBOL(x) <span class="hljs-built_in">int</span> CONCAT_VER_SYMBOL(x)
      |                                  ^~~~~~~~~~~~~~~~~
/home/ceph/ceph<span class="hljs-number">-15.2</span><span class="hljs-number">.5</span>/src/ceph_ver.c:<span class="hljs-number">8</span>:<span class="hljs-number">1</span>: note: <span class="hljs-keyword">in</span> expansion of macro â€˜DEFINE_VER_SYMBOLâ€™
    <span class="hljs-number">8</span> | DEFINE_VER_SYMBOL(CEPH_GIT_VER);
      | ^~~~~~~~~~~~~~~~~
/home/ceph/ceph<span class="hljs-number">-15.2</span><span class="hljs-number">.5</span>/src/ceph_ver.c:<span class="hljs-number">8</span>:<span class="hljs-number">19</span>: note: <span class="hljs-keyword">in</span> expansion of macro â€˜CEPH_GIT_VERâ€™
    <span class="hljs-number">8</span> | DEFINE_VER_SYMBOL(CEPH_GIT_VER);
      |                   ^~~~~~~~~~~~
src/CMakeFiles/common-objs.dir/build.make:<span class="hljs-number">63</span>: recipe <span class="hljs-keyword">for</span> target <span class="hljs-string">&#x27;src/CMakeFiles/common-objs.dir/ceph_ver.c.o&#x27;</span> failed
make[<span class="hljs-number">3</span>]: *** [src/CMakeFiles/common-objs.dir/ceph_ver.c.o] Error <span class="hljs-number">1</span>
CMakeFiles/Makefile2:<span class="hljs-number">727</span>: recipe <span class="hljs-keyword">for</span> target <span class="hljs-string">&#x27;src/CMakeFiles/common-objs.dir/all&#x27;</span> failed
make[<span class="hljs-number">2</span>]: *** [src/CMakeFiles/common-objs.dir/all] Error <span class="hljs-number">2</span>
make[<span class="hljs-number">2</span>]: *** Waiting <span class="hljs-keyword">for</span> unfinished jobs....
</code></pre>
<p>æ‰¾åˆ°/home/ceph/ceph-15.2.5/build/src/include/ceph_ver.hæ–‡ä»¶</p>
<pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CEPH_GIT_VER refs/heads/master</span></code></pre>
<p>æ”¹ä¸º</p>
<pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CEPH_GIT_VER 150205</span></code></pre>
<p>è¿™æ˜¯ä¸å¾—å·²ä¹‹ä¸¾ï¼Œå¿…é¡»æ”¹æˆæ•´æ•°ç‰ˆæœ¬å·ï¼Œå¯ä»¥è§£å†³å°±å°†å°±ä¸€ä¸‹ã€‚</p>
<h2 id="p7-undefined-reference-to-HMAC-CTX-newâ€™"><a href="#p7-undefined-reference-to-HMAC-CTX-newâ€™" class="headerlink" title="p7: undefined reference to `HMAC_CTX_newâ€™"></a>p7: undefined reference to `HMAC_CTX_newâ€™</h2><pre><code class="hljs shell">running build
running build_ext
<span class="hljs-meta">[100%</span><span class="bash">] Built target cython_rados</span>
../lib/libcommon.a(Crypto.cc.o): In function `ceph::crypto::ssl::HMAC::HMAC(evp_md_st const*, unsigned char const*, unsigned long)&#x27;:
/home/ceph/ceph-14.2.4/src/common/ceph_crypto.h:284: undefined reference to `HMAC_CTX_new&#x27;
../lib/libcommon.a(Crypto.cc.o): In function `ceph::crypto::ssl::HMAC::~HMAC()&#x27;:
/home/ceph/ceph-14.2.4/src/common/ceph_crypto.h:291: undefined reference to `HMAC_CTX_free&#x27;
../lib/libcommon.a(ceph_crypto.cc.o): In function `ceph::crypto::ssl::OpenSSLDigest::OpenSSLDigest(evp_md_st const*)&#x27;:
/home/ceph/ceph-14.2.4/src/common/ceph_crypto.cc:94: undefined reference to `EVP_MD_CTX_new&#x27;
../lib/libcommon.a(ceph_crypto.cc.o): In function `ceph::crypto::ssl::OpenSSLDigest::~OpenSSLDigest()&#x27;:
/home/ceph/ceph-14.2.4/src/common/ceph_crypto.cc:100: undefined reference to `EVP_MD_CTX_free&#x27;
collect2: error: ld returned 1 exit status
src/CMakeFiles/ceph-osd.dir/build.make:145: recipe for target &#x27;bin/ceph-osd&#x27; failed
make[3]: *** [bin/ceph-osd] Error 1
CMakeFiles/Makefile2:1256: recipe for target &#x27;src/CMakeFiles/ceph-osd.dir/all&#x27; failed
make[2]: *** [src/CMakeFiles/ceph-osd.dir/all] Error 2
CMakeFiles/Makefile2:804: recipe for target &#x27;src/CMakeFiles/vstart-base.dir/rule&#x27; failed
make[1]: *** [src/CMakeFiles/vstart-base.dir/rule] Error 2
Makefile:318: recipe for target &#x27;vstart-base&#x27; failed
make: *** [vstart-base] Error 2
</code></pre>
<p>è§£å†³æ–¹æ³•</p>
<p><code>sudo apt-get install libssl-dev</code></p>
<h2 id="p8-ç¼ºå¤±curlåº“"><a href="#p8-ç¼ºå¤±curlåº“" class="headerlink" title="p8: ç¼ºå¤±curlåº“"></a>p8: ç¼ºå¤±curlåº“</h2><pre><code class="hljs shell">/home/ceph/ceph-14.2.4/src/rgw/rgw_http_client_curl.cc:7:10: fatal error: curl/curl.h: No such file or directory
    7 | #include &lt;curl/curl.h&gt;
      |          ^~~~~~~~~~~~~
compilation terminated.
</code></pre>
<pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> apt install libcurl<span class="hljs-number">4</span>-gnutls</code></pre>
<h2 id="p9-ç¼ºå¤±yamlåº“"><a href="#p9-ç¼ºå¤±yamlåº“" class="headerlink" title="p9: ç¼ºå¤±yamlåº“"></a>p9: ç¼ºå¤±yamlåº“</h2><pre><code class="hljs angelscript">Best match: PyYAML <span class="hljs-number">5.3</span><span class="hljs-number">.1</span>
Processing PyYAML<span class="hljs-number">-5.3</span><span class="hljs-number">.1</span>.tar.gz
Writing /tmp/easy_install-_fQ46U/PyYAML<span class="hljs-number">-5.3</span><span class="hljs-number">.1</span>/setup.cfg
Running PyYAML<span class="hljs-number">-5.3</span><span class="hljs-number">.1</span>/setup.py -q bdist_egg --dist-dir /tmp/easy_install-_fQ46U/PyYAML<span class="hljs-number">-5.3</span><span class="hljs-number">.1</span>/egg-dist-tmp-ZSDHMj
In file included <span class="hljs-keyword">from</span> ext/_yaml.c:<span class="hljs-number">596</span>:
ext/_yaml.h:<span class="hljs-number">2</span>:<span class="hljs-number">10</span>: fatal error: yaml.h: No such file <span class="hljs-keyword">or</span> directory
    <span class="hljs-number">2</span> | #include &lt;yaml.h&gt;
      |          ^~~~~~~~
</code></pre>
<pre><code class="hljs q">sudo apt-<span class="hljs-built_in">get</span> install libyaml-cpp-<span class="hljs-built_in">dev</span></code></pre>
<h2 id="p10-ç¼ºå¤±sdtåº“"><a href="#p10-ç¼ºå¤±sdtåº“" class="headerlink" title="p10. ç¼ºå¤±sdtåº“"></a>p10. ç¼ºå¤±sdtåº“</h2><pre><code class="hljs yaml"><span class="hljs-attr">sys/sdt.h:</span> <span class="hljs-literal">No</span> <span class="hljs-string">such</span> <span class="hljs-string">file</span> <span class="hljs-string">or</span> <span class="hljs-string">directory</span>   
<span class="hljs-number">111</span> <span class="hljs-string">|</span> <span class="hljs-comment">#include &lt;sys/sdt.h&gt;</span></code></pre>
<pre><code class="hljs cmake">sudo apt <span class="hljs-keyword">install</span> systemtap-sdt-dev</code></pre>
<h2 id="p11-undefined-reference-to-symbol-â€˜HMAC-CTX-new-OPENSSL-1-1-0â€™ï¼Œç”¨python2ç¼–è¯‘ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜"><a href="#p11-undefined-reference-to-symbol-â€˜HMAC-CTX-new-OPENSSL-1-1-0â€™ï¼Œç”¨python2ç¼–è¯‘ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜" class="headerlink" title="p11:undefined reference to symbol â€˜HMAC_CTX_new@@OPENSSL_1_1_0â€™ï¼Œç”¨python2ç¼–è¯‘ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜"></a>p11:undefined reference to symbol â€˜HMAC_CTX_new@@OPENSSL_1_1_0â€™ï¼Œç”¨python2ç¼–è¯‘ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜</h2><pre><code class="hljs shell">/usr/bin/ld: warning: libcrypto.so.1.1, needed by /usr/lib/x86_64-linux-gnu/librabbitmq.so, may conflict with libcrypto.so.1.0.0
/usr/bin/ld: ../../lib/librgw_a.a(rgw_common.cc.o): undefined reference to symbol &#x27;HMAC_CTX_new@@OPENSSL_1_1_0&#x27;
//usr/lib/x86_64-linux-gnu/libcrypto.so.1.1: error adding symbols: DSO missing from command line
collect2: error: ld returned 1 exit status
</code></pre>
<p>OPENSSLæœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„åº“ï¼Œ1.1å’Œ1.0.0ï¼Œå¾ˆæ˜¾ç„¶æˆ‘ç³»ç»Ÿå®‰è£…çš„æ˜¯<code>1.1.1</code> å¯¼è‡´å†²çªäº†ï¼Œ</p>
<blockquote>
<p>Makefile é€‰é¡¹ CFLAGS ã€LDFLAGS ã€LIBS<br>CFLAGS è¡¨ç¤ºç”¨äºCç¼–è¯‘å™¨çš„é€‰é¡¹<br>CXXFLAGS è¡¨ç¤ºç”¨äºC++ç¼–è¯‘å™¨çš„é€‰é¡¹<br>è¿™ä¸¤ä¸ªå˜é‡å®é™…ä¸Šæ¶µç›–äº†ç¼–è¯‘å’Œæ±‡ç¼–çš„ä¸¤ä¸ªæ­¥éª¤</p>
</blockquote>
<p>CFLAGSï¼šæŒ‡å®šå¤´æ–‡ä»¶(.h)çš„è·¯å¾„ï¼Œå¦‚ï¼šCFLAGS=-I/usr/include -I/path/include ã€‚</p>
<p>ç›¸åŒåœ°ï¼Œå®‰è£…ä¸€ä¸ªåŒ…æ—¶ä¼šåœ¨å®‰è£…è·¯å¾„ä¸‹å»ºç«‹ä¸€ä¸ªincludeæ–‡ä»¶å¤¹ï¼Œå½“å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°æ•…éšœæ—¶ï¼Œè¯•ç€æŠŠæ›¾ç»å®‰è£…çš„åŒ…çš„includeæ–‡ä»¶å¤¹å¢åŠ åˆ°è¯¥å˜é‡ä¸­æ¥ã€‚</p>
<p>LDFLAGSï¼šgcc ç­‰ç¼–è¯‘å™¨ä¼šç”¨åˆ°çš„ä¸€äº›ä¼˜åŒ–åƒæ•°ï¼Œä¹Ÿèƒ½å¤Ÿåœ¨é‡Œé¢æŒ‡å®šåº“æ–‡ä»¶çš„ä½ç½®ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•ï¼šLDFLAGS=-L/usr/lib -L/path/to/your/libã€‚æ¯å®‰è£…ä¸€ä¸ªåŒ…éƒ½å·®ç‚¹å„¿ä¸€å®šçš„ä¼šåœ¨å®‰è£…æ–‡ä»¶å¤¹é‡Œå»ºç«‹ä¸€ä¸ªlibæ–‡ä»¶å¤¹ã€‚å‡è®¾æ˜æ˜å®‰è£…äº†æŸä¸ªåŒ…ï¼Œè€Œå®‰è£…è¿˜æœ‰ä¸€ä¸ªåŒ…æ—¶ï¼Œå®ƒæ„£æ˜¯è¯´æ‰¾ä¸åˆ°ï¼Œèƒ½å¤ŸæŠ’é‚£ä¸ªåŒ…çš„libè·¯å¾„å¢åŠ çš„LDFALGSä¸­è¯•ä¸€ä¸‹ã€‚</p>
<p>LIBSï¼šå‘Šè¯‰é“¾æ¥å™¨è¦é“¾æ¥å“ªäº›åº“æ–‡ä»¶ã€‚å¦‚LIBS = -lpthread -liconv</p>
<p>ç®€å•åœ°è¯´ï¼ŒLDFLAGSæ˜¯å‘Šè¯‰é“¾æ¥å™¨ä»å“ªé‡Œå¯»æ‰¾åº“æ–‡ä»¶ï¼Œè€ŒLIBSæ˜¯å‘Šè¯‰é“¾æ¥å™¨è¦é“¾æ¥å“ªäº›åº“æ–‡ä»¶ã€‚</p>
<p>æœ‰æ—¶å€™LDFLAGSæŒ‡å®š-Lå°½ç®¡èƒ½è®©é“¾æ¥å™¨æ‰¾åˆ°åº“è¿›è¡Œé“¾æ¥ã€‚å¯æ˜¯è¿è¡Œæ—¶é“¾æ¥å™¨å´æ‰¾ä¸åˆ°è¿™ä¸ªåº“ã€‚å‡è®¾è¦è®©è½¯ä»¶è¿è¡Œæ—¶åº“æ–‡ä»¶çš„è·¯å¾„ä¹Ÿå¾—åˆ°æ‰©å±•ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¡»è¦å¢åŠ è¿™ä¸¤ä¸ªåº“ç»™â€-Wl,Râ€ï¼š</p>
<p>LDFLAGS = -L/var/xxx/lib -L/opt/mysql/lib -Wl,R/var/xxx/lib -Wl,R/opt/mysql/lib<br>å‡è®¾åœ¨è¿è¡Œ./configureæ›¾ç»ç¯å¢ƒå˜é‡è®¾ç½®export LDFLAGS=â€-L/var/xxx/lib -L/opt/mysql/lib -Wl,R/var/xxx/lib -Wl,R/opt/mysql/libâ€ ï¼Œæ³¨æ„ç¯å¢ƒå˜é‡è®¾ç½®ç­‰å·ä¸¤è¾¹ä¸èƒ½å¤Ÿæœ‰ç©ºæ ¼ï¼Œå¹¶ä¸”è¦åŠ ä¸Šå¼•è™Ÿï¼ˆshellçš„ä½¿ç”¨æ–¹æ³•ï¼‰ã€‚é‚£ä¹ˆè¿è¡Œconfigureä»¥åã€‚Makefileå°†ä¼šè®¾ç½®è¿™ä¸ªé€‰é¡¹ã€‚é“¾æ¥æ—¶ä¼šæœ‰è¿™ä¸ªåƒæ•°ï¼Œç¼–è¯‘å‡ºæ¥çš„å¯è¿è¡Œç¨‹åºçš„åº“æ–‡ä»¶æœç´¢è·¯å¾„å°±å¾—åˆ°æ‰©å±•äº†ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/fqnb001/p/8778790.html">ä»€ä¹ˆæ˜¯è½¯é“¾æ¥ï¼Œç¡¬é“¾æ¥</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37806908/article/details/97686753">linux .so .o .aæ–‡ä»¶åŒºåˆ«</a></p>
<p>â€‹     .o,æ˜¯ç›®æ ‡æ–‡ä»¶,ç›¸å½“äºwindowsä¸­çš„.objæ–‡ä»¶ </p>
<p>ã€€.so ä¸ºå…±äº«åº“,æ˜¯shared object,ç”¨äºåŠ¨æ€è¿æ¥çš„,ç›¸å½“äºwindowsä¸‹çš„dll </p>
<p>ã€€.aä¸ºé™æ€åº“,æ˜¯å¥½å¤šä¸ª.oåˆåœ¨ä¸€èµ·,ç”¨äºé™æ€è¿æ¥ </p>
<p><code>sudo ll &#123;æ–‡ä»¶å&#125;</code> æŸ¥çœ‹æ‰€æœ‰é“¾æ¥</p>
<p><code>$sudo unlink libcrypto.so</code>è§£é“¾æ¥, soè¡¨ç¤º</p>
<p><code>$sudo ln -s libcrypto.so.1.1 libcrypto.so</code> æ·»åŠ é“¾æ¥</p>
<p>å¦‚ä½•æŸ¥çœ‹opensslç‰ˆæœ¬?</p>
<p><code>openssl version -a</code></p>
<p>ubuntué»˜è®¤å®‰è£…1.1.1ï¼Œæ²¡äº‹åˆ«å¸è½½ï¼Œå¦åˆ™å¾ˆå¤šåŠŸèƒ½ä¼šå¤±æ•ˆï¼Œæ¯”å¦‚chrome</p>
<h2 id="p12-Make-all-å‡ºç°ELF-section-name-out-of-range"><a href="#p12-Make-all-å‡ºç°ELF-section-name-out-of-range" class="headerlink" title="p12. Make all å‡ºç°ELF section name out of range"></a>p12. Make all å‡ºç°ELF section name out of range</h2><pre><code class="hljs stata">/usr/bin/ld: warning: CMakeFiles/unittest_rbd_mirror.<span class="hljs-keyword">dir</span>/test_mock_ImageReplayer.<span class="hljs-keyword">cc</span>.o has a corrupt string <span class="hljs-keyword">table</span> index - ignoring
/usr/bin/ld: <span class="hljs-keyword">error</span>: CMakeFiles/unittest_rbd_mirror.<span class="hljs-keyword">dir</span>/test_mock_ImageReplayer.<span class="hljs-keyword">cc</span>.o: ELF section name <span class="hljs-keyword">out</span> of <span class="hljs-keyword">range</span>
collect2: <span class="hljs-keyword">error</span>: ld returned 1 <span class="hljs-keyword">exit</span> status
src/<span class="hljs-keyword">test</span>/rbd_mirror/CMakeFiles/unittest_rbd_mirror.<span class="hljs-keyword">dir</span>/build.make:951: recipe <span class="hljs-keyword">for</span> target &#x27;bin/unittest_rbd_mirror&#x27; failed
make[2]: *** [bin/unittest_rbd_mirror] <span class="hljs-keyword">Error</span> 1
CMakeFiles/Makefile2:26032: recipe <span class="hljs-keyword">for</span> target &#x27;src/<span class="hljs-keyword">test</span>/rbd_mirror/CMakeFiles/unittest_rbd_mirror.<span class="hljs-keyword">dir</span>/all&#x27; failed
make[1]: *** [src/<span class="hljs-keyword">test</span>/rbd_mirror/CMakeFiles/unittest_rbd_mirror.<span class="hljs-keyword">dir</span>/all] <span class="hljs-keyword">Error</span> 2
</code></pre>
<p>ç›´æ¥é‡æ–°makeå°±å¥½äº†ï¼Œç„å­¦é—®é¢˜</p>
<h2 id="P13-internal-compiler-error-Segmentation-fault"><a href="#P13-internal-compiler-error-Segmentation-fault" class="headerlink" title="P13:internal compiler error: Segmentation fault"></a>P13:internal compiler error: Segmentation fault</h2><pre><code class="hljs gradle"><span class="hljs-regexp">/home/</span>ceph-server<span class="hljs-regexp">/ceph-15.2.5/</span>src<span class="hljs-regexp">/osd/</span>ECBackend.cc: In member function â€˜<span class="hljs-keyword">void</span> ECBackend::filter_read_op(const OSDMapRef&amp;, ECBackend::ReadOp&amp;)â€™:
<span class="hljs-regexp">/home/</span>ceph-server<span class="hljs-regexp">/ceph-15.2.5/</span>src<span class="hljs-regexp">/osd/</span>ECBackend.cc:<span class="hljs-number">1398</span>:<span class="hljs-number">1</span>: internal compiler error: Segmentation fault
 <span class="hljs-number">1398</span> | &#125;
      | ^
Please submit a full bug report,
with preprocessed <span class="hljs-keyword">source</span> <span class="hljs-keyword">if</span> appropriate.
</code></pre>
<p>é‡æ–°ç¼–è¯‘</p>
<hr>
<h1 id="Way-to-developmentâ€¦"><a href="#Way-to-developmentâ€¦" class="headerlink" title="Way to developmentâ€¦"></a>Way to developmentâ€¦</h1><p>å¥½çš„åœ¨è¿™é‡Œå‡è®¾ä½ ç¼–è¯‘æºç æˆåŠŸäº†ï¼</p>
<p>å…ˆä¸è¦åº†ç¥</p>
<p>å¥½æˆæ‰åˆšåˆšå¼€å§‹ï¼</p>
<h2 id="æµ‹è¯•é›†ç¾¤"><a href="#æµ‹è¯•é›†ç¾¤" class="headerlink" title="æµ‹è¯•é›†ç¾¤"></a>æµ‹è¯•é›†ç¾¤</h2><pre><code class="hljs shell">../src/vstart.sh --debug --new -x --localhost --bluestore # å¯åŠ¨æœ¬åœ°é›†ç¾¤ é‡‡ç”¨bluestoreå¯¹è±¡å­˜å‚¨
./bin/ceph -s #è¿”å›é›†ç¾¤çŠ¶æ€</code></pre>
<p>æ³¨ï¼š./binæ–‡ä»¶ï¼Œå‰é¢åªæœ‰ä¸€ä¸ªç‚¹ï¼Œä½ æ‰€æœ‰èƒ½è¿è¡Œçš„è„šæœ¬éƒ½åœ¨è¿™ï¼Œå¤§éƒ¨åˆ†éƒ½æ— æ³•ç›´æ¥ä¿®æ”¹ï¼</p>
<p>ç¬”è€…è¿è¡Œæ²¡æœ‰é‡åˆ°é—®é¢˜ï¼Œæœ‰ä¸€äº›é—®é¢˜å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40071358/article/details/106924184">è¿™å„¿</a>æ‰¾åˆ°ç­”æ¡ˆã€‚</p>
<p>å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œç¬”è€…å¾—åˆ°çš„è¾“å‡ºåº”è¯¥å¦‚ä¸‹ï¼Œä½ çš„ä¹Ÿåº”è¯¥ç±»ä¼¼ï¼š</p>
<pre><code class="hljs angelscript">*** DEVELOPER MODE: setting PATH, PYTHONPATH <span class="hljs-keyword">and</span> LD_LIBRARY_PATH ***
<span class="hljs-number">2020</span><span class="hljs-number">-10</span><span class="hljs-number">-31</span>T09:<span class="hljs-number">50</span>:<span class="hljs-number">54.832</span>+<span class="hljs-number">0800</span> <span class="hljs-number">7f</span>1160a3b700 <span class="hljs-number">-1</span> WARNING: all dangerous <span class="hljs-keyword">and</span> experimental features are enabled.
<span class="hljs-number">2020</span><span class="hljs-number">-10</span><span class="hljs-number">-31</span>T09:<span class="hljs-number">50</span>:<span class="hljs-number">54.844</span>+<span class="hljs-number">0800</span> <span class="hljs-number">7f</span>1160a3b700 <span class="hljs-number">-1</span> WARNING: all dangerous <span class="hljs-keyword">and</span> experimental features are enabled.
  cluster:
    id:     <span class="hljs-number">773</span>a0719<span class="hljs-number">-3</span>ed0<span class="hljs-number">-49f</span>a-a168<span class="hljs-number">-88</span>bd2ddc2d00
    health: HEALTH_OK
 
  services:
    mon: <span class="hljs-number">3</span> daemons, quorum a,b,c (age <span class="hljs-number">99</span>s)
    mgr: x(active, since <span class="hljs-number">91</span>s)
    mds: a:<span class="hljs-number">1</span> &#123;<span class="hljs-number">0</span>=c=up:active&#125; <span class="hljs-number">2</span> up:standby
    osd: <span class="hljs-number">3</span> osds: <span class="hljs-number">3</span> up (since <span class="hljs-number">66</span>s), <span class="hljs-number">3</span> <span class="hljs-keyword">in</span> (since <span class="hljs-number">66</span>s)
 
  task status:
    scrub status:
        mds.c: idle
 
  data:
    pools:   <span class="hljs-number">3</span> pools, <span class="hljs-number">65</span> pgs
    objects: <span class="hljs-number">22</span> objects, <span class="hljs-number">2.2</span> KiB
    usage:   <span class="hljs-number">6.0</span> GiB used, <span class="hljs-number">297</span> GiB / <span class="hljs-number">303</span> GiB avail
    pgs:     <span class="hljs-number">65</span> active+clean
</code></pre>
<p><img src="\img\ceph-s.png" srcset="/img/loading.gif" alt="image-20201031225553280"></p>
<p>å¯ä»¥çœ‹åˆ°mdså’Œosdå’Œmonè¿›ç¨‹ï¼Œè¯´æ˜ceph clusterå·²ç»è¿è¡Œèµ·æ¥äº†ã€‚</p>
<pre><code class="hljs gradle">.<span class="hljs-regexp">/bin/</span>rados -p rbd bench <span class="hljs-number">30</span> <span class="hljs-keyword">write</span>
.<span class="hljs-regexp">/bin/</span>rbd create foo --<span class="hljs-keyword">size</span> <span class="hljs-number">1000</span></code></pre>
<p>å…³é—­ä¸€ä¸ªclusterç”¨ï¼š</p>
<pre><code class="hljs awk">..<span class="hljs-regexp">/src/</span>stop.sh</code></pre>
<p>å¯åŠ¨å’Œåœæ­¢å•ç‹¬çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œ<code>sysvinit</code>è„šæœ¬å¯ä»¥è¿™æ ·ç”¨ï¼š</p>
<pre><code class="hljs awk">.<span class="hljs-regexp">/bin/i</span>nit-ceph restart osd.<span class="hljs-number">0</span>
.<span class="hljs-regexp">/bin/i</span>nit-ceph stop</code></pre>
<p>å¦‚æœè¦buildå¹¶ä¸”è¿›è¡Œæ‰€æœ‰æµ‹è¯•</p>
<p>éœ€è¦å…¨éƒ¨buildï¼Œè¿™æ˜¯æå…¶è€—è´¹æ—¶é—´å’Œç£ç›˜çš„ï¼ˆä¿å®ˆä¼°è®¡è¦100Gä»¥ä¸Šï¼‰ã€‚</p>
<pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> make -j<span class="hljs-number">8</span> 
<span class="hljs-attribute">sudo</span> ctest -j<span class="hljs-number">8</span></code></pre>
<p>å¦‚æœæœ‰é”™è¯¯ï¼Œä¼šåœ¨CLIæ‰“å°å‡ºæ¥ï¼š</p>
<pre><code class="hljs angelscript"><span class="hljs-number">95</span>% tests passed, <span class="hljs-number">9</span> tests failed <span class="hljs-keyword">out</span> of <span class="hljs-number">192</span>

Total Test time (real) = <span class="hljs-number">579.44</span> sec

The following tests FAILED:
	<span class="hljs-number">111</span> - readable.sh (Failed)
	<span class="hljs-number">177</span> - unittest_rgw_dmclock_scheduler (Failed)
	<span class="hljs-number">184</span> - unittest_rbd_mirror (Not Run)
	<span class="hljs-number">186</span> - unittest_seastar_denc (Not Run)
	<span class="hljs-number">187</span> - unittest_seastar_socket (Not Run)
	<span class="hljs-number">188</span> - unittest_seastar_messenger (Not Run)
	<span class="hljs-number">189</span> - unittest_seastar_thread_pool (Not Run)
	<span class="hljs-number">190</span> - unittest_seastar_perfcounters (Not Run)
	<span class="hljs-number">191</span> - unittest_seastar_lru (Not Run)
Errors <span class="hljs-keyword">while</span> running CTest
</code></pre>
<p>å¦‚æœæƒ³è¿›è¡Œå•ä¸ªæµ‹è¯•ï¼Œåœ¨/binæ–‡ä»¶å¤¹è¿è¡Œå¯¹åº”æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs awk">sudo .<span class="hljs-regexp">/bin/u</span>nittest_rbd_mirror</code></pre>
<p>å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œåº”è¯¥æ˜¯æˆ‘è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs angelscript"><span class="hljs-number">99</span>% tests passed, <span class="hljs-number">2</span> tests failed <span class="hljs-keyword">out</span> of <span class="hljs-number">192</span>

Total Test time (real) = <span class="hljs-number">488.16</span> sec

The following tests FAILED:
	<span class="hljs-number">111</span> - readable.sh (Failed)
	<span class="hljs-number">177</span> - unittest_rgw_dmclock_scheduler (Failed)
Errors <span class="hljs-keyword">while</span> running CTest
</code></pre>
<p>ä¸Šé¢æŠ¥é”™ï¼Œæ˜¯å› ä¸ºå®ƒä»¬æ˜¯trivialçš„ï¼Œdmclockçš„apiç”šè‡³è¿˜æ²¡å¼€å‘å‡ºæ¥ã€‚emoji~</p>
<hr>
<h2 id="è°ƒè¯•é›†ç¾¤ï¼Œæ·»åŠ æ—¥å¿—"><a href="#è°ƒè¯•é›†ç¾¤ï¼Œæ·»åŠ æ—¥å¿—" class="headerlink" title="è°ƒè¯•é›†ç¾¤ï¼Œæ·»åŠ æ—¥å¿—"></a>è°ƒè¯•é›†ç¾¤ï¼Œæ·»åŠ æ—¥å¿—</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶é’ˆå¯¹ç‰¹å®šæ¨¡å—ç”Ÿæˆè°ƒè¯•æ—¥å¿—ã€‚ä½†è¿™å¯èƒ½äº§ç”Ÿè¶…è¿‡1GBçš„æ—¥å¿—æ–‡ä»¶ã€‚è°ƒè¯•ä¼šå½±å“é›†ç¾¤çš„æ€§èƒ½ã€‚</p>
<p>æ‰€ä»¥å¿…é¡»ä¿è¯ä½ ç£ç›˜æœ‰è¶³å¤Ÿçš„ç©ºé—´ã€‚</p>
<h3 id="å®æ—¶æ˜¾ç¤º"><a href="#å®æ—¶æ˜¾ç¤º" class="headerlink" title="å®æ—¶æ˜¾ç¤º"></a>å®æ—¶æ˜¾ç¤º</h3><p>å¦‚æœä½ å¸Œæœ›çœ‹åˆ°å®æ—¶è°ƒè¯•ä¿¡æ¯ï¼Œä½ å¿…é¡»ç™»å½•åˆ°ä¸€å°ä¸»æœºä¸Šæ‰§è¡Œï¼š</p>
<pre><code class="hljs routeros">ceph daemon &#123;daemon-name&#125;<span class="hljs-built_in"> config </span>show | less</code></pre>
<p>ä¾‹å¦‚</p>
<pre><code class="hljs routeros">ceph daemon osd.0<span class="hljs-built_in"> config </span>show | less</code></pre>
<p>ä¸ºäº†æ¿€æ´»è°ƒè¯•è¾“å‡ºï¼Œä½¿ç”¨<code>ceph tell</code>:</p>
<pre><code class="hljs routeros">ceph tell &#123;daemon-type&#125;.&#123;daemon id <span class="hljs-keyword">or</span> *&#125;<span class="hljs-built_in"> config </span><span class="hljs-builtin-name">set</span> &#123;name&#125; &#123;value&#125;</code></pre>
<p>daemon-typeä¸ºmds,mon,osdä¹‹ä¸€ã€‚è¯¥å‘½ä»¤é€šè¿‡ç›‘è§†å™¨ã€‚å¦‚æœæ‚¨æ— æ³•ç»‘å®šåˆ°ç›‘è§†å™¨ï¼Œåˆ™ä»ç„¶å¯ä»¥é€šè¿‡ä½¿ç”¨æ¥ç™»å½•è¦æ›´æ”¹å…¶é…ç½®çš„å®ˆæŠ¤ç¨‹åºçš„ä¸»æœºï¼Œä»¥è¿›è¡Œæ›´æ”¹ã€‚</p>
<p>ä¾‹å¦‚</p>
<pre><code class="hljs routeros">ceph tell osd.0<span class="hljs-built_in"> config </span><span class="hljs-builtin-name">set</span> debug_osd 0/5</code></pre>
<h3 id="å¯åŠ¨æ—¶è°ƒè¯•"><a href="#å¯åŠ¨æ—¶è°ƒè¯•" class="headerlink" title="å¯åŠ¨æ—¶è°ƒè¯•"></a>å¯åŠ¨æ—¶è°ƒè¯•</h3><p>å¯ä»¥åœ¨globalè®¾ç½®è®¾å®š</p>
<pre><code class="hljs routeros">[global]
        <span class="hljs-builtin-name">debug</span> ms = 1/5

[mon]
        <span class="hljs-builtin-name">debug</span> mon = 20
        <span class="hljs-builtin-name">debug</span> paxos = 1/5
        <span class="hljs-builtin-name">debug</span> auth = 2

[osd]
        <span class="hljs-builtin-name">debug</span> osd = 1/5
        <span class="hljs-builtin-name">debug</span> filestore = 1/5
        <span class="hljs-builtin-name">debug</span> journal = 1
        <span class="hljs-builtin-name">debug</span> monc = 5/20

[mds]
        <span class="hljs-builtin-name">debug</span> mds = 1
        <span class="hljs-builtin-name">debug</span> mds balancer = 1</code></pre>
<h3 id="åŠ é€Ÿæ—¥å¿—é€‰æ‹©"><a href="#åŠ é€Ÿæ—¥å¿—é€‰æ‹©" class="headerlink" title="åŠ é€Ÿæ—¥å¿—é€‰æ‹©"></a>åŠ é€Ÿæ—¥å¿—é€‰æ‹©</h3><p>å¦‚æœæ‚¨çš„æ“ä½œç³»ç»Ÿç£ç›˜ç›¸å¯¹è¾ƒæ»¡ï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨å¤„ä¿®æ”¹Cephæ—¥å¿—è½®æ¢æ–‡ä»¶æ¥åŠ é€Ÿæ—¥å¿—è½®æ¢<code>/etc/logrotate.d/ceph</code>ã€‚å¦‚æœæ—¥å¿—è¶…è¿‡å¤§å°è®¾ç½®ï¼Œè¯·åœ¨æ—‹è½¬é¢‘ç‡ä¹‹åæ·»åŠ å¤§å°è®¾ç½®ä»¥åŠ é€Ÿæ—¥å¿—æ—‹è½¬ï¼ˆé€šè¿‡cronjobï¼‰ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤è®¾ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs stata"><span class="hljs-keyword">rotate</span> 7
weekly
<span class="hljs-keyword">compress</span>
sharedscripts</code></pre>
<p>é€šè¿‡æ·»åŠ <code>size</code>è®¾ç½®è¿›è¡Œä¿®æ”¹ã€‚</p>
<pre><code class="hljs angelscript">rotate <span class="hljs-number">7</span>
weekly
size <span class="hljs-number">500</span>M
compress
sharedscripts</code></pre>
<p>ç„¶åï¼Œä¸ºæ‚¨çš„ç”¨æˆ·ç©ºé—´å¯åŠ¨crontabç¼–è¾‘å™¨ã€‚</p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">crontab -e</span></code></pre>
<p>æœ€åï¼Œæ·»åŠ ä¸€ä¸ªæ¡ç›®ä»¥æ£€æŸ¥<code>etc/logrotate.d/ceph</code>æ–‡ä»¶ã€‚</p>
<pre><code class="hljs basic"><span class="hljs-symbol">30 </span>* * * * /<span class="hljs-keyword">usr</span>/sbin/logrotate /etc/logrotate.d/ceph &gt;/dev/null <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span></code></pre>
<p>å‰é¢çš„ç¤ºä¾‹<code>etc/logrotate.d/ceph</code>æ¯30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ–‡ä»¶ã€‚</p>
<h3 id="Valgrind"><a href="#Valgrind" class="headerlink" title="Valgrind"></a>Valgrind</h3><p>è°ƒè¯•å¯èƒ½è¿˜éœ€è¦æ‚¨è·Ÿè¸ªå†…å­˜å’Œçº¿ç¨‹é—®é¢˜ã€‚æ‚¨å¯ä»¥ä½¿ç”¨Valgrindè¿è¡Œå•ä¸ªå®ˆæŠ¤ç¨‹åºï¼Œä¸€ç§å®ˆæŠ¤ç¨‹åºæˆ–æ•´ä¸ªé›†ç¾¤ã€‚æ‚¨ä»…åº”åœ¨å¼€å‘æˆ–è°ƒè¯•Cephæ—¶ä½¿ç”¨Valgrindã€‚Valgrindåœ¨è®¡ç®—ä¸Šå¾ˆæ˜‚è´µï¼Œå¦åˆ™ä¼šé™ä½æ‚¨çš„ç³»ç»Ÿé€Ÿåº¦ã€‚Valgrindæ¶ˆæ¯å·²è®°å½•åˆ°<code>stderr</code>ã€‚</p>
<h3 id="å­ç³»ç»Ÿï¼Œæ—¥å¿—å’Œè°ƒè¯•è®¾ç½®"><a href="#å­ç³»ç»Ÿï¼Œæ—¥å¿—å’Œè°ƒè¯•è®¾ç½®" class="headerlink" title="å­ç³»ç»Ÿï¼Œæ—¥å¿—å’Œè°ƒè¯•è®¾ç½®"></a>å­ç³»ç»Ÿï¼Œæ—¥å¿—å’Œè°ƒè¯•è®¾ç½®</h3><p>æ¯ä¸ªå­ç³»ç»Ÿéƒ½æœ‰å…¶è¾“å‡ºæ—¥å¿—å’Œå†…å­˜ä¸­æ—¥å¿—çš„æ—¥å¿—è®°å½•çº§åˆ«ã€‚é€šè¿‡ä¸ºè°ƒè¯•æ—¥å¿—è®°å½•è®¾ç½®æ—¥å¿—æ–‡ä»¶çº§åˆ«å’Œå†…å­˜çº§åˆ«ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªå­ç³»ç»Ÿè®¾ç½®ä¸åŒçš„å€¼ã€‚Cephçš„æ—¥å¿—è®°å½•çº§åˆ«ä»¥1åˆ°20ï¼Œ1æœ€ä¸ºç®€æ´ï¼Œ20æœ€ä¸ºå†—ä½™ã€‚</p>
<p>è°ƒè¯•æ—¥å¿—è®°å½•è®¾ç½®å¯ä»¥ä¸ºæ—¥å¿—çº§åˆ«å’Œå†…å­˜çº§åˆ«é‡‡ç”¨å•ä¸ªå€¼ï¼Œè¿™ä¼šå°†å®ƒä»¬è®¾ç½®ä¸ºç›¸åŒçš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æŒ‡å®šï¼Œåˆ™Cephä¼šå°†å…¶è§†ä¸ºæ—¥å¿—çº§åˆ«å’Œå†…å­˜çº§åˆ«ã€‚æ‚¨ä¹Ÿå¯ä»¥å•ç‹¬æŒ‡å®šå®ƒä»¬ã€‚<strong>ç¬¬ä¸€ä¸ªè®¾ç½®æ˜¯æ—¥å¿—çº§åˆ«ï¼Œç¬¬äºŒä¸ªè®¾ç½®æ˜¯å†…å­˜çº§åˆ«</strong>ã€‚æ‚¨å¿…é¡»ä½¿ç”¨æ­£æ–œæ ï¼ˆ/ï¼‰åˆ†éš”å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦å°†å­ç³»ç»Ÿçš„è°ƒè¯•æ—¥å¿—è®°å½•çº§åˆ«è®¾ç½®ä¸ºï¼Œå°†å…¶å†…å­˜çº§åˆ«è®¾ç½®ä¸ºï¼Œåˆ™å¯ä»¥å°†å…¶æŒ‡å®šä¸ºã€‚ä¾‹å¦‚ï¼š<code>debug ms = 1/5</code></p>
<pre><code class="hljs pgsql"><span class="hljs-keyword">debug</span> &#123;subsystem&#125; = &#123;<span class="hljs-keyword">log</span>-<span class="hljs-keyword">level</span>&#125;/&#123;memory-<span class="hljs-keyword">level</span>&#125;
<span class="hljs-meta">#for example</span>
<span class="hljs-keyword">debug</span> mds balancer = <span class="hljs-number">1</span>/<span class="hljs-number">20</span></code></pre>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Subsystem</th>
<th style="text-align:left">Log Level</th>
<th style="text-align:left">Memory Level</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>default</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>lockdep</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left"><code>context</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left"><code>crush</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left"><code>mds</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>mds balancer</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>mds locker</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>mds log</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>mds log expire</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>mds migrator</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>buffer</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left"><code>timer</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left"><code>filer</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left"><code>striper</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left"><code>objecter</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left"><code>rados</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>rbd</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>rbd mirror</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>rbd replay</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>journaler</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>objectcacher</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>client</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>osd</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>optracker</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>objclass</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>filestore</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
</tr>
<tr>
<td style="text-align:left"><code>journal</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
</tr>
<tr>
<td style="text-align:left"><code>ms</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>mon</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>monc</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">10</td>
</tr>
<tr>
<td style="text-align:left"><code>paxos</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>tp</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>auth</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>crypto</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>finisher</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left"><code>reserver</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left"><code>heartbeatmap</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>perfcounter</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>rgw</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>rgw sync</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>civetweb</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">10</td>
</tr>
<tr>
<td style="text-align:left"><code>javaclient</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>asok</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>throttle</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left"><code>refs</code></td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left"><code>compressor</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>bluestore</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>bluefs</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>bdev</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">3</td>
</tr>
<tr>
<td style="text-align:left"><code>kstore</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>rocksdb</code></td>
<td style="text-align:left">4</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>leveldb</code></td>
<td style="text-align:left">4</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>memdb</code></td>
<td style="text-align:left">4</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>fuse</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>mgr</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>mgrc</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>dpdk</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left"><code>eventtrace</code></td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>Parameters</th>
<th>Descrip.</th>
<th>Type</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>log file</td>
<td>The location of the logging file for your cluster.</td>
<td>String</td>
<td>/var/log/ceph/\$cluster-\$name.log</td>
</tr>
<tr>
<td>log max new</td>
<td>The maximum number of recent events to include in a log file.</td>
<td>Integer</td>
<td>10000</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h2 id="æ“ä½œé›†ç¾¤çš„ä¸‰ç§æ–¹æ³•"><a href="#æ“ä½œé›†ç¾¤çš„ä¸‰ç§æ–¹æ³•" class="headerlink" title="æ“ä½œé›†ç¾¤çš„ä¸‰ç§æ–¹æ³•"></a>æ“ä½œé›†ç¾¤çš„ä¸‰ç§æ–¹æ³•</h2><h2 id="1-Systemd-ï¼ˆæ¨èï¼‰"><a href="#1-Systemd-ï¼ˆæ¨èï¼‰" class="headerlink" title="1.Systemd.ï¼ˆæ¨èï¼‰"></a>1.Systemd.ï¼ˆæ¨èï¼‰</h2><p>Systemd æ˜¯ Linux ç³»ç»Ÿå·¥å…·ï¼Œç”¨æ¥å¯åŠ¨<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/02/linux-daemon.html">å®ˆæŠ¤è¿›ç¨‹</a>ï¼Œå·²æˆä¸ºå¤§å¤šæ•°å‘è¡Œç‰ˆçš„æ ‡å‡†é…ç½®ã€‚åŒ…æ‹¬å¯åŠ¨ï¼Œæ£€æŸ¥ï¼Œåˆ—ä¸¾systemdï¼Œä»¥åŠåœæ­¢ã€‚</p>
<pre><code class="hljs nginx"><span class="hljs-attribute">sudo</span> systemctl start ceph.target       <span class="hljs-comment"># start all daemons</span>

sudo systemctl status ceph-osd@<span class="hljs-number">12</span>      <span class="hljs-comment"># check status of osd.12</span>

sudo systemctl status ceph\<span class="hljs-regexp">*.service</span> ceph\<span class="hljs-regexp">*.target</span> <span class="hljs-comment"># list the Ceph systemd units on a node</span>
sudo systemctl stop ceph\<span class="hljs-regexp">*.service</span> ceph\<span class="hljs-regexp">*.target</span> <span class="hljs-comment">#stop all the daemons</span>
</code></pre>
<p>å¦‚æœè¦å¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰€æœ‰ç‰¹å®šç±»å‹çš„å®ˆæŠ¤è¿›ç¨‹ã€‚æ‰§è¡Œä¸‹é¢ä¸€ä¸ªå³å¯ï¼š</p>
<pre><code class="hljs aspectj">sudo systemctl start ceph-osd.<span class="hljs-keyword">target</span>
sudo systemctl start ceph-mon.<span class="hljs-keyword">target</span>
sudo systemctl start ceph-mds.<span class="hljs-keyword">target</span></code></pre>
<h2 id="2-Upstart"><a href="#2-Upstart" class="headerlink" title="2.Upstart"></a>2.Upstart</h2><h3 id="å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹"><a href="#å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹"></a>å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹</h3><p>è¦åœ¨CephèŠ‚ç‚¹ä¸Šå¯åŠ¨ç‰¹å®šçš„å®ˆæŠ¤ç¨‹åºå®ä¾‹ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œä¹‹ä¸€ï¼š</p>
<pre><code class="hljs sql">sudo <span class="hljs-keyword">start</span> ceph-<span class="hljs-keyword">all</span>
sudo <span class="hljs-keyword">start</span> ceph-osd <span class="hljs-keyword">id</span>=&#123;<span class="hljs-keyword">id</span>&#125;
sudo <span class="hljs-keyword">start</span> ceph-mon <span class="hljs-keyword">id</span>=&#123;hostname&#125;
sudo <span class="hljs-keyword">start</span> ceph-mds <span class="hljs-keyword">id</span>=&#123;hostname&#125;
sudo <span class="hljs-keyword">start</span> ceph-osd-<span class="hljs-keyword">all</span>
sudo <span class="hljs-keyword">start</span> ceph-mon-<span class="hljs-keyword">all</span>
sudo <span class="hljs-keyword">start</span> ceph-mds-<span class="hljs-keyword">all</span></code></pre>
<h3 id="åœæ­¢å®ˆæŠ¤ç¨‹åº"><a href="#åœæ­¢å®ˆæŠ¤ç¨‹åº" class="headerlink" title="åœæ­¢å®ˆæŠ¤ç¨‹åº"></a>åœæ­¢å®ˆæŠ¤ç¨‹åº</h3><p>è¦åœ¨CephèŠ‚ç‚¹ä¸Šåœæ­¢ç‰¹å®šçš„å®ˆæŠ¤ç¨‹åºå®ä¾‹ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œä¹‹ä¸€ï¼š</p>
<pre><code class="hljs sql">sudo <span class="hljs-keyword">stop</span> ceph-<span class="hljs-keyword">all</span>
sudo <span class="hljs-keyword">stop</span> ceph-osd <span class="hljs-keyword">id</span>=&#123;<span class="hljs-keyword">id</span>&#125;
sudo <span class="hljs-keyword">stop</span> ceph-mon <span class="hljs-keyword">id</span>=&#123;hostname&#125;
sudo <span class="hljs-keyword">stop</span> ceph-mds <span class="hljs-keyword">id</span>=&#123;hostname&#125;
sudo <span class="hljs-keyword">stop</span> ceph-osd-<span class="hljs-keyword">all</span>
sudo <span class="hljs-keyword">stop</span> ceph-mon-<span class="hljs-keyword">all</span>
sudo <span class="hljs-keyword">stop</span> ceph-mds-<span class="hljs-keyword">all</span></code></pre>
<h2 id="3-Sysvinit"><a href="#3-Sysvinit" class="headerlink" title="3.Sysvinit"></a>3.Sysvinit</h2><p>æ¯æ¬¡<strong>å¯åŠ¨</strong>ï¼Œ<strong>é‡æ–°å¯åŠ¨</strong>å’Œ <strong>åœæ­¢</strong>Cephå®ˆæŠ¤ç¨‹åºï¼ˆæˆ–æ•´ä¸ªé›†ç¾¤ï¼‰æ—¶ï¼Œéƒ½å¿…é¡»è‡³å°‘æŒ‡å®šä¸€ä¸ªé€‰é¡¹å’Œä¸€ä¸ªå‘½ä»¤ã€‚æ‚¨ä¹Ÿå¯ä»¥æŒ‡å®šå®ˆæŠ¤ç¨‹åºç±»å‹æˆ–å®ˆæŠ¤ç¨‹åºå®ä¾‹ã€‚</p>
<pre><code class="hljs clojure">&#123;commandline&#125; [options] [commands] [daemons]</code></pre>
<p>è¯¥<code>ceph</code>é€‰é¡¹åŒ…æ‹¬ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">é€‰é¡¹</th>
<th style="text-align:left">æ·å¾„</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>--verbose</code></td>
<td style="text-align:left"><code>-v</code></td>
<td style="text-align:left">ä½¿ç”¨è¯¦ç»†æ—¥å¿—è®°å½•ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>--valgrind</code></td>
<td style="text-align:left"><code>N/A</code></td>
<td style="text-align:left">ï¼ˆä»…é™Devå’ŒQAï¼‰ä½¿ç”¨<a target="_blank" rel="noopener" href="http://www.valgrind.org/">Valgrind</a>è°ƒè¯•ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>--allhosts</code></td>
<td style="text-align:left"><code>-a</code></td>
<td style="text-align:left">åœ¨<code>ceph.conf.</code> å¦åˆ™çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œå¦åˆ™ä»…åœ¨ä¸Šæ‰§è¡Œ<code>localhost</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>--restart</code></td>
<td style="text-align:left"><code>N/A</code></td>
<td style="text-align:left">å¦‚æœæ ¸å¿ƒè½¬å‚¨ï¼Œåˆ™è‡ªåŠ¨é‡æ–°å¯åŠ¨å®ˆæŠ¤ç¨‹åºã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>--norestart</code></td>
<td style="text-align:left"><code>N/A</code></td>
<td style="text-align:left">å¦‚æœå®ˆæŠ¤ç¨‹åºå‘ç”Ÿæ ¸å¿ƒè½¬å‚¨ï¼Œè¯·ä¸è¦é‡æ–°å¯åŠ¨å®ƒã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>--conf</code></td>
<td style="text-align:left"><code>-c</code></td>
<td style="text-align:left">ä½¿ç”¨å¤‡ç”¨é…ç½®æ–‡ä»¶ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>è¿™äº›<code>ceph</code>å‘½ä»¤åŒ…æ‹¬ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">å‘½ä»¤</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>start</code></td>
<td style="text-align:left">å¯åŠ¨å®ˆæŠ¤ç¨‹åºã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>stop</code></td>
<td style="text-align:left">åœæ­¢å®ˆæŠ¤ç¨‹åºã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>forcestop</code></td>
<td style="text-align:left">å¼ºåˆ¶å®ˆæŠ¤ç¨‹åºåœæ­¢ã€‚ä¸â€¦ä¸€æ ·<code>kill -9</code></td>
</tr>
<tr>
<td style="text-align:left"><code>killall</code></td>
<td style="text-align:left">æ€æ­»æ‰€æœ‰ç‰¹å®šç±»å‹çš„å®ˆæŠ¤ç¨‹åºã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>cleanlogs</code></td>
<td style="text-align:left">æ¸…é™¤æ—¥å¿—ç›®å½•ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>cleanalllogs</code></td>
<td style="text-align:left">æ¸…é™¤æ—¥å¿—ç›®å½•ä¸­çš„<strong>æ‰€æœ‰å†…å®¹</strong>ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>å¯¹äºå­ç³»ç»Ÿæ“ä½œï¼Œ<code>ceph</code>æœåŠ¡å¯ä»¥é€šè¿‡ä¸º<code>[daemons]</code>é€‰é¡¹æ·»åŠ ç‰¹å®šçš„å®ˆæŠ¤ç¨‹åºç±»å‹æ¥å®šä½ç‰¹å®šçš„å®ˆæŠ¤ç¨‹åºç±»å‹ã€‚å®ˆæŠ¤ç¨‹åºç±»å‹åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>mon</code></li>
<li><code>osd</code></li>
<li><code>mds</code></li>
</ul>
<hr>
<h2 id="äº†è§£cephçš„å¥åº·çŠ¶å†µ"><a href="#äº†è§£cephçš„å¥åº·çŠ¶å†µ" class="headerlink" title="äº†è§£cephçš„å¥åº·çŠ¶å†µ"></a>äº†è§£cephçš„å¥åº·çŠ¶å†µ</h2><h3 id="Monitor"><a href="#Monitor" class="headerlink" title="Monitor"></a>Monitor</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">çŠ¶æ€</th>
<th style="text-align:center">å®šä¹‰</th>
<th>å»ºè®®</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">MON_DOWN</td>
<td style="text-align:center">å½“å‰æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç›‘è§†å®ˆæŠ¤ç¨‹åºå·²å…³é—­ã€‚è¯¥ç¾¤é›†éœ€è¦å¤§å¤šæ•°ï¼ˆè¶…è¿‡1/2ï¼‰çš„ç›‘è§†å™¨æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚å½“ä¸€ä¸ªæˆ–å¤šä¸ªç›‘è§†å™¨å…³é—­æ—¶ï¼Œå®¢æˆ·ç«¯å¯èƒ½å¾ˆéš¾ä¸ç¾¤é›†å»ºç«‹åˆå§‹è¿æ¥ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½éœ€è¦å°è¯•æ›´å¤šåœ°å€æ‰èƒ½åˆ°è¾¾è¿è¡Œä¸­çš„ç›‘è§†å™¨ã€‚</td>
<td>é€šå¸¸ï¼Œåº”è¯¥å°½å¿«é‡æ–°å¯åŠ¨å…³é—­ç›‘è§†å™¨çš„å®ˆæŠ¤ç¨‹åºï¼Œä»¥å‡å°‘å­ç›‘è§†å™¨å¤±è´¥å¯¼è‡´æœåŠ¡ä¸­æ–­çš„é£é™©ã€‚</td>
</tr>
<tr>
<td style="text-align:center">MON_CLOCK_SKEW</td>
<td style="text-align:center">è¿è¡Œceph-monç›‘è§†å™¨å®ˆæŠ¤ç¨‹åºçš„ä¸»æœºä¸Šçš„æ—¶é’ŸåŒæ­¥ä¸å¤Ÿå……åˆ†ã€‚å¦‚æœç¾¤é›†æ£€æµ‹åˆ°æ—¶é’Ÿåå·®å¤§äºï¼Œåˆ™ä¼šå‘å‡ºæ­¤å¥åº·è­¦æŠ¥<code>mon_clock_drift_allowed</code>ã€‚</td>
<td>æœ€å¥½ä½¿ç”¨è¯¸å¦‚<code>ntpd</code>æˆ–çš„å·¥å…·åŒæ­¥æ—¶é’Ÿæ¥è§£å†³ <code>chrony</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:center">MON_MSGR2_NOT_ENABLED</td>
<td style="text-align:center">è¯¥<code>ms_bind_msgr2</code>é€‰é¡¹å·²å¯ç”¨ï¼Œä½†æœªå°†ä¸€ä¸ªæˆ–å¤šä¸ªç›‘è§†å™¨é…ç½®ä¸ºç»‘å®šåˆ°ç¾¤é›†monmapä¸­çš„v2ç«¯å£ã€‚è¿™æ„å‘³ç€ç‰¹å®šäºmsgr2åè®®çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼ŒåŠ å¯†ï¼‰åœ¨æŸäº›æˆ–æ‰€æœ‰è¿æ¥ä¸Šä¸å¯ç”¨ã€‚</td>
<td><code>ceph mon enable-msgr2</code>è¯¥å‘½ä»¤å°†æ›´æ”¹ä¸ºæ—§çš„é»˜è®¤ç«¯å£6789é…ç½®çš„ä»»ä½•ç›‘è§†å™¨ï¼Œä»¥ç»§ç»­ä¾¦å¬6789ä¸Šçš„v1è¿æ¥ï¼Œå¹¶ç»§ç»­ä¾¦å¬æ–°çš„é»˜è®¤3300ç«¯å£ä¸Šçš„v2è¿æ¥ã€‚</td>
</tr>
<tr>
<td style="text-align:center">MON_DISK_LOW \MON_DISK_CRIT</td>
<td style="text-align:center">ä¸€å°æˆ–å¤šå°ç›‘è§†å™¨çš„ç£ç›˜ç©ºé—´ä¸è¶³ã€‚å¦‚æœå­˜å‚¨ç›‘è§†å™¨æ•°æ®åº“çš„æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¯ç”¨ç©ºé—´ï¼ˆé€šå¸¸<code>/var/lib/ceph/mon</code>ä¸ºç™¾åˆ†æ¯”ï¼‰é™ä½è‡³ä»¥ä¸‹ç™¾åˆ†æ¯”<code>mon_data_avail_warn</code>ï¼ˆé»˜è®¤å€¼ï¼š30ï¼…ï¼‰ï¼Œ åˆ™å°†è§¦å‘æ­¤è­¦æŠ¥ã€‚</td>
<td>è¯·é€šè¿‡è¯¸å¦‚æ¸…ç†æ—¥å¿—æ–‡ä»¶çš„æ–¹å¼æ¥å¢åŠ ç©ºé—´ï¼Œæˆ–è€…è¿›è¡Œæ‰©å®¹ã€‚</td>
</tr>
<tr>
<td style="text-align:center">MON_DISK_BIG</td>
<td style="text-align:center">å¦‚æœç›‘è§†å™¨æ•°æ®åº“çš„å¤§å°å¤§äº<code>mon_data_size_warn</code>ï¼ˆé»˜è®¤å€¼ï¼š15 GiBï¼‰ï¼Œåˆ™ä¼šè§¦å‘æ­¤è­¦æŠ¥ ã€‚</td>
<td></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</div>
<h3 id="Manager"><a href="#Manager" class="headerlink" title="Manager"></a>Manager</h3><div class="table-container">
<table>
<thead>
<tr>
<th>çŠ¶æ€</th>
<th>å®šä¹‰</th>
<th>å»ºè®®</th>
</tr>
</thead>
<tbody>
<tr>
<td>MGR_DOWN</td>
<td>å½“å‰æ‰€æœ‰ç®¡ç†å™¨å®ˆæŠ¤ç¨‹åºéƒ½å·²å…³é—­ã€‚</td>
<td>åº”å°½å¿«é‡æ–°å¯åŠ¨åœæœºç®¡ç†å™¨å®ˆæŠ¤ç¨‹åºï¼Œä»¥ç¡®ä¿å¯ä»¥ç›‘è§†ç¾¤é›†ã€‚</td>
</tr>
<tr>
<td>MGR_MODULE_DEPENDENCY</td>
<td>å·²å¯ç”¨çš„ç®¡ç†å™¨æ¨¡å—æœªèƒ½é€šè¿‡ä¾èµ–å…³ç³»æ£€æŸ¥ã€‚æ­¤è¿è¡ŒçŠ¶å†µæ£€æŸ¥åº”éšé™„æ¥è‡ªæ¨¡å—çš„æœ‰å…³è¯¥é—®é¢˜çš„è§£é‡Šæ€§æ¶ˆæ¯</td>
<td></td>
</tr>
<tr>
<td>MGR_MODULE_ERROR</td>
<td>ç®¡ç†å™¨æ¨¡å—é‡åˆ°æ„å¤–é”™è¯¯ã€‚</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h3 id="OSD"><a href="#OSD" class="headerlink" title="OSD"></a>OSD</h3><div class="table-container">
<table>
<thead>
<tr>
<th>çŠ¶æ€</th>
<th>å®šä¹‰</th>
<th>è§£å†³</th>
</tr>
</thead>
<tbody>
<tr>
<td>OSD_DOWN</td>
<td>æ ‡è®°äº†ä¸€ä¸ªæˆ–å¤šä¸ªOSDã€‚ceph-osdå®ˆæŠ¤ç¨‹åºå¯èƒ½å·²åœæ­¢ï¼Œæˆ–è€…å¯¹ç­‰OSDå¯èƒ½æ— æ³•é€šè¿‡ç½‘ç»œè®¿é—®OSDã€‚</td>
<td></td>
</tr>
<tr>
<td>OSD_ <CRUSH_TYPE> _DOWN</td>
<td></td>
<td></td>
</tr>
<tr>
<td>OSD_ORPHAN</td>
<td>OSDåœ¨CRUSHæ˜ å°„å±‚æ¬¡ç»“æ„ä¸­è¢«å¼•ç”¨ï¼Œä½†ä¸å­˜åœ¨ã€‚</td>
<td>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä»CRUSHå±‚æ¬¡ç»“æ„ä¸­åˆ é™¤OSDï¼šceph osd crush rm osd</td>
</tr>
<tr>
<td>OSD_OUT_OF_ORDER_FULL</td>
<td>Nearfullï¼Œbackfillfullï¼Œfullå’Œ/æˆ–failsafe_fullçš„åˆ©ç”¨ç‡é˜ˆå€¼å¹¶éå‡åº</td>
<td></td>
</tr>
<tr>
<td>OSD_FULL</td>
<td>ä¸€ä¸ªæˆ–å¤šä¸ªOSDè¶…å‡ºäº†æ•´ä¸ªé˜ˆå€¼ï¼Œå¹¶æ­£åœ¨é˜»æ­¢ç¾¤é›†ä¸ºå†™å…¥æä¾›æœåŠ¡ã€‚</td>
<td></td>
</tr>
<tr>
<td>OSD_BACKFILLFULL</td>
<td></td>
<td></td>
</tr>
<tr>
<td>OSD_NEARFULL</td>
<td></td>
<td></td>
</tr>
<tr>
<td>OSDMAP_FLAGS</td>
<td>å·²è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªæ„Ÿå…´è¶£çš„ç¾¤é›†æ ‡å¿—ã€‚è¿™äº›æ ‡å¿—åŒ…æ‹¬ï¼š</td>
<td></td>
</tr>
<tr>
<td>OSD_FLAGS</td>
<td>ä¸€ä¸ªæˆ–å¤šä¸ªOSDæˆ–CRUSH {nodesï¼Œdevice classes}å·²è®¾ç½®äº†å…³æ³¨æ ‡è®°</td>
<td></td>
</tr>
<tr>
<td>POOL_FULL</td>
<td>ä¸€ä¸ªæˆ–å¤šä¸ªæ± å·²è¾¾åˆ°å…¶é…é¢ï¼Œå¹¶ä¸”ä¸å†å…è®¸å†™å…¥ã€‚</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h3 id="BlueStore"><a href="#BlueStore" class="headerlink" title="BlueStore"></a>BlueStore</h3><div class="table-container">
<table>
<thead>
<tr>
<th>BLUEFS_SPILLOVER</th>
<th>å·²ç»ä¸ºä½¿ç”¨BlueStoreåç«¯çš„ä¸€ä¸ªæˆ–å¤šä¸ªOSDåˆ†é…äº† dbåˆ†åŒºï¼ˆç”¨äºå…ƒæ•°æ®çš„å­˜å‚¨ç©ºé—´ï¼Œé€šå¸¸åœ¨è¾ƒå¿«çš„è®¾å¤‡ä¸Šï¼‰ï¼Œä½†æ˜¯è¯¥ç©ºé—´å·²æ»¡ï¼Œå› æ­¤å…ƒæ•°æ®å·²â€œæº¢å‡ºâ€åˆ°æ­£å¸¸çš„æ…¢é€Ÿè®¾å¤‡ä¸Šã€‚</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>BLUEFS_AVAILABLE_SPACE</td>
<td></td>
<td></td>
</tr>
<tr>
<td>BLUEFS_LOW_SPACE</td>
<td></td>
<td></td>
</tr>
<tr>
<td>BLUESTORE_FRAGMENTATION</td>
<td></td>
<td></td>
</tr>
<tr>
<td>BLUESTORE_LEGACY_STATFS</td>
<td></td>
<td></td>
</tr>
<tr>
<td>BLUESTORE_NO_PER_POOL_OMAP</td>
<td>ä»Octopusç‰ˆæœ¬å¼€å§‹ï¼ŒBlueStoreæŒ‰æ± è·Ÿè¸ªomapç©ºé—´åˆ©ç”¨ç‡ï¼Œå¹¶ä¸”ä¸€ä¸ªæˆ–å¤šä¸ªOSDå…·æœ‰åœ¨Octopusä¹‹å‰åˆ›å»ºçš„å·ã€‚</td>
<td></td>
</tr>
<tr>
<td>BLUESTORE_DISK_SIZE_MISMATCH</td>
<td>ä½¿ç”¨BlueStoreçš„ä¸€ä¸ªæˆ–å¤šä¸ªOSDåœ¨ç‰©ç†è®¾å¤‡çš„å¤§å°å’Œè·Ÿè¸ªå…¶å¤§å°çš„å…ƒæ•°æ®ä¹‹é—´å­˜åœ¨å†…éƒ¨ä¸ä¸€è‡´ã€‚å°†æ¥å¯èƒ½å¯¼è‡´OSDå´©æºƒ</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h3 id="è®¾å¤‡è¿è¡ŒçŠ¶å†µ"><a href="#è®¾å¤‡è¿è¡ŒçŠ¶å†µ" class="headerlink" title="è®¾å¤‡è¿è¡ŒçŠ¶å†µ"></a>è®¾å¤‡è¿è¡ŒçŠ¶å†µ</h3><div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>OSDMAP_FLAGS</p>
<ul>
<li><em>full</em>-ç¾¤é›†è¢«æ ‡è®°ä¸ºå·²æ»¡ï¼Œæ— æ³•å¤„ç†å†™å…¥</li>
<li><em>pauserd</em>ï¼Œ<em>pausewr-</em>æš‚åœçš„è¯»å–æˆ–å†™å…¥</li>
<li><em>noup</em> -OSDä¸å…è®¸å¯åŠ¨</li>
<li><em>nodown</em> -OSDæ•…éšœæŠ¥å‘Šè¢«å¿½ç•¥ï¼Œå› æ­¤ç›‘è§†å™¨ä¸ä¼šå°†OSDæ ‡è®°ä¸ºæ•…éšœ</li>
<li>noin-ä»¥å‰æ ‡è®°å±ä¸Šæ˜¾ç¤ºå‡ºæ¥ï¼Œä¸ä¼šæ ‡ç¤ºåé¢çš„ï¼Œå½“ä»–ä»¬å¼€å§‹</li>
<li><em>noout-</em>åœ¨é…ç½®çš„é—´éš”åï¼Œä¸ä¼šè‡ªåŠ¨å°†å‘ä¸‹çš„OSDæ ‡è®°å‡ºæ¥</li>
<li><em>nobackfill</em>ï¼Œ<em>norecover</em>ï¼Œ<em>norebalance-</em>æ¢å¤æˆ–æ•°æ®é‡æ–°å¹³è¡¡å·²æš‚åœ</li>
<li><em>noscrub</em>ï¼Œ<em>nodeep_scrub-</em>ç¦ç”¨æ¸…ç†</li>
<li><em>notieragent-</em>ç¼“å­˜åˆ†å±‚æ´»åŠ¨å·²æš‚åœ</li>
</ul>
<p>é™¤<em>fullä¹‹å¤–</em>ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è®¾ç½®æˆ–æ¸…é™¤è¿™äº›æ ‡å¿—ï¼š</p>
<pre><code class="hljs pf">ceph osd <span class="hljs-built_in">set</span> <span class="hljs-variable">&lt;flag&gt;</span>
ceph osd unset <span class="hljs-variable">&lt;flag&gt;</span></code></pre>
<p>OSD_FLAGS</p>
<p>ä¸€ä¸ªæˆ–å¤šä¸ªOSDæˆ–CRUSH {nodesï¼Œdevice classes}å·²è®¾ç½®äº†å…³æ³¨æ ‡è®°ã€‚è¿™äº›æ ‡å¿—åŒ…æ‹¬ï¼š</p>
<ul>
<li><em>noup</em>ï¼šè¿™äº›OSDä¸å…è®¸å¯åŠ¨</li>
<li><em>nodown</em>ï¼šè¿™äº›OSDçš„æ•…éšœæŠ¥å‘Šå°†è¢«å¿½ç•¥</li>
<li><em>noin</em>ï¼šå¦‚æœä»¥å‰åœ¨æ•…éšœåè‡ªåŠ¨å°†è¿™äº›OSDæ ‡è®°å‡ºæ¥ï¼Œåˆ™å®ƒä»¬åœ¨å¯åŠ¨æ—¶å°†ä¸ä¼šè¢«æ ‡è®°</li>
<li><em>noout</em>ï¼šå¦‚æœè¿™äº›OSDå¤„äºå…³é—­çŠ¶æ€ï¼Œåˆ™åœ¨é…ç½®çš„é—´éš”åå®ƒä»¬ä¸ä¼šè‡ªåŠ¨è¢«æ ‡è®° å‡ºæ¥</li>
</ul>
<p>å¯ä»¥æ‰¹é‡è®¾ç½®å’Œæ¸…é™¤è¿™äº›æ ‡å¿—ï¼š</p>
<pre><code class="hljs dsconfig"><span class="hljs-string">ceph </span><span class="hljs-string">osd </span><span class="hljs-built_in">set-group</span> &lt;<span class="hljs-string">flags&gt;</span> &lt;<span class="hljs-string">who&gt;</span>
<span class="hljs-string">ceph </span><span class="hljs-string">osd </span><span class="hljs-string">unset-group </span>&lt;<span class="hljs-string">flags&gt;</span> &lt;<span class="hljs-string">who&gt;</span></code></pre>
<p>å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼æ£€æŸ¥æ± åˆ©ç”¨ç‡ï¼š</p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">ceph df</span></code></pre>
<p>å½“å‰å®šä¹‰çš„æ»¡æ¯”ç‡å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼çœ‹åˆ°ï¼š</p>
<pre><code class="hljs gradle">ceph osd <span class="hljs-keyword">dump</span> | <span class="hljs-keyword">grep</span> full_ratio</code></pre>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹æ± é…é¢å’Œåˆ©ç”¨ç‡ï¼š</p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">ceph df detail</span></code></pre>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æé«˜æ± é…é¢ï¼š</p>
<pre><code class="hljs dsconfig"><span class="hljs-string">ceph </span><span class="hljs-string">osd </span><span class="hljs-string">pool </span><span class="hljs-built_in">set-quota</span> &lt;<span class="hljs-string">poolname&gt;</span> <span class="hljs-string">max_objects </span>&lt;<span class="hljs-string">num-objects&gt;</span>
<span class="hljs-string">ceph </span><span class="hljs-string">osd </span><span class="hljs-string">pool </span><span class="hljs-built_in">set-quota</span> &lt;<span class="hljs-string">poolname&gt;</span> <span class="hljs-string">max_bytes </span>&lt;<span class="hljs-string">num-bytes&gt;</span></code></pre>
<p>æˆ–åˆ é™¤ä¸€äº›ç°æœ‰æ•°æ®ä»¥é™ä½åˆ©ç”¨ç‡ã€‚</p>
<p>è¦æ£€æŸ¥BlueFSæœ‰å¤šå°‘å¯ç”¨ç©ºé—´ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<pre><code class="hljs mipsasm">ceph daemon osd.<span class="hljs-number">123</span> <span class="hljs-keyword">bluestore </span><span class="hljs-keyword">bluefs </span>available</code></pre>
<p>è¦æ¨¡æ‹Ÿåˆ†é…å•ä½ä¸åŒæ—¶çš„å¯ç”¨ç©ºé—´ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<pre><code class="hljs arduino">ceph daemon osd<span class="hljs-number">.123</span> bluestore bluefs <span class="hljs-built_in">available</span> &lt;alloc-unit-<span class="hljs-built_in">size</span>&gt;</code></pre>
<p>è¦æ£€æŸ¥BlueStoreç¢ç‰‡ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<pre><code class="hljs mipsasm">ceph daemon osd.<span class="hljs-number">123</span> <span class="hljs-keyword">bluestore </span>allocator <span class="hljs-keyword">score </span><span class="hljs-keyword">block</span></code></pre>
<p>å¦‚æœéœ€è¦è¯¦ç»†çš„å…è´¹ç¢ç‰‡æŠ¥å‘Šï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<pre><code class="hljs angelscript">ceph daemon osd<span class="hljs-number">.123</span> bluestore allocator dump block</code></pre>
<p>å¦‚æœå¤„ç†æœªè¿è¡Œçš„OSDè¿›ç¨‹æ—¶å¯ä»¥ä½¿ç”¨ceph-bluestore-toolæ£€æŸ¥ç¢ç‰‡ã€‚è·å–ç¢ç‰‡åˆ†æ•°ï¼š</p>
<pre><code class="hljs crystal">ceph-bluestore-tool --path /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>-123 --<span class="hljs-title">allocator</span> <span class="hljs-title">block</span> <span class="hljs-title">free</span>-<span class="hljs-title">score</span></span></code></pre>
<p>å¹¶è½¬å‚¨è¯¦ç»†çš„å…è´¹å—ï¼š</p>
<pre><code class="hljs crystal">ceph-bluestore-tool --path /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>-123 --<span class="hljs-title">allocator</span> <span class="hljs-title">block</span> <span class="hljs-title">free</span>-<span class="hljs-title">dump</span></span></code></pre>
<p>é€šè¿‡åœæ­¢æ¯ä¸ªOSDï¼Œè¿è¡Œä¿®å¤æ“ä½œå¹¶é‡æ–°å¯åŠ¨å®ƒï¼Œå¯ä»¥å°†æ—§çš„OSDæ›´æ–°ä¸ºæŒ‰æ± è·Ÿè¸ªã€‚ä¾‹å¦‚ï¼Œå¦‚æœ<code>osd.123</code>éœ€è¦æ›´æ–°ï¼Œåˆ™ ï¼š</p>
<pre><code class="hljs crystal">systemctl stop ceph-osd@<span class="hljs-number">123</span>
ceph-bluestore-tool repair --path /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>-123</span>
systemctl start ceph-osd@<span class="hljs-number">123</span></code></pre>
<p>ä½¿ç”¨BlueStoreçš„ä¸€ä¸ªæˆ–å¤šä¸ªOSDåœ¨ç‰©ç†è®¾å¤‡çš„å¤§å°å’Œè·Ÿè¸ªå…¶å¤§å°çš„å…ƒæ•°æ®ä¹‹é—´å­˜åœ¨å†…éƒ¨ä¸ä¸€è‡´ã€‚å°†æ¥å¯èƒ½å¯¼è‡´OSDå´©æºƒã€‚</p>
<p>ç›¸å…³çš„OSDåº”è¯¥é”€æ¯å¹¶é‡æ–°é…ç½®ã€‚åº”å½“å°å¿ƒåœ°ä¸€æ¬¡æ‰§è¡Œä¸€ä¸ªOSDï¼Œå¹¶ä¸”è¿™ç§æ–¹å¼ä¸ä¼šä½¿ä»»ä½•æ•°æ®å—åˆ°å¨èƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœosd<code>$N</code>å‡ºç°é”™è¯¯ï¼Œåˆ™ï¼š</p>
<pre><code class="hljs awk">ceph osd out osd.<span class="hljs-variable">$N</span>
<span class="hljs-keyword">while</span> ! ceph osd safe-to-destroy osd.<span class="hljs-variable">$N</span> ; <span class="hljs-keyword">do</span> sleep <span class="hljs-number">1</span>m ; done
ceph osd destroy osd.<span class="hljs-variable">$N</span>
ceph-volume lvm zap <span class="hljs-regexp">/path/</span>to/device
ceph-volume lvm create --osd-id <span class="hljs-variable">$N</span> --data <span class="hljs-regexp">/path/</span>to/device</code></pre>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ£€æŸ¥è®¾å¤‡çš„è¿è¡ŒçŠ¶å†µï¼š</p>
<pre><code class="hljs nginx"><span class="hljs-attribute">ceph</span> device <span class="hljs-literal">info</span> &lt;device-id&gt;</code></pre>
<p>è®¾å¤‡é¢„æœŸå¯¿å‘½æ˜¯ç”±mgræˆ–å¤–éƒ¨å·¥å…·é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œçš„é¢„æµ‹æ¨¡å‹è®¾ç½®çš„ï¼š</p>
<pre><code class="hljs dsconfig"><span class="hljs-string">ceph </span><span class="hljs-string">device </span><span class="hljs-built_in">set-life-expectancy</span> &lt;<span class="hljs-string">device-id&gt;</span> &lt;<span class="hljs-string">from&gt;</span> &lt;<span class="hljs-string">to&gt;</span></code></pre>
<p>æ‚¨å¯ä»¥æ‰‹åŠ¨æ›´æ”¹å­˜å‚¨çš„é¢„æœŸå¯¿å‘½ï¼Œä½†è¿™é€šå¸¸æ— æ³•å®Œæˆä»»ä½•æ“ä½œï¼Œå› ä¸ºæœ€åˆè®¾ç½®çš„ä»»ä½•å·¥å…·éƒ½å¯èƒ½ä¼šå¯¹å…¶è¿›è¡Œé‡æ–°è®¾ç½®ï¼Œå¹¶ä¸”æ›´æ”¹å­˜å‚¨çš„å€¼ä¸ä¼šå½±å“ç¡¬ä»¶è®¾å¤‡çš„å®é™…è¿è¡ŒçŠ¶å†µã€‚</p>
<hr>
<h2 id="æ‰‹åŠ¨é…ç½®"><a href="#æ‰‹åŠ¨é…ç½®" class="headerlink" title="æ‰‹åŠ¨é…ç½®"></a>æ‰‹åŠ¨é…ç½®</h2><p>æ‰€æœ‰ Ceph é›†ç¾¤éƒ½éœ€è¦è‡³å°‘ä¸€ä¸ªç›‘è§†å™¨ã€ä¸” OSD æ•°é‡ä¸å°äºå‰¯æœ¬æ•°ã€‚è‡ªä¸¾å¼•å¯¼åˆå§‹ç›‘è§†å™¨æ˜¯éƒ¨ç½² Ceph å­˜å‚¨é›†ç¾¤çš„ç¬¬ä¸€æ­¥ï¼Œç›‘è§†å™¨çš„éƒ¨ç½²ä¹Ÿä¸ºæ•´ä¸ªé›†ç¾¤å¥ å®šäº†é‡è¦æ¡†æ¶ï¼Œå¦‚å­˜å‚¨æ± å‰¯æœ¬æ•°ã€æ¯ä¸ª OSD æ‹¥æœ‰çš„å½’ç½®ç»„æ•°é‡ï¼ˆPGï¼‰ã€å¿ƒè·³å‘¨æœŸã€æ˜¯å¦éœ€è®¤è¯ç­‰ï¼Œå…¶ä¸­å¤§å¤šæ•°é€‰é¡¹éƒ½æœ‰é»˜è®¤å€¼ï¼Œä½†æ˜¯å»ºè®¾ç”Ÿäº§é›†ç¾¤æ—¶ä»éœ€è¦æ‚¨ç†ŸçŸ¥å®ƒä»¬ã€‚</p>
<p><img src="http://docs.ceph.org.cn/_images/ditaa-b67d58275cae03a5573d36907b437e36df685600.png" srcset="/img/loading.gif" alt="img"></p>
<hr>
<h2 id="ceph-monitoré…ç½®"><a href="#ceph-monitoré…ç½®" class="headerlink" title="ceph monitoré…ç½®"></a>ceph monitoré…ç½®</h2><ol>
<li>ç™»å½•åˆ°åˆå§‹ç›‘è§†å™¨èŠ‚ç‚¹ï¼š</li>
</ol>
<pre><code class="hljs puppet"><span class="hljs-keyword">ssh</span> &#123;<span class="hljs-built_in">hostname</span>&#125;</code></pre>
<p>å¦‚ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">ssh</span> node<span class="hljs-number">1</span></code></pre>
<ol>
<li>ç¡®ä¿ä¿å­˜ Ceph é…ç½®æ–‡ä»¶çš„ç›®å½•å­˜åœ¨ï¼Œ Ceph é»˜è®¤ä½¿ç”¨ <code>/etc/ceph</code> ã€‚å®‰è£… <code>ceph</code> è½¯ä»¶æ—¶ï¼Œå®‰è£…å™¨ä¹Ÿä¼šè‡ªåŠ¨åˆ›å»º <code>/etc/ceph/</code> ç›®å½•ã€‚</li>
</ol>
<pre><code class="hljs awk">ls <span class="hljs-regexp">/etc/</span>ceph</code></pre>
<ol>
<li>åˆ›å»º Ceph é…ç½®æ–‡ä»¶ï¼Œ Ceph é»˜è®¤ä½¿ç”¨ <code>ceph.conf</code> ï¼Œå…¶ä¸­çš„ <code>ceph</code> æ˜¯é›†ç¾¤åå­—ã€‚</li>
</ol>
<pre><code class="hljs awk">sudo vim <span class="hljs-regexp">/etc/</span>ceph/ceph.conf</code></pre>
<ol>
<li>ç»™é›†ç¾¤åˆ†é…æƒŸä¸€ ID ï¼ˆå³ <code>fsid</code> ï¼‰ã€‚</li>
</ol>
<pre><code class="hljs ebnf"><span class="hljs-attribute">uuidgen</span></code></pre>
<ol>
<li>æŠŠæ­¤ ID å†™å…¥ Ceph é…ç½®æ–‡ä»¶ã€‚</li>
</ol>
<pre><code class="hljs ini"><span class="hljs-attr">fsid</span> = &#123;UUID&#125;</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">fsid</span> = a<span class="hljs-number">7</span>f<span class="hljs-number">64266</span>-<span class="hljs-number">0894</span>-<span class="hljs-number">4</span>f<span class="hljs-number">1</span>e-a<span class="hljs-number">635</span>-d<span class="hljs-number">0</span>aeaca<span class="hljs-number">0</span>e<span class="hljs-number">993</span></code></pre>
<ol>
<li>æŠŠåˆå§‹ç›‘è§†å™¨å†™å…¥ Ceph é…ç½®æ–‡ä»¶ã€‚</li>
</ol>
<pre><code class="hljs dust"><span class="xml">mon initial members = </span><span class="hljs-template-variable">&#123;hostname&#125;</span><span class="xml">[,</span><span class="hljs-template-variable">&#123;hostname&#125;</span><span class="xml">]</span></code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">mon</span> initial members = node<span class="hljs-number">1</span></code></pre>
<ol>
<li>æŠŠåˆå§‹ç›‘è§†å™¨çš„ IP åœ°å€å†™å…¥ Ceph é…ç½®æ–‡ä»¶ã€å¹¶ä¿å­˜ã€‚</li>
</ol>
<pre><code class="hljs armasm"><span class="hljs-symbol">mon</span> host = &#123;<span class="hljs-built_in">ip</span>-address&#125;[,&#123;<span class="hljs-built_in">ip</span>-address&#125;]</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs angelscript">mon host = <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span></code></pre>
<p><strong>æ³¨æ„ï¼š</strong> ä½ ä¹Ÿå¯ä»¥å†™ IPv6 åœ°å€ï¼Œä½†æ˜¯å¿…é¡»è®¾ç½® <code>ms bind ipv6 = true</code> ã€‚è¯¦æƒ…è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/network-config-ref">ç½‘ç»œé…ç½®å‚è€ƒ</a>ã€‚</p>
<ol>
<li>ä¸ºæ­¤é›†ç¾¤åˆ›å»ºå¯†é’¥ç¯ã€å¹¶ç”Ÿæˆç›‘è§†å™¨å¯†é’¥ã€‚</li>
</ol>
<pre><code class="hljs dsconfig"><span class="hljs-string">ceph-authtool </span><span class="hljs-built_in">--create-keyring</span> /<span class="hljs-string">tmp/</span><span class="hljs-string">ceph.</span><span class="hljs-string">mon.</span><span class="hljs-string">keyring </span><span class="hljs-built_in">--gen-key</span> -n <span class="hljs-string">mon.</span> <span class="hljs-built_in">--cap</span> <span class="hljs-string">mon </span><span class="hljs-string">&#x27;allow *&#x27;</span></code></pre>
<ol>
<li>ç”Ÿæˆç®¡ç†å‘˜å¯†é’¥ç¯ï¼Œç”Ÿæˆ <code>client.admin</code> ç”¨æˆ·å¹¶åŠ å…¥å¯†é’¥ç¯ã€‚</li>
</ol>
<pre><code class="hljs dsconfig"><span class="hljs-string">ceph-authtool </span><span class="hljs-built_in">--create-keyring</span> /<span class="hljs-string">etc/</span><span class="hljs-string">ceph/</span><span class="hljs-string">ceph.</span><span class="hljs-string">client.</span><span class="hljs-string">admin.</span><span class="hljs-string">keyring </span><span class="hljs-built_in">--gen-key</span> -n <span class="hljs-string">client.</span><span class="hljs-string">admin </span><span class="hljs-built_in">--set-uid=0</span> <span class="hljs-built_in">--cap</span> <span class="hljs-string">mon </span><span class="hljs-string">&#x27;allow *&#x27;</span> <span class="hljs-built_in">--cap</span> <span class="hljs-string">osd </span><span class="hljs-string">&#x27;allow *&#x27;</span> <span class="hljs-built_in">--cap</span> <span class="hljs-string">mds </span><span class="hljs-string">&#x27;allow&#x27;</span></code></pre>
<p>10.æŠŠ <code>client.admin</code> å¯†é’¥åŠ å…¥ <code>ceph.mon.keyring</code> ã€‚</p>
<pre><code class="hljs gradle">ceph-authtool <span class="hljs-regexp">/tmp/</span>ceph.mon.keyring --<span class="hljs-keyword">import</span>-keyring <span class="hljs-regexp">/etc/</span>ceph/ceph.client.admin.keyring</code></pre>
<ol>
<li><p>ç”¨è§„åˆ’å¥½çš„ä¸»æœºåã€å¯¹åº” IP åœ°å€ã€å’Œ FSID ç”Ÿæˆä¸€ä¸ªç›‘è§†å™¨å›¾ï¼Œå¹¶ä¿å­˜ä¸º <code>/tmp/monmap</code> ã€‚</p>
<pre><code class="hljs puppet">monmaptool --create --<span class="hljs-keyword">add</span> &#123;<span class="hljs-built_in">hostname</span>&#125; &#123;<span class="hljs-literal">ip</span>-address&#125; --<span class="hljs-keyword">fsid</span> &#123;<span class="hljs-built_in">uuid</span>&#125; /tmp/monmap</code></pre>
</li>
<li><p>åœ¨ç›‘è§†å™¨ä¸»æœºä¸Šåˆ†åˆ«åˆ›å»ºæ•°æ®ç›®å½•ã€‚</p>
</li>
</ol>
<p>è¯¦æƒ…è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/mon-config-ref#data">ç›‘è§†å™¨é…ç½®å‚è€ƒâ€”â€”æ•°æ®</a>ã€‚</p>
<pre><code class="hljs crystal">sudo mkdir /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">mon</span>/&#123;<span class="hljs-title">cluster</span>-<span class="hljs-title">name</span>&#125;-&#123;<span class="hljs-title">hostname</span>&#125;</span></code></pre>
<ol>
<li>ç”¨ç›‘è§†å™¨å›¾å’Œå¯†é’¥ç¯ç»„è£…å®ˆæŠ¤è¿›ç¨‹æ‰€éœ€çš„åˆå§‹æ•°æ®ã€‚</li>
</ol>
<pre><code class="hljs jboss-cli">ceph-mon [<span class="hljs-params">--cluster</span> &#123;cluster-name&#125;] <span class="hljs-params">--mkfs</span> -i &#123;hostname&#125; <span class="hljs-params">--monmap</span> <span class="hljs-string">/tmp/monmap</span> <span class="hljs-params">--keyring</span> <span class="hljs-string">/tmp/ceph.mon.keyring</span></code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs jboss-cli">ceph-mon <span class="hljs-params">--mkfs</span> -i node1 <span class="hljs-params">--monmap</span> <span class="hljs-string">/tmp/monmap</span> <span class="hljs-params">--keyring</span> <span class="hljs-string">/tmp/ceph.mon.keyring</span></code></pre>
<ol>
<li>å»ºä¸€ä¸ªç©ºæ–‡ä»¶ <code>done</code> ï¼Œè¡¨ç¤ºç›‘è§†å™¨å·²åˆ›å»ºã€å¯ä»¥å¯åŠ¨äº†ï¼š</li>
</ol>
<pre><code class="hljs crystal">sudo touch /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">mon</span>/<span class="hljs-title">ceph</span>-<span class="hljs-title">node1</span>/<span class="hljs-title">done</span></span></code></pre>
<p>15.å¯åŠ¨ç›‘è§†å™¨ã€‚</p>
<p>åœ¨ Ubuntu ä¸Šç”¨ Upstart ï¼š</p>
<pre><code class="hljs pgsql">sudo <span class="hljs-keyword">start</span> ceph-mon id=node1 [<span class="hljs-keyword">cluster</span>=&#123;<span class="hljs-keyword">cluster</span>-<span class="hljs-type">name</span>&#125;]</code></pre>
<ol>
<li>è¦ä½¿æ­¤å®ˆæŠ¤è¿›ç¨‹å¼€æœºè‡ªå¯ï¼Œéœ€è¦åˆ›å»ºä¸¤ä¸ªç©ºæ–‡ä»¶ï¼Œåƒè¿™æ ·ï¼š</li>
</ol>
<pre><code class="hljs crystal">sudo touch /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">mon</span>/&#123;<span class="hljs-title">cluster</span>-<span class="hljs-title">name</span>&#125;-&#123;<span class="hljs-title">hostname</span>&#125;/<span class="hljs-title">upstart</span></span></code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs crystal">sudo touch /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">mon</span>/<span class="hljs-title">ceph</span>-<span class="hljs-title">node1</span>/<span class="hljs-title">upstart</span></span></code></pre>
<ol>
<li>éªŒè¯ä¸‹ Ceph å·²ç»åˆ›å»ºäº†é»˜è®¤å­˜å‚¨æ± ã€‚</li>
</ol>
<pre><code class="hljs ebnf"><span class="hljs-attribute">ceph osd lspools</span></code></pre>
<p>ä½ åº”è¯¥ä¼šçœ‹åˆ°è¿™æ ·çš„è¾“å‡ºï¼š</p>
<pre><code class="hljs basic"><span class="hljs-symbol">0 </span><span class="hljs-keyword">data</span>,<span class="hljs-number">1</span> metadata,<span class="hljs-number">2</span> rbd,</code></pre>
<ol>
<li>ç¡®è®¤ä¸‹é›†ç¾¤åœ¨è¿è¡Œã€‚</li>
</ol>
<pre><code class="hljs ebnf"><span class="hljs-attribute">ceph -s</span></code></pre>
<p>ä½ åº”è¯¥ä»è¾“å‡ºé‡Œçœ‹åˆ°åˆšåˆšå¯åŠ¨çš„ç›‘è§†å™¨åœ¨æ­£å¸¸è¿è¡Œï¼Œå¹¶ä¸”åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªå¥åº·é”™è¯¯ï¼šå®ƒè¡¨æ˜å½’ç½®ç»„å¡åœ¨äº† <code>stuck inactive</code> çŠ¶æ€ã€‚è¾“å‡ºå¤§è‡´å¦‚æ­¤ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">cluster</span> a<span class="hljs-number">7</span>f<span class="hljs-number">64266</span>-<span class="hljs-number">0894</span>-<span class="hljs-number">4</span>f<span class="hljs-number">1</span>e-a<span class="hljs-number">635</span>-d<span class="hljs-number">0</span>aeaca<span class="hljs-number">0</span>e<span class="hljs-number">993</span>
  <span class="hljs-attribute">health</span> HEALTH_ERR <span class="hljs-number">192</span> pgs stuck inactive; <span class="hljs-number">192</span> pgs stuck unclean; no osds
  <span class="hljs-attribute">monmap</span> e<span class="hljs-number">1</span>: <span class="hljs-number">1</span> mons at &#123;node<span class="hljs-number">1</span>=<span class="hljs-number">192.168.0.1:6789</span>/<span class="hljs-number">0</span>&#125;, election epoch <span class="hljs-number">1</span>, quorum <span class="hljs-number">0</span> node<span class="hljs-number">1</span>
  <span class="hljs-attribute">osdmap</span> e<span class="hljs-number">1</span>: <span class="hljs-number">0</span> osds: <span class="hljs-number">0</span> up, <span class="hljs-number">0</span> in
  <span class="hljs-attribute">pgmap</span> v<span class="hljs-number">2</span>: <span class="hljs-number">192</span> pgs, <span class="hljs-number">3</span> pools, <span class="hljs-number">0</span> bytes data, <span class="hljs-number">0</span> objects
     <span class="hljs-attribute">0</span> kB used, <span class="hljs-number">0</span> kB / <span class="hljs-number">0</span> kB avail
     <span class="hljs-attribute">192</span> creating</code></pre>
<p>æ›´è¯¦ç»†çš„ä»‹ç»å¯ä»¥å‚è€ƒ<a href="#MONITOR">MONITOR</a></p>
<hr>
<h2 id="ceph-OSDé…ç½®"><a href="#ceph-OSDé…ç½®" class="headerlink" title="ceph OSDé…ç½®"></a>ceph OSDé…ç½®</h2><p>Ceph é…ç½®æ–‡ä»¶æ·»åŠ  OSD</p>
<p>ä½ çš„åˆå§‹ç›‘è§†å™¨å¯ä»¥æ­£å¸¸è¿è¡Œåå°±å¯ä»¥æ·»åŠ  OSD äº†ã€‚è¦æƒ³è®©é›†ç¾¤è¾¾åˆ° <code>active + clean</code> çŠ¶æ€ï¼Œå¿…é¡»å®‰è£…è¶³å¤Ÿå¤šçš„ OSD æ¥å¤„ç†å¯¹è±¡å‰¯æœ¬ï¼ˆå¦‚ <code>osd pool default size = 2</code> éœ€è¦è‡³å°‘ 2 ä¸ª OSD ï¼‰ã€‚åœ¨å®Œæˆç›‘è§†å™¨è‡ªä¸¾å¼•å¯¼åï¼Œé›†ç¾¤å°±æœ‰äº†é»˜è®¤çš„ CRUSH å›¾ï¼Œä½†ç°åœ¨æ­¤å›¾è¿˜æ˜¯ç©ºçš„ï¼Œé‡Œé¢æ²¡æœ‰ä»»ä½• OSD æ˜ å°„åˆ° Ceph èŠ‚ç‚¹ã€‚</p>
<h3 id="ç²¾ç®€å‹"><a href="#ç²¾ç®€å‹" class="headerlink" title="ç²¾ç®€å‹"></a>ç²¾ç®€å‹</h3><p>Ceph è½¯ä»¶åŒ…æä¾›äº† <code>ceph-disk</code> å·¥å…·ï¼Œç”¨äºå‡†å¤‡ç¡¬ç›˜ï¼šå¯ä»¥æ˜¯åˆ†åŒºæˆ–ç”¨äº Ceph çš„ç›®å½•ã€‚ <code>ceph-disk</code> å¯é€šè¿‡é€’å¢ç´¢å¼•æ¥åˆ›å»º OSD ID ï¼›è¿˜èƒ½æŠŠ OSD åŠ å…¥ CRUSH å›¾ã€‚ <code>ceph-disk</code> çš„è¯¦ç»†ç”¨æ³•å¯å‚è€ƒ <code>ceph-disk -h</code> ï¼Œæ­¤å·¥å…·æŠŠåé¢å°†æåˆ°çš„<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/install/manual-deployment/#id3">ç²¾ç®€å‹</a>é‡Œé¢çš„æ­¥éª¤éƒ½è‡ªåŠ¨åŒ–äº†ã€‚ä¸ºæŒ‰ç…§ç²¾ç®€å‹åˆ›å»ºå‰ä¸¤ä¸ª OSD ï¼Œåœ¨ <code>node2</code> å’Œ <code>node3</code> ä¸Šæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š</p>
<ol>
<li><p>å‡†å¤‡OSDã€‚</p>
<pre><code class="hljs n1ql">ssh &#123;node-name&#125;
sudo ceph-disk <span class="hljs-keyword">prepare</span> --<span class="hljs-keyword">cluster</span> &#123;<span class="hljs-keyword">cluster</span>-name&#125; --<span class="hljs-keyword">cluster</span>-<span class="hljs-built_in">uuid</span> &#123;<span class="hljs-built_in">uuid</span>&#125; --fs-<span class="hljs-built_in">type</span> &#123;ext4|xfs|btrfs&#125; &#123;data-<span class="hljs-keyword">path</span>&#125; [&#123;journal-<span class="hljs-keyword">path</span>&#125;]</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">ssh</span> node<span class="hljs-number">1</span>
<span class="hljs-attribute">sudo</span> ceph-disk prepare --cluster ceph --cluster-uuid a<span class="hljs-number">7</span>f<span class="hljs-number">64266</span>-<span class="hljs-number">0894</span>-<span class="hljs-number">4</span>f<span class="hljs-number">1</span>e-a<span class="hljs-number">635</span>-d<span class="hljs-number">0</span>aeaca<span class="hljs-number">0</span>e<span class="hljs-number">993</span> --fs-type ext<span class="hljs-number">4</span> /dev/hdd<span class="hljs-number">1</span></code></pre>
</li>
<li><p>æ¿€æ´» OSDï¼š</p>
<pre><code class="hljs puppet">sudo ceph-disk <span class="hljs-keyword">activate</span> &#123;data-<span class="hljs-built_in">path</span>&#125; [--activate-<span class="hljs-keyword">key</span> &#123;<span class="hljs-built_in">path</span>&#125;]</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs awk">sudo ceph-disk activate <span class="hljs-regexp">/dev/</span>hdd1</code></pre>
<p><strong>æ³¨ï¼š</strong> å¦‚æœä½ çš„ Ceph èŠ‚ç‚¹ä¸Šæ²¡æœ‰ <code>/var/lib/ceph/bootstrap-osd/&#123;cluster&#125;.keyring</code> ï¼Œé‚£ä¹ˆåº”è¯¥å¤–åŠ  <code>--activate-key</code> å‚æ•°ã€‚</p>
</li>
</ol>
<h3 id="ç»†è‡´å‹"><a href="#ç»†è‡´å‹" class="headerlink" title="ç»†è‡´å‹"></a>ç»†è‡´å‹</h3><p>è¦æ˜¯ä¸æƒ³å€ŸåŠ©ä»»ä½•è¾…åŠ©å·¥å…·ï¼Œå¯æŒ‰ä¸‹åˆ—æ­¥éª¤åˆ›å»º OSD ã€å°†ä¹‹åŠ å…¥é›†ç¾¤å’Œ CRUSH å›¾ã€‚æŒ‰ä¸‹åˆ—è¯¦ç»†æ­¥éª¤å¯åœ¨ <code>node2</code> å’Œ <code>node3</code> ä¸Šå¢åŠ å‰ 2 ä¸ª OSD ï¼š</p>
<ol>
<li><p>ç™»å½•åˆ°OSDä¸»æœºã€‚</p>
<pre><code class="hljs crmsh">ssh &#123;<span class="hljs-keyword">node</span><span class="hljs-title">-name</span>&#125;</code></pre>
</li>
<li><p>ç»™ OSD åˆ†é… UUID ã€‚</p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">uuidgen</span></code></pre>
</li>
<li><p>åˆ›å»º OSD ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š UUID ï¼Œå°†ä¼šåœ¨ OSD é¦–æ¬¡å¯åŠ¨æ—¶åˆ†é…ä¸€ä¸ªã€‚ä¸‹åˆ—å‘½ä»¤æ‰§è¡Œå®Œæˆåå°†è¾“å‡º OSD å·ï¼Œåœ¨åç»­æ­¥éª¤é‡Œè¿˜ä¼šç”¨åˆ°è¿™ä¸ªå·ã€‚</p>
<pre><code class="hljs sql">ceph osd <span class="hljs-keyword">create</span> [&#123;<span class="hljs-keyword">uuid</span>&#125; [&#123;<span class="hljs-keyword">id</span>&#125;]]</code></pre>
</li>
<li><p>åœ¨æ–° OSD ä¸»æœºä¸Šåˆ›å»ºé»˜è®¤ç›®å½•ã€‚</p>
<pre><code class="hljs crystal">ssh &#123;new-osd-host&#125;
sudo mkdir /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/&#123;<span class="hljs-title">cluster</span>-<span class="hljs-title">name</span>&#125;-&#123;<span class="hljs-title">osd</span>-<span class="hljs-title">number</span>&#125;</span></code></pre>
</li>
<li><p>å¦‚æœè¦æŠŠ OSD è£…åˆ°éç³»ç»Ÿç›˜çš„ç‹¬ç«‹ç¡¬ç›˜ä¸Šï¼Œå…ˆåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿã€ç„¶åæŒ‚è½½åˆ°åˆšåˆ›å»ºçš„ç›®å½•ä¸‹ï¼š</p>
<pre><code class="hljs crystal">ssh &#123;new-osd-host&#125;
sudo mkfs -t &#123;fstype&#125; /dev/&#123;hdd&#125;
sudo mount -o user_xattr /dev/&#123;hdd&#125; /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/&#123;<span class="hljs-title">cluster</span>-<span class="hljs-title">name</span>&#125;-&#123;<span class="hljs-title">osd</span>-<span class="hljs-title">number</span>&#125;</span></code></pre>
</li>
<li><p>åˆå§‹åŒ– OSD æ•°æ®ç›®å½•ï¼š</p>
<pre><code class="hljs puppet"><span class="hljs-keyword">ssh</span> &#123;new-osd-host&#125;
<span class="hljs-keyword">sudo</span> <span class="hljs-keyword">ceph</span>-osd -<span class="hljs-keyword">i</span> &#123;osd-num&#125; --mkfs --mkkey --osd-uuid [&#123;uuid&#125;]</code></pre>
<p>åŠ  <code>--mkkey</code> é€‰é¡¹è¿è¡Œ <code>ceph-osd</code> ä¹‹å‰ï¼Œæ­¤ç›®å½•å¿…é¡»æ˜¯ç©ºçš„ï¼›å¦å¤–ï¼Œå¦‚æœé›†ç¾¤åå­—ä¸æ˜¯é»˜è®¤å€¼ï¼Œè¿˜è¦ç»™ <code>ceph-osd</code> æŒ‡å®š <code>--cluster</code> é€‰é¡¹ã€‚</p>
</li>
<li><p>æ³¨å†Œæ­¤ OSD çš„å¯†é’¥ã€‚è·¯å¾„å†… <code>ceph-&#123;osd-num&#125;</code> é‡Œçš„ <code>ceph</code> å…¶å«ä¹‰ä¸º <code>$cluster-$id</code> ï¼Œå¦‚æœä½ çš„é›†ç¾¤åå­—ä¸æ˜¯ <code>ceph</code> ï¼Œè¯·æŒ‡å®šè‡ªå·±çš„é›†ç¾¤åï¼š</p>
<pre><code class="hljs crystal">sudo ceph auth add osd.&#123;osd-num&#125; osd <span class="hljs-string">&#x27;allow *&#x27;</span> mon <span class="hljs-string">&#x27;allow profile osd&#x27;</span> -i /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/&#123;<span class="hljs-title">cluster</span>-<span class="hljs-title">name</span>&#125;-&#123;<span class="hljs-title">osd</span>-<span class="hljs-title">num</span>&#125;/<span class="hljs-title">keyring</span></span></code></pre>
</li>
<li><p>æŠŠæ­¤èŠ‚ç‚¹åŠ å…¥ CRUSH å›¾ã€‚</p>
<pre><code class="hljs smali">ceph [--cluster &#123;cluster-name&#125;] osd crush<span class="hljs-built_in"> add-bucket </span>&#123;hostname&#125; host</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs smali">ceph osd crush<span class="hljs-built_in"> add-bucket </span>node1 host</code></pre>
</li>
<li><p>æŠŠæ­¤ Ceph èŠ‚ç‚¹æ”¾å…¥ <code>default</code> æ ¹ä¸‹ã€‚</p>
<pre><code class="hljs arduino">ceph osd crush <span class="hljs-built_in">move</span> node1 root=<span class="hljs-keyword">default</span></code></pre>
</li>
<li><p>æŠŠæ­¤ OSD åŠ å…¥ CRUSH å›¾ä¹‹åï¼Œå®ƒå°±èƒ½æ¥æ”¶æ•°æ®äº†ã€‚ä½ ä¹Ÿå¯ä»¥åç¼–è¯‘ CRUSH å›¾ã€æŠŠæ­¤ OSD åŠ å…¥è®¾å¤‡åˆ—è¡¨ã€å¯¹åº”ä¸»æœºä½œä¸ºæ¡¶åŠ å…¥ï¼ˆå¦‚æœå®ƒè¿˜ä¸åœ¨ CRUSH å›¾é‡Œï¼‰ã€ç„¶åæ­¤è®¾å¤‡ä½œä¸ºä¸»æœºçš„ä¸€ä¸ªæ¡ç›®ã€åˆ†é…æƒé‡ã€é‡æ–°ç¼–è¯‘ã€æ³¨å…¥é›†ç¾¤ã€‚</p>
<pre><code class="hljs dust"><span class="xml">ceph [--cluster </span><span class="hljs-template-variable">&#123;cluster-name&#125;</span><span class="xml">] osd crush add </span><span class="hljs-template-variable">&#123;id-or-name&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;weight&#125;</span><span class="xml"> [</span><span class="hljs-template-variable">&#123;bucket-type&#125;</span><span class="xml">=</span><span class="hljs-template-variable">&#123;bucket-name&#125;</span><span class="xml"> ...]</span></code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">ceph</span> osd crush add osd.<span class="hljs-number">0</span> <span class="hljs-number">1</span>.<span class="hljs-number">0</span> host=node<span class="hljs-number">1</span></code></pre>
</li>
<li><p>æŠŠ OSD åŠ å…¥ Ceph åï¼Œ OSD å·²ç»åœ¨é…ç½®é‡Œäº†ã€‚ä½†å®ƒè¿˜æ²¡å¼€å§‹è¿è¡Œï¼Œè¿™æ—¶å¤„äº <code>down</code> ä¸” <code>in</code> çŠ¶æ€ï¼Œè¦å¯åŠ¨è¿›ç¨‹æ‰èƒ½æ”¶æ•°æ®ã€‚</p>
<p>åœ¨ Ubuntu ç³»ç»Ÿä¸Šç”¨ Upstart å¯åŠ¨ï¼š</p>
<pre><code class="hljs pgsql">sudo <span class="hljs-keyword">start</span> ceph-osd id=&#123;osd-num&#125; [<span class="hljs-keyword">cluster</span>=&#123;<span class="hljs-keyword">cluster</span>-<span class="hljs-type">name</span>&#125;]</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs routeros">sudo start ceph-osd <span class="hljs-attribute">id</span>=0
sudo start ceph-osd <span class="hljs-attribute">id</span>=1</code></pre>
<p>åœ¨ Debian/CentOS/RHEL ä¸Šç”¨ sysvinit å¯åŠ¨ï¼š</p>
<pre><code class="hljs sql">sudo /etc/init.d/ceph <span class="hljs-keyword">start</span> osd.&#123;osd-<span class="hljs-keyword">num</span>&#125; [<span class="hljs-comment">--cluster &#123;cluster-name&#125;]</span></code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs awk">sudo <span class="hljs-regexp">/etc/i</span>nit.d/ceph start osd.<span class="hljs-number">0</span>
sudo <span class="hljs-regexp">/etc/i</span>nit.d/ceph start osd.<span class="hljs-number">1</span></code></pre>
<p>è¦è®©å®ˆæŠ¤è¿›ç¨‹å¼€æœºè‡ªå¯ï¼Œå¿…é¡»åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼š</p>
<pre><code class="hljs crystal">sudo touch /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/&#123;<span class="hljs-title">cluster</span>-<span class="hljs-title">name</span>&#125;-&#123;<span class="hljs-title">osd</span>-<span class="hljs-title">num</span>&#125;/<span class="hljs-title">sysvinit</span></span></code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs crystal">sudo touch /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>-0/<span class="hljs-title">sysvinit</span></span>
sudo touch /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">osd</span>/<span class="hljs-title">ceph</span>-1/<span class="hljs-title">sysvinit</span></span></code></pre>
<p>OSD å¯åŠ¨åï¼Œå®ƒåº”è¯¥å¤„äº <code>up</code> ä¸” <code>in</code> çŠ¶æ€ã€‚</p>
</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç›‘è§†å™¨å’Œä¸¤ä¸ª OSD å¼€å§‹æ­£å¸¸è¿è¡Œåï¼Œä½ å°±å¯ä»¥é€šè¿‡ä¸‹åˆ—å‘½ä»¤è§‚å¯Ÿå½’ç½®ç»„äº’è”è¿‡ç¨‹äº†ï¼š</p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">ceph -w</span></code></pre>
<p>æ‰§è¡Œä¸‹åˆ—å‘½ä»¤æŸ¥çœ‹ OSDæ ‘ï¼š</p>
<pre><code class="hljs dos">ceph osd <span class="hljs-built_in">tree</span></code></pre>
<p>ä½ åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼š</p>
<pre><code class="hljs lsl"># id    weight  type name       up/down reweight
<span class="hljs-number">-1</span>      <span class="hljs-number">2</span>       root <span class="hljs-section">default</span>
<span class="hljs-number">-2</span>      <span class="hljs-number">2</span>               host node1
<span class="hljs-number">0</span>       <span class="hljs-number">1</span>                       osd<span class="hljs-number">.0</span>   up      <span class="hljs-number">1</span>
<span class="hljs-number">-3</span>      <span class="hljs-number">1</span>               host node2
<span class="hljs-number">1</span>       <span class="hljs-number">1</span>                       osd<span class="hljs-number">.1</span>   up      <span class="hljs-number">1</span></code></pre>
<p>è¦å¢åŠ ï¼ˆæˆ–åˆ é™¤ï¼‰é¢å¤–ç›‘è§†å™¨ï¼Œå‚è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/operations/add-or-rm-mons">å¢åŠ /åˆ é™¤ç›‘è§†å™¨</a>ã€‚è¦å¢åŠ ï¼ˆæˆ–åˆ é™¤ï¼‰é¢å¤– OSD ï¼Œå‚è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/operations/add-or-rm-osds">å¢åŠ /åˆ é™¤ OSD</a> ã€‚å¯ç”¨äºé…ç½®å­˜å‚¨é›†ç¾¤å†…çš„æ‰€æœ‰å®ˆæŠ¤è¿›ç¨‹ã€æˆ–è€…æŸä¸€ç±»å‹çš„æ‰€æœ‰å®ˆæŠ¤è¿›ç¨‹ã€‚è¦é…ç½®ä¸€ç³»åˆ—å®ˆæŠ¤è¿›ç¨‹ï¼Œè¿™äº›é…ç½®å¿…é¡»ä½äºèƒ½æ”¶åˆ°é…ç½®çš„æ®µè½ä¹‹ä¸‹ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs json">[global]</code></pre>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th><code>[global]</code> ä¸‹çš„é…ç½®å½±å“ Ceph é›†ç¾¤é‡Œçš„æ‰€æœ‰å®ˆæŠ¤è¿›ç¨‹ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å®ä¾‹:</td>
<td><code>auth supported = cephx</code></td>
</tr>
</tbody>
</table>
</div>
<pre><code class="hljs json">[osd]</code></pre>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th><code>[osd]</code> ä¸‹çš„é…ç½®å½±å“å­˜å‚¨é›†ç¾¤é‡Œçš„æ‰€æœ‰ <code>ceph-osd</code> è¿›ç¨‹ï¼Œå¹¶ä¸”ä¼šè¦†ç›– <code>[global]</code> ä¸‹çš„åŒä¸€é€‰é¡¹ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å®ä¾‹:</td>
<td><code>osd journal size = 1000</code></td>
</tr>
</tbody>
</table>
</div>
<pre><code class="hljs json">[mon]</code></pre>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th><code>[mon]</code> ä¸‹çš„é…ç½®å½±å“é›†ç¾¤é‡Œçš„æ‰€æœ‰ <code>ceph-mon</code> è¿›ç¨‹ï¼Œå¹¶ä¸”ä¼šè¦†ç›– <code>[global]</code> ä¸‹çš„åŒä¸€é€‰é¡¹ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å®ä¾‹:</td>
<td><code>mon addr = 10.0.0.101:6789</code></td>
</tr>
</tbody>
</table>
</div>
<pre><code class="hljs json">[mds]</code></pre>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th><code>[mds]</code> ä¸‹çš„é…ç½®å½±å“é›†ç¾¤é‡Œçš„æ‰€æœ‰ <code>ceph-mds</code> è¿›ç¨‹ï¼Œå¹¶ä¸”ä¼šè¦†ç›– <code>[global]</code> ä¸‹çš„åŒä¸€é€‰é¡¹ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å®ä¾‹:</td>
<td><code>host = myserver01</code></td>
</tr>
</tbody>
</table>
</div>
<pre><code class="hljs json">[client]</code></pre>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th><code>[client]</code> ä¸‹çš„é…ç½®å½±å“æ‰€æœ‰å®¢æˆ·ç«¯ï¼ˆå¦‚æŒ‚è½½çš„ Ceph æ–‡ä»¶ç³»ç»Ÿã€æŒ‚è½½çš„å—è®¾å¤‡ç­‰ç­‰ï¼‰ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å®ä¾‹:</td>
<td><code>log file = /var/log/ceph/radosgw.log</code></td>
</tr>
</tbody>
</table>
</div>
<p>å…¨å±€è®¾ç½®å½±å“é›†ç¾¤å†…æ‰€æœ‰å®ˆæŠ¤è¿›ç¨‹çš„ä¾‹ç¨‹ï¼Œæ‰€ä»¥ <code>[global]</code> å¯ç”¨äºè®¾ç½®é€‚ç”¨æ‰€æœ‰å®ˆæŠ¤è¿›ç¨‹çš„é€‰é¡¹ã€‚ä½†å¯ä»¥ç”¨è¿™äº›è¦†ç›– <code>[global]</code> è®¾ç½®ï¼š</p>
<ol>
<li>åœ¨ <code>[osd]</code> ã€ <code>[mon]</code> ã€ <code>[mds]</code> ä¸‹æ›´æ”¹æŸä¸€ç±»è¿›ç¨‹çš„é…ç½®ã€‚</li>
<li>æ›´æ”¹ç‰¹å®šè¿›ç¨‹çš„è®¾ç½®ï¼Œå¦‚ <code>[osd.1]</code> ã€‚</li>
</ol>
<p>è¦†ç›–å…¨å±€è®¾ç½®ä¼šå½±å“æ‰€æœ‰å­è¿›ç¨‹ï¼Œæ˜ç¡®å‰”é™¤çš„ä¾‹å¤–ã€‚</p>
<p>å…¸å‹çš„å…¨å±€è®¾ç½®åŒ…æ‹¬æ¿€æ´»è®¤è¯ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs routeros">[global]
<span class="hljs-comment">#Enable authentication between hosts within the cluster.</span>
<span class="hljs-comment">#v 0.54 and earlier</span>
auth supported = cephx

<span class="hljs-comment">#v 0.55 and after</span>
auth cluster required = cephx
auth<span class="hljs-built_in"> service </span>required = cephx
auth<span class="hljs-built_in"> client </span>required = cephx</code></pre>
<p>ä½ å¯ä»¥ç»Ÿä¸€é…ç½®ä¸€ç±»å®ˆæŠ¤è¿›ç¨‹ã€‚é…ç½®å†™åˆ° <code>[osd]</code> ã€ <code>[mon]</code> ã€ <code>[mds]</code> ä¸‹æ—¶ï¼Œæ— é¡»å†æŒ‡å®šæŸä¸ªç‰¹å®šä¾‹ç¨‹ï¼Œå³å¯åˆ†åˆ«å½±å“æ‰€æœ‰ OSD ã€ç›‘è§†å™¨ã€å…ƒæ•°æ®è¿›ç¨‹ã€‚</p>
<p>å…¸å‹çš„ç±»èŒƒç•´é…ç½®åŒ…æ‹¬æ—¥å¿—å°ºå¯¸ã€ filestore é€‰é¡¹ç­‰ï¼Œå¦‚ï¼š</p>
<pre><code class="hljs angelscript">[osd]
osd journal size = <span class="hljs-number">1000</span></code></pre>
<p>ä½ ä¹Ÿå¯ä»¥é…ç½®æŸä¸ªç‰¹å®šä¾‹ç¨‹ã€‚ä¸€ä¸ªä¾‹ç¨‹ç”±ç±»å‹å’ŒåŠå…¶ä¾‹ç¨‹ ID ç¡®å®šï¼Œ OSD çš„ä¾‹ç¨‹ ID åªèƒ½æ˜¯æ•°å­—ï¼Œä½†ç›‘è§†å™¨å’Œå…ƒæ•°æ®æœåŠ¡å™¨çš„ ID å¯åŒ…å«å­—æ¯å’Œæ•°å­—ã€‚</p>
<pre><code class="hljs ini"><span class="hljs-section">[osd.1]</span>
<span class="hljs-comment"># settings affect osd.1 only.</span>

<span class="hljs-section">[mon.a]</span>
<span class="hljs-comment"># settings affect mon.a only.</span>

<span class="hljs-section">[mds.b]</span>
<span class="hljs-comment"># settings affect mds.b only.</span></code></pre>
<p>å¦‚æœä½ æƒ³é…ç½®æŸä¸ª Ceph ç½‘å…³å®¢æˆ·ç«¯ï¼Œå¯ä»¥ç”¨ç‚¹ï¼ˆ . ï¼‰åˆ†éš”çš„å®ˆæŠ¤è¿›ç¨‹å’Œä¾‹ç¨‹æ¥æŒ‡å®šï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs clean">[client.radosgw.<span class="hljs-keyword">instance</span>-name]
# settings affect client.radosgw.<span class="hljs-keyword">instance</span>-name only.</code></pre>
<h2 id="å…ƒå˜é‡Â¶"><a href="#å…ƒå˜é‡Â¶" class="headerlink" title="å…ƒå˜é‡Â¶"></a>å…ƒå˜é‡<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/ceph-conf/#ceph-metavariables">Â¶</a></h2><p>å…ƒå˜é‡å¤§å¤§ç®€åŒ–äº†é›†ç¾¤é…ç½®ã€‚ Ceph ä¼šæŠŠé…ç½®çš„å…ƒå˜é‡å±•å¼€ä¸ºå…·ä½“å€¼ï¼›å…ƒå˜é‡åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œå¯ä»¥ç”¨åœ¨é…ç½®æ–‡ä»¶çš„ <code>[global]</code> ã€ <code>[osd]</code> ã€ <code>[mon]</code> ã€ <code>[mds]</code> æ®µé‡Œï¼Œç±»ä¼¼äº Bash çš„ shell æ‰©å±•ã€‚</p>
<p>Ceph æ”¯æŒä¸‹åˆ—å…ƒå˜é‡ï¼š</p>
<pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-meta-keyword">$cluster</span></span></code></pre>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>å±•å¼€ä¸ºå­˜å‚¨é›†ç¾¤åå­—ï¼Œåœ¨åŒä¸€å¥—ç¡¬ä»¶ä¸Šè¿è¡Œå¤šä¸ªé›†ç¾¤æ—¶æœ‰ç”¨ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å®ä¾‹:</td>
<td><code>/etc/ceph/$cluster.keyring</code></td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td><code>ceph</code></td>
</tr>
</tbody>
</table>
</div>
<pre><code class="hljs elm">$<span class="hljs-keyword">type</span></code></pre>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>å¯å±•å¼€ä¸º <code>mds</code> ã€ <code>osd</code> ã€ <code>mon</code> ä¸­çš„ä¸€ä¸ªï¼Œæœ‰èµ–äºå½“å‰å®ˆæŠ¤è¿›ç¨‹çš„ç±»å‹ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å®ä¾‹:</td>
<td><code>/var/lib/ceph/$type</code></td>
</tr>
</tbody>
</table>
</div>
<pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-meta-keyword">$id</span></span></code></pre>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>å±•å¼€ä¸ºå®ˆæŠ¤è¿›ç¨‹æ ‡è¯†ç¬¦ï¼› <code>osd.0</code> åº”ä¸º <code>0</code> ï¼Œ <code>mds.a</code> æ˜¯ <code>a</code> ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å®ä¾‹:</td>
<td><code>/var/lib/ceph/$type/$cluster-$id</code></td>
</tr>
</tbody>
</table>
</div>
<pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-meta-keyword">$host</span></span></code></pre>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>å±•å¼€ä¸ºå½“å‰å®ˆæŠ¤è¿›ç¨‹çš„ä¸»æœºåã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
</div>
<pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-meta-keyword">$name</span></span></code></pre>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>å±•å¼€ä¸º <code>$type.$id</code> ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å®ä¾‹:</td>
<td><code>/var/run/ceph/$cluster-$name.asok</code></td>
</tr>
</tbody>
</table>
</div>
<h2 id="å…±æœ‰é€‰é¡¹"><a href="#å…±æœ‰é€‰é¡¹" class="headerlink" title="å…±æœ‰é€‰é¡¹"></a>å…±æœ‰é€‰é¡¹</h2><p><a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/install/hardware-recommendations">ç¡¬ä»¶æ¨è</a>æ®µæä¾›äº†ä¸€äº›é…ç½® Ceph å­˜å‚¨é›†ç¾¤çš„ç¡¬ä»¶æŒ‡å¯¼ã€‚ä¸€ä¸ª <a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/glossary/#term-13"><em>Ceph èŠ‚ç‚¹</em></a>å¯ä»¥è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œä¾‹å¦‚ä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šä¸ªç¡¬ç›˜ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªç¡¬ç›˜é…ç½®ä¸€ä¸ª <code>ceph-osd</code> å®ˆæŠ¤è¿›ç¨‹ã€‚ç†æƒ³æƒ…å†µä¸‹ä¸€å°ä¸»æœºåº”è¯¥åªè¿è¡Œä¸€ç±»è¿›ç¨‹ï¼Œä¾‹å¦‚ï¼šä¸€å°ä¸»æœºè¿è¡Œç€ <code>ceph-osd</code> è¿›ç¨‹ï¼Œå¦ä¸€å°ä¸»æœºè¿è¡Œç€ <code>ceph-mds</code> è¿›ç¨‹ï¼Œ <code>ceph-mon</code> è¿›ç¨‹åˆåœ¨å¦å¤–ä¸€å°ä¸»æœºä¸Šã€‚</p>
<p>å„èŠ‚ç‚¹éƒ½ç”¨ <code>host</code> é€‰é¡¹æŒ‡å®šä¸»æœºåå­—ï¼Œç›‘è§†å™¨è¿˜éœ€è¦ç”¨ <code>addr</code> é€‰é¡¹æŒ‡å®šç½‘ç»œåœ°å€å’Œç«¯å£ï¼ˆå³åŸŸåæˆ– IP åœ°å€ï¼‰ã€‚åŸºæœ¬é…ç½®æ–‡ä»¶å¯ä»¥åªæŒ‡å®šæœ€å°é…ç½®ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs ini"><span class="hljs-section">[global]</span>
<span class="hljs-attr">mon_initial_members</span> = ceph1
<span class="hljs-attr">mon_host</span> = <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span></code></pre>
<div class="note note-danger">
            <p><code>host</code> é€‰é¡¹æ˜¯æ­¤èŠ‚ç‚¹çš„çŸ­åå­—ï¼Œä¸æ˜¯å…¨èµ„åŸŸåï¼ˆ FQDN ï¼‰ï¼Œä¹Ÿ<strong>ä¸æ˜¯</strong> IP åœ°å€ï¼›æ‰§è¡Œ <code>hostname -s</code> å³å¯å¾—åˆ°çŸ­åå­—ã€‚ä¸è¦ç»™åˆå§‹ç›‘è§†å™¨ä¹‹å¤–çš„ä¾‹ç¨‹è®¾ç½® <code>host</code> ï¼Œé™¤éä½ æƒ³æ‰‹åŠ¨éƒ¨ç½²ï¼›<strong>ä¸€å®šä¸èƒ½</strong>ç”¨äº <code>chef</code> æˆ– <code>ceph-deploy</code> ï¼Œè¿™äº›å·¥å…·ä¼šè‡ªåŠ¨è·å–æ­£ç¡®ç»“æœã€‚</p>
          </div>
<h2 id="ç½‘ç»œé…ç½®"><a href="#ç½‘ç»œé…ç½®" class="headerlink" title="ç½‘ç»œé…ç½®"></a>ç½‘ç»œé…ç½®</h2><p><img src="\img\ceph-network.png" srcset="/img/loading.gif" alt="img"></p>
<ol>
<li><strong>æ€§èƒ½ï¼š</strong> OSD ä¸ºå®¢æˆ·ç«¯å¤„ç†æ•°æ®å¤åˆ¶ï¼Œå¤åˆ¶å¤šä»½æ—¶ OSD é—´çš„ç½‘ç»œè´Ÿè½½åŠ¿å¿…ä¼šå½±å“åˆ°å®¢æˆ·ç«¯å’Œ Ceph é›†ç¾¤çš„é€šè®¯ï¼ŒåŒ…æ‹¬å»¶æ—¶å¢åŠ ã€äº§ç”Ÿæ€§èƒ½é—®é¢˜ï¼›æ¢å¤å’Œé‡å‡è¡¡ä¹Ÿä¼šæ˜¾è‘—å¢åŠ å…¬å…±ç½‘å»¶æ—¶ã€‚å…³äº Ceph å¦‚ä½•å¤åˆ¶å‚è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/architecture#scalability-and-high-availability">ä¼¸ç¼©æ€§å’Œé«˜å¯ç”¨æ€§</a>ï¼›å…³äºå¿ƒè·³æµé‡å‚è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/mon-osd-interaction">ç›‘è§†å™¨ä¸ OSD çš„äº¤äº’</a>ã€‚</li>
<li><strong>å®‰å…¨ï¼š</strong> å¤§å¤šæ•°äººéƒ½æ˜¯è‰¯æ°‘ï¼Œå¾ˆå°‘çš„ä¸€æ’®äººå–œæ¬¢æŠ˜è…¾æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆ DoS ï¼‰ã€‚å½“ OSD é—´çš„æµé‡å¤±æ§æ—¶ï¼Œå½’ç½®ç»„å†ä¹Ÿä¸èƒ½è¾¾åˆ° <code>active + clean</code> çŠ¶æ€ï¼Œè¿™æ ·ç”¨æˆ·å°±ä¸èƒ½è¯»å†™æ•°æ®äº†ã€‚æŒ«è´¥æ­¤ç±»æ”»å‡»çš„ä¸€ç§å¥½æ–¹æ³•æ˜¯<u>ç»´æŠ¤ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„é›†ç¾¤ç½‘ï¼Œä½¿ä¹‹ä¸èƒ½ç›´è¿äº’è”ç½‘</u>ï¼›å¦å¤–ï¼Œè¯·è€ƒè™‘ç”¨<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/auth-config-ref#signatures">æ¶ˆæ¯ç­¾å</a>é˜²æ­¢æ¬ºéª—æ”»å‡»ã€‚</li>
</ol>
<h3 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h3><p>å®ˆæŠ¤è¿›ç¨‹é»˜è®¤ä¼š<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/network-config-ref/#id10">ç»‘å®š</a>åˆ° <code>6800:7300</code> é—´çš„ç«¯å£ï¼Œä½ å¯ä»¥æ›´æ”¹æ­¤èŒƒå›´ã€‚æ›´æ”¹é˜²ç«å¢™é…ç½®å‰å…ˆæ£€æŸ¥ä¸‹ <code>iptables</code> é…ç½®ã€‚</p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">sudo iptables -L</span></code></pre>
<p>ä¸€äº› Linux å‘è¡Œç‰ˆçš„è§„åˆ™æ‹’ç»é™¤ SSH ä¹‹å¤–çš„æ‰€æœ‰ç½‘å¡çš„æ‰€æœ‰å…¥æ ˆè¿æ¥ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs vhdl"><span class="hljs-keyword">REJECT</span> <span class="hljs-keyword">all</span> <span class="hljs-comment">-- anywhere anywhere reject-with icmp-host-prohibited</span></code></pre>
<p>ä½ å¾—å…ˆåˆ æ‰å…¬å…±ç½‘å’Œé›†ç¾¤ç½‘å¯¹åº”çš„è¿™äº›è§„åˆ™ï¼Œç„¶åå†å¢åŠ å®‰å…¨ä¿æŠ¤è§„åˆ™ã€‚</p>
<h3 id="ç›‘è§†å™¨é˜²ç«å¢™"><a href="#ç›‘è§†å™¨é˜²ç«å¢™" class="headerlink" title="ç›‘è§†å™¨é˜²ç«å¢™"></a>ç›‘è§†å™¨é˜²ç«å¢™</h3><p>ç›‘è§†å™¨é»˜è®¤ç›‘å¬ <code>6789</code> ç«¯å£ï¼Œè€Œä¸”ç›‘è§†å™¨æ€»æ˜¯è¿è¡Œåœ¨å…¬å…±ç½‘ã€‚æŒ‰ä¸‹ä¾‹å¢åŠ è§„åˆ™æ—¶ï¼Œè¦æŠŠ <code>&#123;iface&#125;</code> æ›¿æ¢ä¸ºå…¬å…±ç½‘æ¥å£ï¼ˆå¦‚ <code>eth0</code> ã€ <code>eth1</code> ç­‰ç­‰ï¼‰ã€ <code>&#123;ip-address&#125;</code> æ›¿æ¢ä¸ºå…¬å…±ç½‘ IP ã€ <code>&#123;netmask&#125;</code> æ›¿æ¢ä¸ºå…¬å…±ç½‘æ©ç ã€‚</p>
<pre><code class="hljs dust"><span class="xml">sudo iptables -A INPUT -i </span><span class="hljs-template-variable">&#123;iface&#125;</span><span class="xml"> -p tcp -s </span><span class="hljs-template-variable">&#123;ip-address&#125;</span><span class="xml">/</span><span class="hljs-template-variable">&#123;netmask&#125;</span><span class="xml"> --dport 6789 -j ACCEPT</span></code></pre>
<h3 id="MDS-é˜²ç«å¢™"><a href="#MDS-é˜²ç«å¢™" class="headerlink" title="MDS é˜²ç«å¢™"></a>MDS é˜²ç«å¢™</h3><p><a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/glossary/#term-64"><em>å…ƒæ•°æ®æœåŠ¡å™¨</em></a>ä¼šç›‘å¬å…¬å…±ç½‘ 6800 ä»¥ä¸Šçš„ç¬¬ä¸€ä¸ªå¯ç”¨ç«¯å£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œå¤šä¸ª OSD æˆ– MDS ã€æˆ–è€…åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…é‡å¯äº†å¤šä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒä»¬ä¼šç»‘å®šæ›´é«˜çš„ç«¯å£å·ï¼›æ‰€ä»¥è¯´ä½ åº”è¯¥é¢„å…ˆæ‰“å¼€æ•´ä¸ª 6800-7300 ç«¯å£åŒºé—´ã€‚æŒ‰ä¸‹ä¾‹å¢åŠ è§„åˆ™æ—¶ï¼Œè¦æŠŠ <code>&#123;iface&#125;</code> æ›¿æ¢ä¸ºå…¬å…±ç½‘æ¥å£ï¼ˆå¦‚ <code>eth0</code> ã€ <code>eth1</code> ç­‰ç­‰ï¼‰ã€ <code>&#123;ip-address&#125;</code> æ›¿æ¢ä¸ºå…¬å…±ç½‘ IP ã€ <code>&#123;netmask&#125;</code> æ›¿æ¢ä¸ºå…¬å…±ç½‘æ©ç ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs dust"><span class="xml">sudo iptables -A INPUT -i </span><span class="hljs-template-variable">&#123;iface&#125;</span><span class="xml"> -m multiport -p tcp -s </span><span class="hljs-template-variable">&#123;ip-address&#125;</span><span class="xml">/</span><span class="hljs-template-variable">&#123;netmask&#125;</span><span class="xml"> --dports 6800:7300 -j ACCEPT</span></code></pre>
<h3 id="OSD-é˜²ç«å¢™"><a href="#OSD-é˜²ç«å¢™" class="headerlink" title="OSD é˜²ç«å¢™"></a>OSD é˜²ç«å¢™</h3><p>OSD å®ˆæŠ¤è¿›ç¨‹é»˜è®¤<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/network-config-ref/#id10">ç»‘å®š</a> ä» 6800 èµ·çš„ç¬¬ä¸€ä¸ªå¯ç”¨ç«¯å£ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œå¤šä¸ª OSD æˆ– MDS ã€æˆ–è€…åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…é‡å¯äº†å¤šä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒä»¬ä¼šç»‘å®šæ›´é«˜çš„ç«¯å£å·ã€‚ä¸€ä¸»æœºä¸Šçš„å„ä¸ª OSD æœ€å¤šä¼šç”¨åˆ° 4 ä¸ªç«¯å£ï¼š</p>
<ol>
<li>ä¸€ä¸ªç”¨äºå’Œå®¢æˆ·ç«¯ã€ç›‘è§†å™¨é€šè®¯ï¼›</li>
<li>ä¸€ä¸ªç”¨äºå‘é€æ•°æ®åˆ°å…¶ä»– OSD ï¼›</li>
<li>ä¸¤ä¸ªç”¨äºå„ä¸ªç½‘å¡ä¸Šçš„å¿ƒè·³ï¼›</li>
</ol>
<p><img src="\img\ceph-firewall.png" srcset="/img/loading.gif" alt="img"></p>
<p>å½“æŸä¸ªå®ˆæŠ¤è¿›ç¨‹å¤±è´¥å¹¶é‡å¯æ—¶æ²¡é‡Šæ”¾ç«¯å£ï¼Œé‡å¯åçš„è¿›ç¨‹å°±ä¼šç›‘å¬æ–°ç«¯å£ã€‚ä½ åº”è¯¥æ‰“å¼€æ•´ä¸ª 6800-7300 ç«¯å£åŒºé—´ï¼Œä»¥åº”å¯¹è¿™ç§å¯èƒ½æ€§ã€‚</p>
<p>å¦‚æœä½ åˆ†å¼€äº†å…¬å…±ç½‘å’Œé›†ç¾¤ç½‘ï¼Œå¿…é¡»åˆ†åˆ«ä¸ºä¹‹è®¾ç½®é˜²ç«å¢™ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¼šé€šè¿‡å…¬å…±ç½‘è¿æ¥ã€è€Œå…¶ä»– OSD ä¼šé€šè¿‡é›†ç¾¤ç½‘è¿æ¥ã€‚æŒ‰ä¸‹ä¾‹å¢åŠ è§„åˆ™æ—¶ï¼Œè¦æŠŠ <code>&#123;iface&#125;</code> æ›¿æ¢ä¸ºç½‘å£ï¼ˆå¦‚ <code>eth0</code> ã€ <code>eth1</code> ç­‰ç­‰ï¼‰ã€ <code>&#123;ip-address&#125;</code> æ›¿æ¢ä¸ºå…¬å…±ç½‘æˆ–é›†ç¾¤ç½‘ IP ã€ <code>&#123;netmask&#125;</code> æ›¿æ¢ä¸ºå…¬å…±ç½‘æˆ–é›†ç¾¤ç½‘æ©ç ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs dust"><span class="xml">sudo iptables -A INPUT -i </span><span class="hljs-template-variable">&#123;iface&#125;</span><span class="xml">  -m multiport -p tcp -s </span><span class="hljs-template-variable">&#123;ip-address&#125;</span><span class="xml">/</span><span class="hljs-template-variable">&#123;netmask&#125;</span><span class="xml"> --dports 6800:7300 -j ACCEPT</span></code></pre>
<div class="note note-primary">
            <p>å¦‚æœä½ çš„å…ƒæ•°æ®æœåŠ¡å™¨å’Œ OSD åœ¨åŒä¸€èŠ‚ç‚¹ä¸Šï¼Œå¯ä»¥åˆå¹¶å…¬å…±ç½‘é…ç½®ã€‚</p>
          </div>
<h2 id="CEPH-ç½‘ç»œ"><a href="#CEPH-ç½‘ç»œ" class="headerlink" title="CEPH ç½‘ç»œ"></a>CEPH ç½‘ç»œ</h2><p>Ceph çš„ç½‘ç»œé…ç½®è¦æ”¾åˆ° <code>[global]</code> æ®µä¸‹ã€‚å‰è¿°çš„ 5 åˆ†é’Ÿå¿«é€Ÿå…¥é—¨æä¾›äº†ä¸€ä¸ªç®€é™‹çš„ <a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/start/quick-ceph-deploy/#create-a-cluster">Ceph é…ç½®æ–‡ä»¶</a>ï¼Œå®ƒå‡è®¾æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½ä½äºåŒä¸€ç½‘æ®µï¼Œ Ceph å¯ä»¥å¾ˆå¥½åœ°é€‚åº”è¿™ç§æƒ…å½¢ã€‚ç„¶è€Œ Ceph å…è®¸é…ç½®æ›´ç²¾ç»†çš„å…¬å…±ç½‘ï¼ŒåŒ…æ‹¬å¤š IP å’Œå¤šæ©ç ï¼›ä¹Ÿèƒ½ç”¨å•ç‹¬çš„é›†ç¾¤ç½‘å¤„ç† OSD å¿ƒè·³ã€å¯¹è±¡å¤åˆ¶ã€å’Œæ¢å¤æµé‡ã€‚ä¸è¦æ··æ·†ä½ é…ç½®çš„ IP åœ°å€å’Œå®¢æˆ·ç«¯ç”¨æ¥è®¿é—®å­˜å‚¨æœåŠ¡çš„å…¬å…±ç½‘åœ°å€ã€‚å…¸å‹çš„å†…ç½‘å¸¸å¸¸æ˜¯ <code>192.168.0.0</code> æˆ– <code>10.0.0.0</code> ã€‚</p>
 <div class="note note-primary">
            <p>å¦‚æœä½ ç»™å…¬å…±ç½‘æˆ–é›†ç¾¤ç½‘é…ç½®äº†å¤šä¸ª IP åœ°å€åŠå­ç½‘æ©ç ï¼Œè¿™äº›å­ç½‘å¿…é¡»èƒ½äº’é€šã€‚å¦å¤–è¦ç¡®ä¿åœ¨é˜²ç«å¢™ä¸Šä¸ºå„ IP å’Œå­ç½‘å¼€æ”¾äº†å¿…è¦çš„ç«¯å£ã€‚</p><p>Ceph ç”¨ CIDR æ³•è¡¨ç¤ºå­ç½‘(IPåœ°å€/ç½‘ç»œIDçš„ä½æ•°)ï¼Œå¦‚ <code>10.0.0.0/24</code> ã€‚</p>
          </div>
<p>é…ç½®å®Œå‡ ä¸ªç½‘ç»œåï¼Œå¯ä»¥é‡å¯é›†ç¾¤æˆ–æŒ¨ä¸ªé‡å¯å®ˆæŠ¤è¿›ç¨‹ã€‚ Ceph å®ˆæŠ¤è¿›ç¨‹åŠ¨æ€åœ°ç»‘å®šç«¯å£ï¼Œæ‰€ä»¥æ›´æ”¹ç½‘ç»œé…ç½®åæ— éœ€é‡å¯æ•´ä¸ªé›†ç¾¤ã€‚</p>
<h3 id="å…¬å…±ç½‘"><a href="#å…¬å…±ç½‘" class="headerlink" title="å…¬å…±ç½‘"></a>å…¬å…±ç½‘</h3><p>è¦é…ç½®ä¸€ä¸ªå…¬å…±ç½‘ï¼ŒæŠŠä¸‹åˆ—é€‰é¡¹åŠ åˆ°é…ç½®æ–‡ä»¶çš„ <code>[global]</code> æ®µä¸‹ã€‚</p>
<pre><code class="hljs routeros">[global]
        <span class="hljs-built_in">..</span>.
        public<span class="hljs-built_in"> network </span>= &#123;public-network/netmask&#125;</code></pre>
<h3 id="é›†ç¾¤ç½‘"><a href="#é›†ç¾¤ç½‘" class="headerlink" title="é›†ç¾¤ç½‘"></a>é›†ç¾¤ç½‘</h3><p>å¦‚æœä½ å£°æ˜äº†é›†ç¾¤ç½‘ï¼Œ OSD å°†æŠŠå¿ƒè·³ã€å¯¹è±¡å¤åˆ¶å’Œæ¢å¤æµé‡è·¯ç”±åˆ°é›†ç¾¤ç½‘ï¼Œä¸å•ä¸ªç½‘ç»œç›¸æ¯”è¿™ä¼šæå‡æ€§èƒ½ã€‚è¦é…ç½®é›†ç¾¤ç½‘ï¼ŒæŠŠä¸‹åˆ—é€‰é¡¹åŠ è¿›é…ç½®æ–‡ä»¶çš„ <code>[global]</code> æ®µã€‚</p>
<pre><code class="hljs routeros">[global]
        <span class="hljs-built_in">..</span>.
        cluster<span class="hljs-built_in"> network </span>= &#123;cluster-network/netmask&#125;</code></pre>
<p>ä¸ºå®‰å…¨èµ·è§ï¼Œä»å…¬å…±ç½‘æˆ–äº’è”ç½‘åˆ°é›†ç¾¤ç½‘åº”è¯¥æ˜¯<strong>ä¸å¯è¾¾</strong>çš„ã€‚</p>
<h2 id="CEPH-å®ˆæŠ¤è¿›ç¨‹"><a href="#CEPH-å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="CEPH å®ˆæŠ¤è¿›ç¨‹"></a>CEPH å®ˆæŠ¤è¿›ç¨‹</h2><p>æœ‰ä¸€ä¸ªç½‘ç»œé…ç½®æ˜¯æ‰€æœ‰å®ˆæŠ¤è¿›ç¨‹éƒ½è¦é…çš„ï¼šå„ä¸ªå®ˆæŠ¤è¿›ç¨‹éƒ½<strong>å¿…é¡»</strong>æŒ‡å®š <code>host</code> ï¼Œ Ceph ä¹Ÿè¦æ±‚æŒ‡å®šç›‘è§†å™¨ IP åœ°å€åŠç«¯å£ã€‚</p>
<div class="note note-danger">
            <p>ä¸€äº›éƒ¨ç½²å·¥å…·ï¼ˆå¦‚ <code>ceph-deploy</code> ã€ Chef ï¼‰ä¼šç»™ä½ åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œå¦‚æœå®ƒèƒ½èƒœä»»é‚£å°±<strong>åˆ«è®¾ç½®</strong>è¿™äº›å€¼ã€‚</p>
          </div>
<div class="note note-primary">
            <p><code>host</code> é€‰é¡¹æ˜¯ä¸»æœºçš„çŸ­åï¼Œä¸æ˜¯å…¨èµ„åŸŸå FQDN ï¼Œä¹Ÿ<strong>ä¸æ˜¯</strong> IP åœ°å€ã€‚åœ¨å‘½ä»¤è¡Œä¸‹è¾“å…¥ <code>hostname -s</code> è·å–ä¸»æœºåã€‚</p>
          </div>
<pre><code class="hljs dust"><span class="xml">[mon.a]</span>

<span class="xml">        host = </span><span class="hljs-template-variable">&#123;hostname&#125;</span>
<span class="xml">        mon addr = </span><span class="hljs-template-variable">&#123;ip-address&#125;</span><span class="xml">:6789</span>

<span class="xml">[osd.0]</span>
<span class="xml">        host = </span><span class="hljs-template-variable">&#123;hostname&#125;</span></code></pre>
<p>å¹¶éä¸€å®šè¦ç»™å®ˆæŠ¤è¿›ç¨‹è®¾ç½® IP åœ°å€ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªé™æ€é…ç½®ï¼Œä¸”åˆ†ç¦»äº†å…¬å…±ç½‘å’Œé›†ç¾¤ç½‘ï¼Œ Ceph å…è®¸ä½ åœ¨é…ç½®æ–‡ä»¶é‡ŒæŒ‡å®šä¸»æœºçš„ IP åœ°å€ã€‚è¦ç»™å®ˆæŠ¤è¿›ç¨‹è®¾ç½®é™æ€ IP ï¼Œå¯æŠŠä¸‹åˆ—é€‰é¡¹åŠ åˆ° <code>ceph.conf</code> ã€‚</p>
<pre><code class="hljs armasm">[osd.<span class="hljs-number">0</span>]
        public <span class="hljs-keyword">addr</span> = &#123;host-public-<span class="hljs-built_in">ip</span>-address&#125;
        cluster <span class="hljs-keyword">addr</span> = &#123;host-cluster-<span class="hljs-built_in">ip</span>-address&#125;</code></pre>
<blockquote>
<p>å•ç½‘å¡OSDã€åŒç½‘ç»œé›†ç¾¤</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸å»ºè®®ç”¨å•ç½‘å¡ OSD ä¸»æœºéƒ¨ç½²ä¸¤ä¸ªç½‘ç»œã€‚ç„¶è€Œè¿™äº‹å¯ä»¥å®ç°ï¼ŒæŠŠ <code>public addr</code> é€‰é¡¹é…åœ¨ <code>[osd.n]</code> æ®µä¸‹å³å¯å¼ºåˆ¶ OSD ä¸»æœºè¿è¡Œåœ¨å…¬å…±ç½‘ï¼Œå…¶ä¸­ <code>n</code> æ˜¯å…¶ OSD å·ã€‚å¦å¤–ï¼Œå…¬å…±ç½‘å’Œé›†ç¾¤ç½‘å¿…é¡»äº’é€šï¼Œè€ƒè™‘åˆ°å®‰å…¨å› ç´ æˆ‘ä»¬ä¸å»ºè®®è¿™æ ·åšã€‚</p>
</blockquote>
<h2 id="ç½‘ç»œé…ç½®é€‰é¡¹"><a href="#ç½‘ç»œé…ç½®é€‰é¡¹" class="headerlink" title="ç½‘ç»œé…ç½®é€‰é¡¹"></a>ç½‘ç»œé…ç½®é€‰é¡¹</h2><p>ç½‘ç»œé…ç½®é€‰é¡¹ä¸æ˜¯å¿…éœ€çš„ï¼Œ Ceph å‡è®¾æ‰€æœ‰ä¸»æœºéƒ½è¿è¡Œäºå…¬å…±ç½‘ï¼Œé™¤éä½ ç‰¹æ„é…ç½®äº†ä¸€ä¸ªé›†ç¾¤ç½‘ã€‚</p>
<h3 id="å…¬å…±ç½‘-1"><a href="#å…¬å…±ç½‘-1" class="headerlink" title="å…¬å…±ç½‘"></a>å…¬å…±ç½‘</h3><p>å…¬å…±ç½‘é…ç½®ç”¨äºæ˜ç¡®åœ°ä¸ºå…¬å…±ç½‘å®šä¹‰ IP åœ°å€å’Œå­ç½‘ã€‚ä½ å¯ä»¥åˆ†é…é™æ€ IP æˆ–ç”¨ <code>public addr</code> è¦†ç›– <code>public network</code> é€‰é¡¹ã€‚</p>
<p>public network</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>å…¬å…±ç½‘ï¼ˆå‰ç«¯ï¼‰çš„ IP åœ°å€å’Œæ©ç ï¼ˆå¦‚ <code>192.168.0.0/24</code> ï¼‰ï¼Œç½®äº <code>[global]</code> ä¸‹ã€‚å¤šä¸ªå­ç½‘ç”¨é€—å·åˆ†éš”ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td><code>&#123;ip-address&#125;/&#123;netmask&#125; [, &#123;ip-address&#125;/&#123;netmask&#125;]</code></td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>No</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</div>
<p>public addr</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>ç”¨äºå…¬å…±ç½‘ï¼ˆå‰ç«¯ï¼‰çš„ IP åœ°å€ã€‚é€‚ç”¨äºå„å®ˆæŠ¤è¿›ç¨‹ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td>IP åœ°å€</td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>No</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</div>
<h3 id="é›†ç¾¤ç½‘-1"><a href="#é›†ç¾¤ç½‘-1" class="headerlink" title="é›†ç¾¤ç½‘"></a>é›†ç¾¤ç½‘</h3><p>é›†ç¾¤ç½‘é…ç½®ç”¨æ¥å£°æ˜ä¸€ä¸ªé›†ç¾¤ç½‘ï¼Œå¹¶æ˜ç¡®åœ°å®šä¹‰å…¶ IP åœ°å€å’Œå­ç½‘ã€‚ä½ å¯ä»¥é…ç½®é™æ€ IP æˆ–ä¸ºæŸ OSD å®ˆæŠ¤è¿›ç¨‹é…ç½® <code>cluster addr</code> ä»¥è¦†ç›– <code>cluster network</code> é€‰é¡¹ã€‚</p>
<p>cluster network</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>é›†ç¾¤ç½‘ï¼ˆåç«¯ï¼‰çš„ IP åœ°å€åŠæ©ç ï¼ˆå¦‚ <code>10.0.0.0/24</code> ï¼‰ï¼Œç½®äº <code>[global]</code> ä¸‹ã€‚å¤šä¸ªå­ç½‘ç”¨é€—å·åˆ†éš”ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td><code>&#123;ip-address&#125;/&#123;netmask&#125; [, &#123;ip-address&#125;/&#123;netmask&#125;]</code></td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>No</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</div>
<p>cluster addr</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>é›†ç¾¤ç½‘ï¼ˆåç«¯ï¼‰ IP åœ°å€ã€‚ç½®äºå„å®ˆæŠ¤è¿›ç¨‹ä¸‹ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td>Address</td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>No</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</div>
<h3 id="ç»‘å®š"><a href="#ç»‘å®š" class="headerlink" title="ç»‘å®š"></a>ç»‘å®š</h3><p>ç»‘å®šé€‰é¡¹ç”¨äºè®¾ç½® OSD å’Œ MDS é»˜è®¤ä½¿ç”¨çš„ç«¯å£èŒƒå›´ï¼Œé»˜è®¤èŒƒå›´æ˜¯ <code>6800:7300</code> ã€‚ç¡®ä¿<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/network-config-ref/#id2">é˜²ç«å¢™</a>å¼€æ”¾äº†å¯¹åº”ç«¯å£èŒƒå›´ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥è®© Ceph å®ˆæŠ¤è¿›ç¨‹ç»‘å®šåˆ° IPv6 åœ°å€ã€‚</p>
<p>ms bind port min</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>OSD æˆ– MDS å¯ç»‘å®šçš„æœ€å°ç«¯å£å·ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td>32-bit Integer</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td><code>6800</code></td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
<p>ms bind port max</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>OSD æˆ– MDS å¯ç»‘å®šçš„æœ€å¤§ç«¯å£å·ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td>32-bit Integer</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td><code>7300</code></td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>No.</td>
</tr>
</tbody>
</table>
</div>
<p>ms bind ipv6</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>å…è®¸ Ceph å®ˆæŠ¤è¿›ç¨‹ç»‘å®š IPv6 åœ°å€ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td>Boolean</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td><code>false</code></td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
<h3 id="ä¸»æœº"><a href="#ä¸»æœº" class="headerlink" title="ä¸»æœº"></a>ä¸»æœº</h3><p>Ceph é…ç½®æ–‡ä»¶é‡Œè‡³å°‘è¦å†™ä¸€ä¸ªç›‘è§†å™¨ã€ä¸”æ¯ä¸ªç›‘è§†å™¨ä¸‹éƒ½è¦é…ç½® <code>mon addr</code> é€‰é¡¹ï¼›æ¯ä¸ªç›‘è§†å™¨ã€å…ƒæ•°æ®æœåŠ¡å™¨å’Œ OSD ä¸‹éƒ½è¦é… <code>host</code> é€‰é¡¹ã€‚</p>
<p>mon addr</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th><code>&#123;hostname&#125;:&#123;port&#125;</code> æ¡ç›®åˆ—è¡¨ï¼Œç”¨ä»¥è®©å®¢æˆ·ç«¯è¿æ¥ Ceph ç›‘è§†å™¨ã€‚å¦‚æœæœªè®¾ç½®ï¼Œ Ceph æŸ¥æ‰¾ <code>[mon.*]</code> æ®µã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td>String</td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>No</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</div>
<p>host</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>ä¸»æœºåã€‚æ­¤é€‰é¡¹ç”¨äºç‰¹å®šå®ˆæŠ¤è¿›ç¨‹ï¼Œå¦‚ <code>[osd.0]</code> ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td>String</td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>Yes, for daemon instances.</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td><code>localhost</code></td>
</tr>
</tbody>
</table>
</div>
<p>ä¸è¦ç”¨ <code>localhost</code> ã€‚åœ¨å‘½ä»¤è¡Œä¸‹æ‰§è¡Œ <code>hostname -s</code> è·å–ä¸»æœºåï¼ˆåˆ°ç¬¬ä¸€ä¸ªç‚¹ï¼Œä¸æ˜¯å…¨èµ„åŸŸåï¼‰ï¼Œå¹¶ç”¨äºé…ç½®æ–‡ä»¶ã€‚</p>
<h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><p>Ceph é»˜è®¤ç¦ç”¨ TCP ç¼“å†²ã€‚</p>
<p>ms tcp nodelay</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>Ceph ç”¨ <code>ms tcp nodelay</code> ä½¿ç³»ç»Ÿå°½å¿«ï¼ˆä¸ç¼“å†²ï¼‰å‘é€æ¯ä¸ªè¯·æ±‚ã€‚ç¦ç”¨ <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Nagle&#39;s_algorithm">Nagle ç®—æ³•</a>å¯å¢åŠ ååé‡ï¼Œä½†ä¼šå¼•è¿›å»¶æ—¶ã€‚å¦‚æœä½ é‡åˆ°å¤§é‡å°åŒ…ï¼Œå¯ä»¥ç¦ç”¨ <code>ms tcp nodelay</code> è¯•è¯•ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td>Boolean</td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>No</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td><code>true</code></td>
</tr>
</tbody>
</table>
</div>
<p>ms tcp rcvbuf</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>ç½‘ç»œå¥—æ¥å­—æ¥æ”¶ç¼“å†²å°ºå¯¸ï¼Œé»˜è®¤ç¦ç”¨ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td>32-bit Integer</td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>No</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
</div>
<p>ms tcp read timeout</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">æè¿°:</th>
<th>å¦‚æœä¸€å®¢æˆ·ç«¯æˆ–å®ˆæŠ¤è¿›ç¨‹å‘é€è¯·æ±‚åˆ°å¦ä¸€ä¸ª Ceph å®ˆæŠ¤è¿›ç¨‹ï¼Œä¸”æ²¡æœ‰æ–­å¼€ä¸å†ä½¿ç”¨çš„è¿æ¥ï¼Œåœ¨ <code>ms tcp read timeout</code> æŒ‡å®šçš„ç§’æ•°ä¹‹åå®ƒå°†è¢«æ ‡è®°ä¸ºç©ºé—²ã€‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç±»å‹:</td>
<td>Unsigned 64-bit Integer</td>
</tr>
<tr>
<td style="text-align:left">æ˜¯å¦å¿…éœ€:</td>
<td>No</td>
</tr>
<tr>
<td style="text-align:left">é»˜è®¤å€¼:</td>
<td><code>900</code> 15 minutes.</td>
</tr>
</tbody>
</table>
</div>
<h2 id="è®¤è¯é€‰é¡¹"><a href="#è®¤è¯é€‰é¡¹" class="headerlink" title="è®¤è¯é€‰é¡¹"></a>è®¤è¯é€‰é¡¹</h2><p><code>cephx</code> åè®®å·²é»˜è®¤å¼€å¯ã€‚åŠ å¯†è®¤è¯è¦è€—è´¹ä¸€å®šè®¡ç®—èµ„æºï¼Œä½†é€šå¸¸å¾ˆä½ã€‚å¦‚æœæ‚¨çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç½‘ç»œç¯å¢ƒç›¸å½“å®‰å…¨ï¼Œè€Œä¸”è®¤è¯çš„è´Ÿé¢æ•ˆåº”æ›´å¤§ï¼Œä½ å¯ä»¥å…³é—­å®ƒï¼Œ<strong>é€šå¸¸ä¸æ¨èæ‚¨è¿™ä¹ˆåš</strong>ã€‚</p>
<p>ä½¿ç”¨ceph-deployä¼šè‡ªåŠ¨åˆ›å»ºè®¤è¯ä¿¡æ¯ï¼š</p>
<pre><code class="hljs ini"><span class="hljs-attr">auth_cluster_required</span> = cephx
<span class="hljs-attr">auth_service_required</span> = cephx
<span class="hljs-attr">auth_client_required</span> = cephx</code></pre>
<p>å½“æ‰§è¡Œ<code>ceph-deploy mon create-initial</code>ï¼Œcephä¼šå¼•å¯¼åˆå§‹ç›‘è§†å™¨ï¼Œè¿”å›ä¸€ä¸ª<code>ceph.client.admin.keyring</code>æ–‡ä»¶ã€‚</p>
<p>å½“æ‰§è¡Œ <code>ceph-deploy admin &#123;node-name&#125;</code>ï¼Œä½ ç›¸å½“äºæŠŠ<code>ceph.client.admin.keyring</code>æ–‡ä»¶æ”¾åœ¨èŠ‚ç‚¹çš„/etc/cephç›®å½•ä¸‹ã€‚</p>
<h3 id="å¯ç”¨-CEPHX"><a href="#å¯ç”¨-CEPHX" class="headerlink" title="å¯ç”¨ CEPHX"></a>å¯ç”¨ CEPHX</h3><p>å¯ç”¨ <code>cephx</code> åï¼Œ Ceph å°†åœ¨é»˜è®¤æœç´¢è·¯å¾„ï¼ˆåŒ…æ‹¬ <code>/etc/ceph/ceph.$name.keyring</code> ï¼‰é‡ŒæŸ¥æ‰¾å¯†é’¥ç¯ã€‚ä½ å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/ceph-conf">Ceph é…ç½®</a>æ–‡ä»¶çš„ <code>[global]</code> æ®µé‡Œæ·»åŠ  <code>keyring</code> é€‰é¡¹æ¥ä¿®æ”¹ï¼Œä½†ä¸æ¨èã€‚</p>
<p>åœ¨ç¦ç”¨äº† <code>cephx</code> çš„é›†ç¾¤ä¸Šæ‰§è¡Œä¸‹é¢çš„æ­¥éª¤æ¥å¯ç”¨å®ƒï¼Œå¦‚æœä½ ï¼ˆæˆ–è€…éƒ¨ç½²å·¥å…·ï¼‰å·²ç»ç”Ÿæˆäº†å¯†é’¥ï¼Œä½ å¯ä»¥è·³è¿‡ç›¸å…³æ­¥éª¤ã€‚</p>
<ol>
<li><p>åˆ›å»º <code>client.admin</code> å¯†é’¥ï¼Œå¹¶ä¸ºå®¢æˆ·ç«¯ä¿å­˜æ­¤å¯†é’¥çš„å‰¯æœ¬ï¼š</p>
<pre><code class="hljs dsconfig"><span class="hljs-string">ceph </span><span class="hljs-string">auth </span><span class="hljs-built_in">get-or-create</span> <span class="hljs-string">client.</span><span class="hljs-string">admin </span><span class="hljs-string">mon </span><span class="hljs-string">&#x27;allow *&#x27;</span> <span class="hljs-string">mds </span><span class="hljs-string">&#x27;allow *&#x27;</span> <span class="hljs-string">osd </span><span class="hljs-string">&#x27;allow *&#x27;</span> -o /<span class="hljs-string">etc/</span><span class="hljs-string">ceph/</span><span class="hljs-string">ceph.</span><span class="hljs-string">client.</span><span class="hljs-string">admin.</span><span class="hljs-string">keyring</span></code></pre>
<div class="note note-danger">
            <p><strong>è­¦å‘Šï¼š</strong> æ­¤å‘½ä»¤ä¼šè¦†ç›–ä»»ä½•å­˜åœ¨çš„ <code>/etc/ceph/client.admin.keyring</code> æ–‡ä»¶ï¼Œå¦‚æœéƒ¨ç½²å·¥å…·å·²ç»å®Œæˆæ­¤æ­¥éª¤ï¼Œåƒä¸‡åˆ«å†æ‰§è¡Œæ­¤å‘½ä»¤ã€‚å¤šåŠ å°å¿ƒï¼</p>
          </div>
</li>
<li><p>åˆ›å»ºç›‘è§†å™¨é›†ç¾¤æ‰€éœ€çš„å¯†é’¥ç¯ã€å¹¶ç»™å®ƒä»¬ç”Ÿæˆå¯†é’¥ã€‚</p>
<pre><code class="hljs dsconfig"><span class="hljs-string">ceph-authtool </span><span class="hljs-built_in">--create-keyring</span> /<span class="hljs-string">tmp/</span><span class="hljs-string">ceph.</span><span class="hljs-string">mon.</span><span class="hljs-string">keyring </span><span class="hljs-built_in">--gen-key</span> -n <span class="hljs-string">mon.</span> <span class="hljs-built_in">--cap</span> <span class="hljs-string">mon </span><span class="hljs-string">&#x27;allow *&#x27;</span></code></pre>
</li>
<li><p>æŠŠç›‘è§†å™¨å¯†é’¥ç¯å¤åˆ¶åˆ° <code>ceph.mon.keyring</code> æ–‡ä»¶ï¼Œå†æŠŠæ­¤æ–‡ä»¶å¤åˆ¶åˆ°å„ç›‘è§†å™¨çš„ <code>mon data</code> ç›®å½•ä¸‹ã€‚æ¯”å¦‚è¦æŠŠå®ƒå¤åˆ¶ç»™åä¸º <code>ceph</code> é›†ç¾¤çš„ <code>mon.a</code> ï¼Œç”¨æ­¤å‘½ä»¤ï¼š</p>
<pre><code class="hljs crystal">cp /tmp/ceph.mon.keyring /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/<span class="hljs-title">mon</span>/<span class="hljs-title">ceph</span>-<span class="hljs-title">a</span>/<span class="hljs-title">keyring</span></span></code></pre>
</li>
<li><p>ä¸ºæ¯ä¸ª OSD ç”Ÿæˆå¯†é’¥ï¼Œ <code>&#123;$id&#125;</code> æ˜¯ OSD ç¼–å·ï¼š</p>
<pre><code class="hljs dsconfig"><span class="hljs-string">ceph </span><span class="hljs-string">auth </span><span class="hljs-built_in">get-or-create</span> <span class="hljs-string">osd.</span>&#123;$<span class="hljs-string">id&#125;</span> <span class="hljs-string">mon </span><span class="hljs-string">&#x27;allow rwx&#x27;</span> <span class="hljs-string">osd </span><span class="hljs-string">&#x27;allow *&#x27;</span> -o /<span class="hljs-string">var/</span><span class="hljs-string">lib/</span><span class="hljs-string">ceph/</span><span class="hljs-string">osd/</span><span class="hljs-string">ceph-</span>&#123;$<span class="hljs-string">id&#125;</span>/<span class="hljs-string">keyring</span></code></pre>
</li>
<li><p>ä¸ºæ¯ä¸ª MDS ç”Ÿæˆå¯†é’¥ï¼Œ <code>&#123;$id&#125;</code> æ˜¯ MDS çš„æ ‡è¯†å­—æ¯ï¼š</p>
<pre><code class="hljs dsconfig"><span class="hljs-string">ceph </span><span class="hljs-string">auth </span><span class="hljs-built_in">get-or-create</span> <span class="hljs-string">mds.</span>&#123;$<span class="hljs-string">id&#125;</span> <span class="hljs-string">mon </span><span class="hljs-string">&#x27;allow rwx&#x27;</span> <span class="hljs-string">osd </span><span class="hljs-string">&#x27;allow *&#x27;</span> <span class="hljs-string">mds </span><span class="hljs-string">&#x27;allow *&#x27;</span> -o /<span class="hljs-string">var/</span><span class="hljs-string">lib/</span><span class="hljs-string">ceph/</span><span class="hljs-string">mds/</span><span class="hljs-string">ceph-</span>&#123;$<span class="hljs-string">id&#125;</span>/<span class="hljs-string">keyring</span></code></pre>
</li>
<li><p>æŠŠä»¥ä¸‹é…ç½®åŠ å…¥ <a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/ceph-conf">Ceph é…ç½®</a>æ–‡ä»¶çš„ <code>[global]</code> æ®µä¸‹ä»¥å¯ç”¨ <code>cephx</code> è®¤è¯ï¼š</p>
<pre><code class="hljs routeros">auth cluster required = cephx
auth<span class="hljs-built_in"> service </span>required = cephx
auth<span class="hljs-built_in"> client </span>required = cephx</code></pre>
</li>
<li><p>å¯åŠ¨æˆ–é‡å¯ Ceph é›†ç¾¤ï¼Œè¯¦æƒ…è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/operations/operating">æ“çºµé›†ç¾¤</a>ã€‚</p>
</li>
</ol>
<h3 id="ç¦ç”¨-CEPHX"><a href="#ç¦ç”¨-CEPHX" class="headerlink" title="ç¦ç”¨ CEPHX"></a>ç¦ç”¨ CEPHX</h3><p>ä¸‹è¿°æ­¥éª¤æè¿°äº†å¦‚ä½•ç¦ç”¨ Cephx ã€‚å¦‚æœä½ çš„é›†ç¾¤ç¯å¢ƒç›¸å¯¹å®‰å…¨ï¼Œä½ å¯ä»¥å‡å…è®¤è¯è€—è´¹çš„è®¡ç®—èµ„æºï¼Œç„¶è€Œ<strong>æˆ‘ä»¬ä¸æ¨è</strong>ã€‚ä½†æ˜¯ä¸´æ—¶ç¦ç”¨è®¤è¯ä¼šä½¿å®‰è£…ã€å’Œ/æˆ–æ’éšœæ›´ç®€å•ã€‚</p>
<ol>
<li><p>æŠŠä¸‹åˆ—é…ç½®åŠ å…¥ <a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/ceph-conf">Ceph é…ç½®</a>æ–‡ä»¶çš„ <code>[global]</code> æ®µä¸‹å³å¯ç¦ç”¨ <code>cephx</code> è®¤è¯ï¼š</p>
<pre><code class="hljs routeros">auth cluster required = none
auth<span class="hljs-built_in"> service </span>required = none
auth<span class="hljs-built_in"> client </span>required = none</code></pre>
</li>
<li><p>å¯åŠ¨æˆ–é‡å¯ Ceph é›†ç¾¤ï¼Œå…·ä½“å‚è€ƒ<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/operations/operating">æ“çºµé›†ç¾¤</a>ã€‚</p>
</li>
</ol>
<h3 id="å¯†é’¥"><a href="#å¯†é’¥" class="headerlink" title="å¯†é’¥"></a>å¯†é’¥</h3><p>å¦‚æœä½ çš„é›†ç¾¤å¯ç”¨äº†è®¤è¯ï¼Œ <code>ceph</code> ç®¡ç†å‘½ä»¤å’Œå®¢æˆ·ç«¯å¾—æœ‰å¯†é’¥æ‰èƒ½è®¿é—®é›†ç¾¤ã€‚</p>
<p>ç»™ <code>ceph</code> ç®¡ç†å‘½ä»¤å’Œå®¢æˆ·ç«¯æä¾›å¯†é’¥çš„æœ€å¸¸ç”¨æ–¹æ³•å°±æ˜¯æŠŠå¯†é’¥ç¯æ”¾åˆ° <code>/etc/ceph</code> ï¼Œé€šè¿‡ <code>ceph-deploy</code> éƒ¨ç½²çš„ Cuttlefish åŠæ›´é«˜ç‰ˆæœ¬ï¼Œå…¶æ–‡ä»¶åé€šå¸¸æ˜¯ <code>ceph.client.admin.keyring</code> ï¼ˆæˆ– <code>$cluster.client.admin.keyring</code> ï¼‰ã€‚å¦‚æœä½ çš„å¯†é’¥ç¯ä½äº <code>/etc/ceph</code> ä¸‹ï¼Œå°±ä¸éœ€è¦åœ¨ Ceph é…ç½®æ–‡ä»¶é‡ŒæŒ‡å®š <code>keyring</code> é€‰é¡¹äº†ã€‚</p>
<p>æˆ‘ä»¬å»ºè®®æŠŠé›†ç¾¤çš„å¯†é’¥ç¯å¤åˆ¶åˆ°ä½ æ‰§è¡Œç®¡ç†å‘½ä»¤çš„èŠ‚ç‚¹ï¼Œå®ƒåŒ…å« <code>client.admin</code> å¯†é’¥ã€‚</p>
<p>ä½ å¯ä»¥ç”¨ <code>ceph-deploy admin</code> å‘½ä»¤åšæ­¤äº‹ï¼Œè¯¦æƒ…è§â€™éƒ¨ç½²ç®¡ç†ä¸»æœºâ€™_ï¼Œæ‰‹åŠ¨å¤åˆ¶å¯æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</p>
<pre><code class="hljs roboconf">sudo scp &#123;<span class="hljs-attribute">user&#125;@&#123;ceph-cluster-host&#125;</span>:/etc/ceph/ceph<span class="hljs-variable">.client</span><span class="hljs-variable">.admin</span><span class="hljs-variable">.keyring</span> /etc/ceph/ceph<span class="hljs-variable">.client</span><span class="hljs-variable">.admin</span><span class="hljs-variable">.keyring</span></code></pre>
<div class="note note-primary">
            <p>ç¡®ä¿ç»™å®¢æˆ·ç«¯ä¸Šçš„ <code>ceph.keyring</code> è®¾ç½®åˆç†çš„æƒé™ä½ï¼ˆå¦‚ <code>chmod 644</code> ï¼‰</p>
          </div>
<p>å®ˆæŠ¤è¿›ç¨‹æ•°æ®ç›®å½•ä½ç½®é»˜è®¤æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs crystal">/var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">ceph</span>/$<span class="hljs-title">type</span>/$<span class="hljs-title">cluster</span>-$<span class="hljs-title">id</span></span></code></pre>
<h2 id="MONITOR-é…ç½®"><a href="#MONITOR-é…ç½®" class="headerlink" title="MONITOR é…ç½®"></a>MONITOR é…ç½®</h2><p><span id ="MONITOR"> è¿™å„¿</span></p>
<p>ç›‘è§†å™¨ä»¬ç»´æŠ¤ç€é›†ç¾¤è¿è¡Œå›¾çš„â€œä¸»å‰¯æœ¬â€ï¼Œå°±æ˜¯è¯´<strong>å®¢æˆ·ç«¯è¿åˆ°ä¸€ä¸ªç›‘è§†å™¨å¹¶è·å–å½“å‰è¿è¡Œå›¾å°±èƒ½ç¡®å®šæ‰€æœ‰ç›‘è§†å™¨ã€ OSD å’Œå…ƒæ•°æ®æœåŠ¡å™¨çš„ä½ç½®</strong>ã€‚ Ceph å®¢æˆ·ç«¯è¯»å†™ OSD æˆ–å…ƒæ•°æ®æœåŠ¡å™¨å‰ï¼Œå¿…é¡»å…ˆè¿åˆ°ä¸€ä¸ªç›‘è§†å™¨ï¼Œé å½“å‰é›†ç¾¤è¿è¡Œå›¾çš„å‰¯æœ¬å’Œ CRUSH ç®—æ³•ï¼Œå®¢æˆ·ç«¯èƒ½è®¡ç®—å‡ºä»»ä½•å¯¹è±¡çš„ä½ç½®ï¼Œæ•…æ­¤å®¢æˆ·ç«¯æœ‰èƒ½åŠ›ç›´æ¥è¿åˆ° OSD ï¼Œè¿™å¯¹ Ceph çš„é«˜ä¼¸ç¼©æ€§ã€é«˜æ€§èƒ½æ¥è¯´éå¸¸é‡è¦ã€‚æ›´å¤šä¿¡æ¯è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/architecture#scalability-and-high-availability">ä¼¸ç¼©æ€§å’Œé«˜å¯ç”¨æ€§</a>ã€‚</p>
<p>ç›‘è§†å™¨çš„ä¸»è¦è§’è‰²æ˜¯ç»´æŠ¤é›†ç¾¤è¿è¡Œå›¾çš„ä¸»å‰¯æœ¬ï¼Œå®ƒä¹Ÿæä¾›<strong>è®¤è¯</strong>å’Œ<strong>æ—¥å¿—è®°å½•</strong>æœåŠ¡ã€‚ Ceph ç›‘è§†å™¨ä»¬æŠŠç›‘è§†å™¨æœåŠ¡çš„æ‰€æœ‰æ›´æ”¹å†™å…¥ä¸€ä¸ªå•ç‹¬çš„ <strong>Paxos</strong> ä¾‹ç¨‹ï¼Œç„¶å Paxos ä»¥é”®/å€¼æ–¹å¼å­˜å‚¨æ‰€æœ‰å˜æ›´ä»¥å®ç°é«˜åº¦ä¸€è‡´æ€§ã€‚åŒæ­¥æœŸé—´ï¼Œ Ceph ç›‘è§†å™¨èƒ½æŸ¥è¯¢é›†ç¾¤è¿è¡Œå›¾çš„è¿‘æœŸç‰ˆæœ¬ï¼Œå®ƒä»¬é€šè¿‡æ“ä½œé”®/å€¼å­˜å‚¨å¿«ç…§å’Œè¿­ä»£å™¨ï¼ˆç”¨ leveldb ï¼‰æ¥è¿›è¡Œå­˜å‚¨çº§åŒæ­¥ã€‚</p>
<p><img src="\img\ceph-mon.png" srcset="/img/loading.gif" alt="img"></p>
<h3 id="é›†ç¾¤è¿è¡Œå›¾"><a href="#é›†ç¾¤è¿è¡Œå›¾" class="headerlink" title="é›†ç¾¤è¿è¡Œå›¾"></a>é›†ç¾¤è¿è¡Œå›¾</h3><p>é›†ç¾¤è¿è¡Œå›¾æ˜¯å¤šä¸ªå›¾çš„ç»„åˆï¼ŒåŒ…æ‹¬ç›‘è§†å™¨å›¾ã€ OSD å›¾ã€å½’ç½®ç»„å›¾å’Œå…ƒæ•°æ®æœåŠ¡å™¨å›¾ã€‚é›†ç¾¤è¿è¡Œå›¾è¿½è¸ªå‡ ä¸ªé‡è¦äº‹ä»¶ï¼šå“ªäº›è¿›ç¨‹åœ¨é›†ç¾¤é‡Œï¼ˆ <code>in</code> ï¼‰ï¼›å“ªäº›è¿›ç¨‹åœ¨é›†ç¾¤é‡Œï¼ˆ <code>in</code> ï¼‰æ˜¯ <code>up</code> ä¸”åœ¨è¿è¡Œã€æˆ– <code>down</code> ï¼›å½’ç½®ç»„çŠ¶æ€æ˜¯ <code>active</code> æˆ– <code>inactive</code> ã€ <code>clean</code> æˆ–å…¶ä»–çŠ¶æ€ï¼›å’Œå…¶ä»–åæ˜ å½“å‰é›†ç¾¤çŠ¶æ€çš„ä¿¡æ¯ï¼Œåƒæ€»å­˜å‚¨å®¹é‡ã€å’Œä½¿ç”¨é‡ã€‚</p>
<p>å½“é›†ç¾¤çŠ¶æ€æœ‰æ˜æ˜¾å˜æ›´æ—¶ï¼Œå¦‚ä¸€ OSD æŒ‚äº†ã€ä¸€å½’ç½®ç»„é™çº§äº†ç­‰ç­‰ï¼Œé›†ç¾¤è¿è¡Œå›¾ä¼šè¢«æ›´æ–°ä»¥åæ˜ é›†ç¾¤å½“å‰çŠ¶æ€ã€‚å¦å¤–ï¼Œç›‘è§†å™¨ä¹Ÿç»´æŠ¤ç€é›†ç¾¤çš„ä¸»è¦çŠ¶æ€å†å²ã€‚ç›‘è§†å™¨å›¾ã€ OSD å›¾ã€å½’ç½®ç»„å›¾å’Œå…ƒæ•°æ®æœåŠ¡å™¨å›¾å„è‡ªç»´æŠ¤ç€å®ƒä»¬çš„è¿è¡Œå›¾ç‰ˆæœ¬ã€‚æˆ‘ä»¬æŠŠå„å›¾çš„ç‰ˆæœ¬ç§°ä¸ºä¸€ä¸ª epoch ã€‚</p>
<p>è¿è¥é›†ç¾¤æ—¶ï¼Œè·Ÿè¸ªè¿™äº›çŠ¶æ€æ˜¯ç³»ç»Ÿç®¡ç†ä»»åŠ¡çš„é‡è¦éƒ¨åˆ†ã€‚è¯¦æƒ…è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/operations/monitoring">ç›‘æ§é›†ç¾¤</a>å’Œ<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/operations/monitoring-osd-pg">ç›‘æ§ OSD å’Œå½’ç½®ç»„</a>ã€‚</p>
<h3 id="ç›‘è§†å™¨æ³•å®šäººæ•°ï¼ˆQuorumï¼‰"><a href="#ç›‘è§†å™¨æ³•å®šäººæ•°ï¼ˆQuorumï¼‰" class="headerlink" title="ç›‘è§†å™¨æ³•å®šäººæ•°ï¼ˆQuorumï¼‰"></a>ç›‘è§†å™¨æ³•å®šäººæ•°ï¼ˆQuorumï¼‰</h3><p>ç®€å•çš„Ceph-deployåªä¼šé…ç½®ä¸€å°monitorï¼Œè€Œè¿™å¾ˆå®¹æ˜“é€ æˆå•ç‚¹æ•…éšœã€‚Cephé‡‡ç”¨<strong>Paxos</strong>æ¥ä¿è¯é›†ç¾¤è¿è¡Œä¸€è‡´æ€§ã€‚è¿™é‡Œçš„ä¸€è‡´è¦æ±‚å¤§å¤šæ•°ç›‘è§†å™¨éƒ½åœ¨è¿è¡Œä¸”å¤Ÿæˆæ³•å®šäººæ•°ï¼ˆå¦‚ 1 ä¸ªã€ 3 ä¹‹ 2 åœ¨è¿è¡Œã€ 5 ä¹‹ 3 ã€ 6 ä¹‹ 4 ç­‰ç­‰ï¼‰ã€‚</p>
<h3 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h3><p>ä½ æŠŠç›‘è§†å™¨åŠ è¿› Ceph é…ç½®æ–‡ä»¶æ—¶ï¼Œå¾—æ³¨æ„ä¸€äº›æ¶æ„é—®é¢˜ï¼Œ Ceph å‘ç°é›†ç¾¤å†…çš„å…¶ä»–ç›‘è§†å™¨æ—¶å¯¹å…¶æœ‰ç€<strong>ä¸¥æ ¼çš„ä¸€è‡´æ€§è¦æ±‚</strong>ã€‚å°½ç®¡å¦‚æ­¤ï¼Œ Ceph å®¢æˆ·ç«¯å’Œå…¶ä»– Ceph å®ˆæŠ¤è¿›ç¨‹ç”¨é…ç½®æ–‡ä»¶å‘ç°ç›‘è§†å™¨ï¼Œç›‘è§†å™¨å´ç”¨ç›‘è§†å™¨å›¾ï¼ˆ monmap ï¼‰ç›¸äº’å‘ç°è€Œéé…ç½®æ–‡ä»¶ã€‚</p>
<p>ä¸€ä¸ªç›‘è§†å™¨å‘ç°é›†ç¾¤å†…çš„å…¶ä»–ç›‘è§†å™¨æ—¶æ€»æ˜¯å‚è€ƒ <strong>monmap</strong> çš„æœ¬åœ°å‰¯æœ¬ï¼Œç”¨ monmap è€Œé Ceph é…ç½®æ–‡ä»¶é¿å…äº†å¯èƒ½æŸåé›†ç¾¤çš„é”™è¯¯ï¼ˆå¦‚ <code>ceph.conf</code> ä¸­æŒ‡å®šåœ°å€æˆ–ç«¯å£çš„æ‹¼å†™é”™è¯¯ï¼‰ã€‚æ­£å› ä¸ºç›‘è§†å™¨æŠŠ monmap ç”¨äºå‘ç°ã€å¹¶å…±äº«äºå®¢æˆ·ç«¯å’Œå…¶ä»– Ceph å®ˆæŠ¤è¿›ç¨‹é—´ï¼Œ <strong>monmapå¯ä¸¥æ ¼åœ°ä¿è¯ç›‘è§†å™¨çš„ä¸€è‡´æ€§æ˜¯å¯é çš„</strong>ã€‚</p>
<p>ä¸¥æ ¼çš„ä¸€è‡´æ€§ä¹Ÿé€‚ç”¨äº monmap çš„æ›´æ–°ï¼Œå› ä¸ºå…³äºç›‘è§†å™¨çš„ä»»ä½•æ›´æ–°ã€å…³äº monmap çš„å˜æ›´éƒ½æ˜¯é€šè¿‡ç§°ä¸º <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Paxos_(computer_science">Paxos</a>) çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ä¼ é€’çš„ã€‚ç›‘è§†å™¨ä»¬å¿…é¡»å°± monmap çš„æ¯æ¬¡æ›´æ–°è¾¾æˆä¸€è‡´ï¼Œä»¥ç¡®ä¿æ³•å®šäººæ•°é‡Œçš„æ¯ä¸ªç›‘è§†å™¨ monmap ç‰ˆæœ¬ç›¸åŒï¼Œå¦‚å¢åŠ ã€åˆ é™¤ä¸€ä¸ªç›‘è§†å™¨ã€‚ monmap çš„æ›´æ–°æ˜¯å¢é‡çš„ï¼Œæ‰€ä»¥ç›‘è§†å™¨ä»¬éƒ½æœ‰æœ€æ–°çš„ä¸€è‡´ç‰ˆæœ¬ï¼Œä»¥åŠä¸€ç³»åˆ—ä¹‹å‰ç‰ˆæœ¬ã€‚å†å²ç‰ˆæœ¬çš„å­˜åœ¨å…è®¸ä¸€ä¸ªè½åçš„ç›‘è§†å™¨è·Ÿä¸Šé›†ç¾¤å½“å‰çŠ¶æ€ã€‚</p>
<h3 id="åˆå§‹åŒ–ç›‘è§†å™¨"><a href="#åˆå§‹åŒ–ç›‘è§†å™¨" class="headerlink" title="åˆå§‹åŒ–ç›‘è§†å™¨"></a>åˆå§‹åŒ–ç›‘è§†å™¨</h3><p>åœ¨å¤§å¤šæ•°é…ç½®å’Œéƒ¨ç½²æ¡ˆä¾‹ä¸­ï¼Œéƒ¨ç½² Ceph çš„å·¥å…·å¯ä»¥å¸®ä½ ç”Ÿæˆä¸€ä¸ªç›‘è§†å™¨å›¾æ¥åˆå§‹åŒ–ç›‘è§†å™¨ï¼ˆå¦‚ <code>ceph-deploy</code> ç­‰ï¼‰ï¼Œä¸€ä¸ªç›‘è§†å™¨éœ€è¦ è‹¥å¹²ä¸ªé€‰é¡¹ï¼š</p>
<p><strong>æƒŸä¸€æ ‡è¯†ç¬¦ï¼š</strong> <code>fsid</code> æ˜¯é›†ç¾¤çš„æƒŸä¸€æ ‡è¯†ï¼Œå®ƒæ˜¯ Ceph ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿæ—¶çš„æ–‡ä»¶ç³»ç»Ÿæ ‡è¯†ç¬¦ã€‚ç°åœ¨ï¼Œ Ceph è¿˜æ”¯æŒåŸç”Ÿæ¥å£ã€å—è®¾å¤‡ã€å’Œå¯¹è±¡å­˜å‚¨ç½‘å…³æ¥å£ï¼Œæ‰€ä»¥ <code>fsid</code> æœ‰ç‚¹åä¸ç¬¦å®äº†ã€‚</p>
<p><strong>é›†ç¾¤åç§°ï¼š</strong> æ¯ä¸ª Ceph é›†ç¾¤éƒ½æœ‰è‡ªå·±çš„åå­—ï¼Œå®ƒæ˜¯ä¸ªä¸å«ç©ºæ ¼çš„å­—ç¬¦ä¸²ã€‚é»˜è®¤åå­—æ˜¯ <code>ceph</code> ã€ä½†ä½ å¯ä»¥æ›´æ”¹ï¼›å°¤å…¶æ˜¯è¿è¥ç€å¤šä¸ªé›†ç¾¤æ—¶ï¼Œéœ€è¦ç”¨åå­—æ¥åŒºåˆ†è¦æ“ä½œå“ªä¸€ä¸ªã€‚æ¯”å¦‚ï¼Œå½“ä½ ä»¥<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/radosgw/federated-config">è”ç›Ÿæ¶æ„</a>è¿è¥å¤šä¸ªé›†ç¾¤æ—¶ï¼Œé›†ç¾¤åå­—ï¼ˆå¦‚ <code>us-west</code> ã€ <code>us-east</code> ï¼‰å°†ä½œä¸ºæ ‡è¯†ç¬¦å‡ºç°åœ¨ CLI ç•Œé¢ä¸Šã€‚<strong>æ³¨æ„ï¼š</strong>è¦åœ¨å‘½ä»¤è¡Œä¸‹æŒ‡å®šæŸä¸ªé›†ç¾¤ï¼Œå¯ä»¥æŒ‡å®šä»¥é›†ç¾¤åä¸ºå‰ç¼€çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>ceph.conf</code> ã€ <code>us-west.conf</code> ã€ <code>us-east.conf</code> ç­‰ï¼‰ï¼›ä¹Ÿå¯ä»¥å‚è€ƒ CLI ç”¨æ³•ï¼ˆ <code>ceph --cluster &#123;cluster-name&#125;</code> ï¼‰ã€‚</p>
<p><strong>ç›‘è§†å™¨åå­—ï¼š</strong> åŒä¸€é›†ç¾¤å†…çš„å„ç›‘è§†å™¨ä¾‹ç¨‹éƒ½æœ‰æƒŸä¸€çš„åå­—ï¼Œé€šå¸¸éƒ½ç”¨ä¸»æœºåä½œä¸ºç›‘è§†å™¨åå­—ï¼ˆæˆ‘ä»¬å»ºè®®æ¯å°ä¸»æœºåªè¿è¡Œä¸€ä¸ªç›‘è§†å™¨ã€å¹¶ä¸”ä¸è¦ä¸ OSD ä¸»æœºå¤ç”¨ã€‚çŸ­ä¸»æœºåå¯ä»¥ç”¨ <code>hostname -s</code> è·å–ã€‚</p>
<p><strong>ç›‘è§†å™¨å›¾ï¼š</strong> è‡ªä¸¾å¼•å¯¼åˆå§‹ç›‘è§†å™¨éœ€è¦ç”Ÿæˆç›‘è§†å™¨å›¾ï¼Œä¸ºæ­¤ï¼Œéœ€è¦æœ‰ <code>fsid</code> ã€é›†ç¾¤åï¼ˆæˆ–ç”¨é»˜è®¤ï¼‰ã€è‡³å°‘ä¸€ä¸ªä¸»æœºååŠå…¶ IP ã€‚</p>
<p><strong>ç›‘è§†å™¨å¯†é’¥ç¯ï¼š</strong> ç›‘è§†å™¨ä¹‹é—´é€šè¿‡å¯†é’¥é€šè®¯ï¼Œæ‰€ä»¥ä½ å¿…é¡»æŠŠç›‘è§†å™¨å¯†é’¥åŠ å…¥å¯†é’¥ç¯ï¼Œå¹¶åœ¨è‡ªä¸¾å¼•å¯¼æ—¶æä¾›ã€‚</p>
<p><strong>ç®¡ç†å¯†é’¥ç¯ï¼š</strong> è¦ä½¿ç”¨ <code>ceph</code> è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä½ å¿…é¡»æœ‰ <code>client.admin</code> ç”¨æˆ·ï¼Œæ‰€ä»¥ä½ è¦åˆ›å»ºæ­¤ç”¨æˆ·åŠå…¶å¯†é’¥ï¼Œå¹¶æŠŠä»–ä»¬åŠ å…¥å¯†é’¥ç¯ã€‚</p>
<p>å…³äºåˆå§‹åŒ–çš„å…·ä½“ä¿¡æ¯è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/dev/mon-bootstrap">åˆå§‹åŒ–ç›‘è§†å™¨</a>ã€‚</p>
<pre><code class="hljs angelscript">[mon]
        mon host = hostname1,hostname2,hostname3
        mon addr = <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.10</span>:<span class="hljs-number">6789</span>,<span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.11</span>:<span class="hljs-number">6789</span>,<span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.12</span>:<span class="hljs-number">6789</span></code></pre>
<h3 id="åˆå§‹æˆå‘˜"><a href="#åˆå§‹æˆå‘˜" class="headerlink" title="åˆå§‹æˆå‘˜"></a>åˆå§‹æˆå‘˜</h3><p>æˆ‘ä»¬å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹æœ€å°‘éƒ¨ç½² 3 ä¸ªç›‘è§†å™¨ï¼Œä»¥ç¡®ä¿é«˜å¯ç”¨æ€§ã€‚è¿è¡Œå¤šä¸ªç›‘è§†å™¨æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šä¸ºå½¢æˆæ³•å®šäººæ•°æˆå‘˜æ‰€éœ€çš„åˆå§‹ç›‘è§†å™¨ï¼Œè¿™èƒ½å‡å°é›†ç¾¤ä¸Šçº¿æ—¶é—´ã€‚</p>
<pre><code class="hljs csharp">[<span class="hljs-meta">mon</span>]
        mon initial members = a,b,c</code></pre>
<div class="note note-primary">
            <p>Ceph éœ€è¦å¥‡æ•°ä¸ªç›‘è§†å™¨æ¥ç¡®å®šæœ€åˆæ³•å®šäººæ•°ï¼ˆå¦‚ 3 ï¼‰ã€‚</p>
          </div>
<h3 id="æ•°æ®"><a href="#æ•°æ®" class="headerlink" title="æ•°æ®"></a>æ•°æ®</h3><p>Ceph ç›‘è§†å™¨æœ‰å­˜å‚¨æ•°æ®çš„é»˜è®¤è·¯å¾„ï¼Œç”Ÿäº§é›†ç¾¤ä¸ºå®ç°æ›´é«˜æ€§èƒ½å¯æŠŠç›‘è§†å™¨éƒ¨ç½²åˆ°é OSD èŠ‚ç‚¹çš„ç‹¬ç«‹ä¸»æœºä¸Šã€‚å› ä¸ºç›‘è§†å™¨ä¼šé¢‘ç¹ <code>fsync()</code> ï¼Œè¿™å¯èƒ½å½±å“ OSD ã€‚</p>
<h3 id="å­˜å‚¨å®¹é‡"><a href="#å­˜å‚¨å®¹é‡" class="headerlink" title="å­˜å‚¨å®¹é‡"></a>å­˜å‚¨å®¹é‡</h3><p>Ceph å­˜å‚¨é›†ç¾¤åˆ©ç”¨ç‡æ¥è¿‘æœ€å¤§å®¹é‡æ—¶ï¼ˆå³ <code>mon osd full ratio</code> ï¼‰ï¼Œä½œä¸ºé˜²æ­¢æ•°æ®ä¸¢å¤±çš„å®‰å…¨æªæ–½ï¼Œå®ƒä¼šé˜»æ­¢ä½ è¯»å†™ OSD ã€‚å› æ­¤ï¼Œè®©ç”Ÿäº§é›†ç¾¤ç”¨æ»¡å¯ä¸æ˜¯å¥½äº‹ï¼Œå› ä¸ºç‰ºç‰²äº†é«˜å¯ç”¨æ€§ã€‚ full ratio é»˜è®¤å€¼æ˜¯ <code>.95</code> æˆ–å®¹é‡çš„ 95% ã€‚å¯¹å°å‹æµ‹è¯•é›†ç¾¤æ¥è¯´è¿™æ˜¯éå¸¸æ¿€è¿›çš„è®¾ç½®ã€‚</p>
<div class="note note-primary">
            <p>ç›‘æ§é›†ç¾¤æ—¶ï¼Œè¦è­¦æƒ•å’Œ <code>nearfull</code> ç›¸å…³çš„è­¦å‘Šã€‚è¿™æ„å‘³ç€ä¸€äº› OSD çš„å¤±è´¥ä¼šå¯¼è‡´ä¸´æ—¶æœåŠ¡ä¸­æ–­ï¼Œåº”è¯¥å¢åŠ ä¸€äº› OSD æ¥æ‰©å±•å­˜å‚¨å®¹é‡ã€‚</p>
          </div>
<p>åœ¨æµ‹è¯•é›†ç¾¤æ—¶ï¼Œä¸€ä¸ªå¸¸è§åœºæ™¯æ˜¯ï¼šç³»ç»Ÿç®¡ç†å‘˜ä»é›†ç¾¤åˆ é™¤ä¸€ä¸ª OSD ã€æ¥ç€è§‚å¯Ÿé‡å‡è¡¡ï¼›ç„¶åç»§ç»­åˆ é™¤å…¶ä»– OSD ï¼Œç›´åˆ°é›†ç¾¤è¾¾åˆ°å æ»¡ç‡å¹¶é”æ­»ã€‚æˆ‘ä»¬å»ºè®®ï¼Œå³ä½¿åœ¨æµ‹è¯•é›†ç¾¤é‡Œä¹Ÿè¦è§„åˆ’ä¸€ç‚¹ç©ºé—²å®¹é‡ç”¨äºä¿è¯é«˜å¯ç”¨æ€§ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œè¦åšå¥½è¿™æ ·çš„é¢„æ¡ˆï¼šä¸€ç³»åˆ— OSD å¤±è´¥åï¼ŒçŸ­æ—¶é—´å†…ä¸æ›´æ¢å®ƒä»¬ä»èƒ½æ¢å¤åˆ° <code>active + clean</code> çŠ¶æ€ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ <code>active + degraded</code> çŠ¶æ€è¿è¡Œé›†ç¾¤ï¼Œä½†å¯¹æ­£å¸¸ä½¿ç”¨æ¥è¯´å¹¶ä¸å¥½ã€‚æ‰¾å‡ºä½ é›†ç¾¤çš„ä¸¤ä¸ªæ•°å­—ï¼š</p>
<ol>
<li>OSD æ•°é‡ã€‚</li>
<li>é›†ç¾¤æ€»å®¹é‡</li>
</ol>
<p>ç”¨é›†ç¾¤é‡Œ OSD æ€»æ•°é™¤ä»¥é›†ç¾¤æ€»å®¹é‡ï¼Œå°±èƒ½å¾—åˆ° OSD å¹³å‡å®¹é‡ï¼›å¦‚æœæŒ‰é¢„è®¡çš„ OSD æ•°ä¹˜ä»¥è¿™ä¸ªå€¼æ‰€å¾—çš„ç»“æœè®¡ç®—ï¼ˆåå°ï¼‰ï¼Œå®é™…åº”ç”¨æ—¶å°†å‡ºé”™ï¼›æœ€åå†ç”¨é›†ç¾¤å®¹é‡ä¹˜ä»¥å æ»¡ç‡èƒ½å¾—åˆ°æœ€å¤§è¿è¡Œå®¹é‡ï¼Œç„¶åæ‰£é™¤é¢„ä¼°çš„ OSD å¤±è´¥ç‡ï¼›ç”¨è¾ƒé«˜çš„å¤±è´¥ç‡ï¼ˆå¦‚æ•´æœºæ¶çš„ OSD ï¼‰é‡å¤å‰è¿°è¿‡ç¨‹çœ‹æ˜¯å¦æ¥è¿‘å æ»¡ç‡ã€‚</p>
<pre><code class="hljs jboss-cli">[global]
		<span class="hljs-comment"># åœ¨OSDconsidered fullä¹‹å‰çš„ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡</span>
		mon osd full ratio = <span class="hljs-string">.80</span>
	    <span class="hljs-comment"># OSD ç¡¬ç›˜ä½¿ç”¨ç‡è¾¾åˆ°å¤šå°‘å°±è®¤ä¸ºå®ƒ full ã€‚</span>
        mon osd full ratio = <span class="hljs-string">.80</span>
        <span class="hljs-comment">#	OSD ç¡¬ç›˜ä½¿ç”¨ç‡è¾¾åˆ°å¤šå°‘å°±è®¤ä¸ºå®ƒ nearfull ã€‚</span>
        mon osd nearfull ratio = <span class="hljs-string">.70</span></code></pre>
<div class="note note-primary">
            <p>å¦‚æœä¸€äº› OSD å¿«æ»¡äº†ï¼Œä½†å…¶ä»–çš„ä»æœ‰è¶³å¤Ÿç©ºé—´ï¼Œä½ å¯èƒ½é…é”™ CRUSH æƒé‡äº†ã€‚</p>
          </div>
<h3 id="å¿ƒè·³"><a href="#å¿ƒè·³" class="headerlink" title="å¿ƒè·³"></a>å¿ƒè·³</h3><p>Ceph ç›‘è§†å™¨è¦æ±‚å„ OSD å‘å®ƒæŠ¥å‘Šã€å¹¶æ¥æ”¶ OSD ä»¬çš„é‚»å±…çŠ¶æ€æŠ¥å‘Šï¼Œä»¥æ­¤æ¥æŒæ¡é›†ç¾¤ã€‚ Ceph æä¾›äº†ç›‘è§†å™¨ä¸ OSD äº¤äº’çš„åˆç†é»˜è®¤å€¼ï¼Œç„¶è€Œä½ å¯ä»¥æŒ‰éœ€ä¿®æ”¹ï¼Œè¯¦æƒ…è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/mon-osd-interaction">ç›‘è§†å™¨ä¸ OSD çš„äº¤äº’</a>ã€‚</p>
<h3 id="ç›‘è§†å™¨å­˜å‚¨åŒæ­¥"><a href="#ç›‘è§†å™¨å­˜å‚¨åŒæ­¥" class="headerlink" title="ç›‘è§†å™¨å­˜å‚¨åŒæ­¥"></a>ç›‘è§†å™¨å­˜å‚¨åŒæ­¥</h3><p>å½“ä½ ç”¨å¤šä¸ªç›‘è§†å™¨æ”¯æ’‘ä¸€ä¸ªç”Ÿäº§é›†ç¾¤æ—¶ï¼Œå„ç›‘è§†å™¨éƒ½è¦æ£€æŸ¥é‚»å±…æ˜¯å¦æœ‰é›†ç¾¤è¿è¡Œå›¾çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆå¦‚ï¼Œé‚»å±…ç›‘è§†å™¨çš„å›¾æœ‰ä¸€æˆ–å¤šä¸ª epoch ç‰ˆæœ¬é«˜äºå½“å‰ç›‘è§†å™¨çš„æœ€é«˜ç‰ˆ epoch ï¼‰ï¼Œè¿‡ä¸€æ®µæ—¶é—´ï¼Œé›†ç¾¤é‡Œçš„æŸä¸ªç›‘è§†å™¨å¯èƒ½è½åäºå…¶å®ƒç›‘è§†å™¨å¤ªå¤šè€Œä¸å¾—ä¸ç¦»å¼€æ³•å®šäººæ•°ï¼Œç„¶ååŒæ­¥åˆ°é›†ç¾¤å½“å‰çŠ¶æ€ï¼Œå¹¶é‡å›æ³•å®šäººæ•°ã€‚ä¸ºäº†åŒæ­¥ï¼Œç›‘è§†å™¨å¯èƒ½æ‰¿æ‹…ä¸‰ç§ä¸­çš„ä¸€ç§è§’è‰²ï¼š</p>
<ol>
<li><strong>Leader</strong>: Leader æ˜¯å®ç°æœ€æ–° Paxos ç‰ˆæœ¬çš„ç¬¬ä¸€ä¸ªç›‘è§†å™¨ã€‚</li>
<li><strong>Provider</strong>: Provider æœ‰æœ€æ–°é›†ç¾¤è¿è¡Œå›¾çš„ç›‘è§†å™¨ï¼Œä½†ä¸æ˜¯ç¬¬ä¸€ä¸ªå®ç°æœ€æ–°ç‰ˆã€‚</li>
<li><strong>Requester:</strong> Requester è½åäº leader ï¼Œé‡å›æ³•å®šäººæ•°å‰ï¼Œå¿…é¡»åŒæ­¥ä»¥è·å–å…³äºé›†ç¾¤çš„æœ€æ–°ä¿¡æ¯ã€‚</li>
</ol>
<p>æœ‰äº†è¿™äº›è§’è‰²åŒºåˆ†ï¼Œ leaderå°± å¯ä»¥ç»™ provider å§”æ´¾åŒæ­¥ä»»åŠ¡ï¼Œè¿™ä¼šé¿å…åŒæ­¥è¯·æ±‚å‹å® leader ã€å½±å“æ€§èƒ½ã€‚åœ¨ä¸‹é¢çš„å›¾ç¤ºä¸­ï¼Œ requester å·²ç»çŸ¥é“å®ƒè½åäºå…¶å®ƒç›‘è§†å™¨ï¼Œç„¶åå‘ leader è¯·æ±‚åŒæ­¥ï¼Œ leader è®©å®ƒå»å’Œ provider åŒæ­¥ã€‚</p>
<hr>
<p><img src="\img\ceph-mon2.png" srcset="/img/loading.gif" alt="img"></p>
<p>ä¸€æ—¦åŒæ­¥å®Œæˆï¼Œ Ceph éœ€è¦ä¿®å¤æ•´ä¸ªé›†ç¾¤ï¼Œä½¿å½’ç½®ç»„å›åˆ° <code>active + clean</code> çŠ¶æ€ã€‚</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Parameters</th>
<th>Descrip.</th>
<th>Type</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>mon sync timeout</td>
<td>Number of seconds the monitor will wait for the next update message from its sync provider before it gives up and bootstrap again.</td>
<td>Double</td>
<td>60.0</td>
</tr>
<tr>
<td>mon sync max payload size</td>
<td>The maximum size for a sync payload (in bytes).</td>
<td>32-bit Integer</td>
<td>1048576</td>
</tr>
<tr>
<td>paxos max join drift</td>
<td>The maximum Paxos iterations before we must first sync the monitor data stores. When a monitor finds that its peer is too far ahead of it, it will first sync with data stores before moving on.</td>
<td>Integer</td>
<td>10</td>
</tr>
<tr>
<td>paxos stash full interval</td>
<td>How often (in commits) to stash a full copy of the PaxosService state. Current this setting only affects <code>mds</code>, <code>mon</code>, <code>auth</code> and <code>mgr</code> PaxosServices.</td>
<td>Integer</td>
<td>25</td>
</tr>
<tr>
<td>paxos propose interval</td>
<td>Gather updates for this time interval before proposing a map update.</td>
<td>Double</td>
<td>1.0</td>
</tr>
<tr>
<td>paxos min</td>
<td>The minimum number of paxos states to keep around</td>
<td>Integer</td>
<td>500</td>
</tr>
<tr>
<td>paxos min wait</td>
<td>The minimum amount of time to gather updates after a period of inactivity.</td>
<td>Double</td>
<td>0.05</td>
</tr>
<tr>
<td>paxos trim min</td>
<td>Number of extra proposals tolerated before trimming</td>
<td>Integer</td>
<td>250</td>
</tr>
<tr>
<td>paxos trim max</td>
<td>The maximum number of extra proposals to trim at a time</td>
<td>Integer</td>
<td>500</td>
</tr>
<tr>
<td>paxos service trim min</td>
<td>The minimum amount of versions to trigger a trim (0 disables it)</td>
<td>Integer</td>
<td>250</td>
</tr>
<tr>
<td>paxos service trim max</td>
<td>The maximum amount of versions to trim during a single proposal (0 disables it)</td>
<td>Integer</td>
<td>500</td>
</tr>
<tr>
<td>mon mds force trim to</td>
<td>Force monitor to trim mdsmaps to this point (0 disables it. dangerous, use with care)</td>
<td>Integer</td>
<td>0</td>
</tr>
<tr>
<td>mon osd force trim to</td>
<td>Force monitor to trim osdmaps to this point, even if there is PGs not clean at the specified epoch (0 disables it. dangerous, use with care)</td>
<td>Integer</td>
<td>0</td>
</tr>
<tr>
<td>mon osd cache size</td>
<td>The size of osdmaps cache, not to rely on underlying storeâ€™s cache</td>
<td>Integer</td>
<td>500</td>
</tr>
<tr>
<td>mon election timeout</td>
<td>On election proposer, maximum waiting time for all ACKs in seconds.</td>
<td>Float</td>
<td>5.00</td>
</tr>
<tr>
<td>mon lease</td>
<td>The length (in seconds) of the lease on the monitorâ€™s versions.</td>
<td>Float</td>
<td>5.00</td>
</tr>
<tr>
<td>mon lease renew interval factor</td>
<td><code>mon lease</code> * <code>mon lease renew interval factor</code> will be the interval for the Leader to renew the other monitorâ€™s leases. The factor should be less than <code>1.0</code>.</td>
<td>Float</td>
<td>0.60</td>
</tr>
<tr>
<td>mon lease ack timeout factor</td>
<td>The Leader will wait <code>mon lease</code> * <code>mon lease ack timeout factor</code> for the Providers to acknowledge the lease extension.</td>
<td>Float</td>
<td>2.00</td>
</tr>
<tr>
<td>mon accept timeout factor</td>
<td>The Leader will wait <code>mon lease</code> * <code>mon accept timeout factor</code> for the Requester(s) to accept a Paxos update. It is also used during the Paxos recovery phase for similar purposes.</td>
<td>Float</td>
<td>2.00</td>
</tr>
<tr>
<td>mon min osdmap epochs</td>
<td>Minimum number of OSD map epochs to keep at all times.</td>
<td>32-bit Integer</td>
<td>500</td>
</tr>
<tr>
<td>mon max log epochs</td>
<td>Maximum number of Log epochs the monitor should keep.</td>
<td>32-bit Integer</td>
<td>500</td>
</tr>
</tbody>
</table>
</div>
<h3 id="æ—¶é’Ÿ"><a href="#æ—¶é’Ÿ" class="headerlink" title="æ—¶é’Ÿ"></a>æ—¶é’Ÿ</h3><p>Ceph çš„å®ˆæŠ¤è¿›ç¨‹ä¼šç›¸äº’ä¼ é€’å…³é”®æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯å¿…é¡»åœ¨è¾¾åˆ°è¶…æ—¶é˜€å€¼å‰å¤„ç†æ‰ã€‚å¦‚æœ Ceph ç›‘è§†å™¨æ—¶é’Ÿä¸åŒæ­¥ï¼Œå°±å¯èƒ½å‡ºç°å¤šç§å¼‚å¸¸æƒ…å†µã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>å®ˆæŠ¤è¿›ç¨‹å¿½ç•¥äº†æ”¶åˆ°çš„æ¶ˆæ¯ï¼ˆå¦‚æ—¶é—´æˆ³è¿‡æ—¶äº†ï¼‰</li>
<li>æ¶ˆæ¯æœªåŠæ—¶æ”¶åˆ°æ—¶ï¼Œè¶…æ—¶è§¦å‘å¾—å¤ªå¿«æˆ–å¤ªæ™šã€‚</li>
</ul>
<p>è¯¦æƒ…è§<a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/mon-config-ref/#id13">ç›‘è§†å™¨å­˜å‚¨åŒæ­¥</a>å’Œ <a target="_blank" rel="noopener" href="http://docs.ceph.org.cn/rados/configuration/mon-config-ref/#slurp">Slurp</a> ã€‚</p>
<p>ä¸ºäº†é¿å…å®é™…æ¼‚ç§»å»ºè®®å®‰è£…<code>NTP</code></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Parameters</th>
<th>Descrip.</th>
<th>Type</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>mon tick interval</td>
<td>A monitorâ€™s tick interval in seconds.</td>
<td>32-bit Integer</td>
<td>5</td>
</tr>
<tr>
<td>mon clock drift allowed</td>
<td>The clock drift in seconds allowed between monitors.</td>
<td>Float</td>
<td>0.05</td>
</tr>
<tr>
<td>mon clock drift warn backoff</td>
<td>Exponential backoff for clock drift warnings</td>
<td>Float</td>
<td>5.00</td>
</tr>
<tr>
<td>mon timecheck interval</td>
<td>The time check interval (clock drift check) in seconds for the Leader.</td>
<td>Float</td>
<td>300.0</td>
</tr>
<tr>
<td>mon timecheck skew interval</td>
<td>The time check interval (clock drift check) in seconds when in presence of a skew in seconds for the Leader.</td>
<td>Float</td>
<td>30.0</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><h2 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h2></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>Parameters</th>
<th>Descrip.</th>
<th>Type</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>mon client hunt interval</td>
<td>The client will try a new monitor every <code>N</code> seconds until it establishes a connection.</td>
<td>Double</td>
<td>3.00</td>
</tr>
<tr>
<td>mon client ping interval</td>
<td>The client will ping the monitor every <code>N</code> seconds.</td>
<td>Double</td>
<td>10.00</td>
</tr>
<tr>
<td>mon client max log entries per message</td>
<td>The maximum number of log entries a monitor will generate per client message.</td>
<td>Integer</td>
<td>1000</td>
</tr>
<tr>
<td>mon client bytes</td>
<td>The amount of client message data allowed in memory (in bytes).</td>
<td>64-bit Integer Unsigned</td>
<td>100ul &lt;&lt; 20</td>
</tr>
</tbody>
</table>
</div>
<h2 id="Pool-Settings"><a href="#Pool-Settings" class="headerlink" title="Pool Settings"></a>Pool Settings</h2><div class="table-container">
<table>
<thead>
<tr>
<th>Parameters</th>
<th>Descrip.</th>
<th>Type</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>mon allow pool delete</td>
<td>If the monitors should allow pools to be removed. Regardless of what the pool flags say.</td>
<td>Boolean</td>
<td>false</td>
</tr>
<tr>
<td>osd pool default ec fast read</td>
<td>Whether to turn on fast read on the pool or not. It will be used as the default setting of newly created erasure coded pools if <code>fast_read</code> is not specified at create time.</td>
<td>Boolean</td>
<td>false</td>
</tr>
<tr>
<td>osd pool default flag hashpspool</td>
<td>Set the hashpspool flag on new pools</td>
<td>Boolean</td>
<td>true</td>
</tr>
<tr>
<td>osd pool default flag nodelete</td>
<td>Set the nodelete flag on new pools. Prevents allow pool removal with this flag in any way.</td>
<td>Boolean</td>
<td>false</td>
</tr>
<tr>
<td>osd pool default flag nopgchange</td>
<td>Set the nopgchange flag on new pools. Does not allow the number of PGs to be changed for a pool.</td>
<td>Boolean</td>
<td>false</td>
</tr>
<tr>
<td>osd pool default flag nosizechange</td>
<td>Set the nosizechange flag on new pools. Does not allow the size to be changed of pool.</td>
<td>Boolean</td>
<td>false</td>
</tr>
</tbody>
</table>
</div>
<p>For more information about the pool flags see <a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/rados/operations/pools/#set-pool-values">Pool values</a>.</p>
<hr>
<h2 id="MiscellaneousÂ¶"><a href="#MiscellaneousÂ¶" class="headerlink" title="MiscellaneousÂ¶"></a>Miscellaneous<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/rados/configuration/mon-config-ref/#miscellaneous">Â¶</a></h2><p>Please clickâ€¦ the link icon.</p>
<h2 id="æ–‡æ¡£ç¼–è¯‘"><a href="#æ–‡æ¡£ç¼–è¯‘" class="headerlink" title="æ–‡æ¡£ç¼–è¯‘"></a>æ–‡æ¡£ç¼–è¯‘</h2><p>å®‰è£…å’Œä½¿ç”¨</p>
<pre><code class="hljs sql">sudo apt-get <span class="hljs-keyword">install</span> cat doc_deps.deb.txt
<span class="hljs-keyword">admin</span>/<span class="hljs-keyword">build</span>-doc</code></pre>
<hr>
<h2 id="åŠ é€Ÿæœ¬åœ°ç¼–è¯‘"><a href="#åŠ é€Ÿæœ¬åœ°ç¼–è¯‘" class="headerlink" title="åŠ é€Ÿæœ¬åœ°ç¼–è¯‘"></a>åŠ é€Ÿæœ¬åœ°ç¼–è¯‘</h2><p><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/dev/developer_guide/essentials/#using-ccache-to-speed-up-local-builds">https://docs.ceph.com/en/latest/dev/developer_guide/essentials/#using-ccache-to-speed-up-local-builds</a></p>
<h1 id="ä¸ºcephç¤¾åŒºåšå‡ºè‡ªå·±çš„è´¡çŒ®"><a href="#ä¸ºcephç¤¾åŒºåšå‡ºè‡ªå·±çš„è´¡çŒ®" class="headerlink" title="ä¸ºcephç¤¾åŒºåšå‡ºè‡ªå·±çš„è´¡çŒ®"></a>ä¸ºcephç¤¾åŒºåšå‡ºè‡ªå·±çš„è´¡çŒ®</h1><p>Mailing list</p>
<p>The <code>dev@ceph.io</code> list is for discussion about the development of Ceph, its interoperability with other technology, and the operations of the project itself. Subscribe by sending a message to <code>dev-request@ceph.io</code> with the line:</p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">subscribe ceph-devel</span></code></pre>
<p>in the body of the message.</p>
<p>The <a href="mailto:ceph-devel%40vger.kernel.org">ceph-devel@vger.kernel.org</a> list is for discussion and patch review for the Linux kernel Ceph client component. Subscribe by sending a message to <code>majordomo@vger.kernel.org</code> with the line:</p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">subscribe ceph-devel</span></code></pre>
<p>in the body of the message.</p>
<hr>
<h1 id="Trouble-Shooting-Runtime"><a href="#Trouble-Shooting-Runtime" class="headerlink" title="Trouble Shooting: Runtime"></a>Trouble Shooting: Runtime</h1><pre><code class="hljs apache"><span class="hljs-attribute">2015</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">23</span>:<span class="hljs-number">47</span>.<span class="hljs-number">856064</span> <span class="hljs-number">7</span>f<span class="hljs-number">4</span>a<span class="hljs-number">5</span>a<span class="hljs-number">36</span>a<span class="hljs-number">7</span>a<span class="hljs-number">0</span> -<span class="hljs-number">1</span> accepter.accepter.bind unable to bind to <span class="hljs-number">101.67.163.20:6789</span>: (<span class="hljs-number">99</span>) Cannot assign requested address
<span class="hljs-attribute">2015</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">23</span>:<span class="hljs-number">47</span>.<span class="hljs-number">856085</span> <span class="hljs-number">7</span>f<span class="hljs-number">4</span>a<span class="hljs-number">5</span>a<span class="hljs-number">36</span>a<span class="hljs-number">7</span>a<span class="hljs-number">0</span> -<span class="hljs-number">1</span> accepter.accepter.bind was unable to bind. Trying again in <span class="hljs-number">5</span> seconds
<span class="hljs-attribute">2015</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">23</span>:<span class="hljs-number">52</span>.<span class="hljs-number">856281</span> <span class="hljs-number">7</span>f<span class="hljs-number">4</span>a<span class="hljs-number">5</span>a<span class="hljs-number">36</span>a<span class="hljs-number">7</span>a<span class="hljs-number">0</span> -<span class="hljs-number">1</span> accepter.accepter.bind unable to bind to <span class="hljs-number">101.67.163.20:6789</span>: (<span class="hljs-number">99</span>) Cannot assign requested address
<span class="hljs-attribute">2015</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">23</span>:<span class="hljs-number">52</span>.<span class="hljs-number">856319</span> <span class="hljs-number">7</span>f<span class="hljs-number">4</span>a<span class="hljs-number">5</span>a<span class="hljs-number">36</span>a<span class="hljs-number">7</span>a<span class="hljs-number">0</span> -<span class="hljs-number">1</span> accepter.accepter.bind was unable to bind. Trying again in <span class="hljs-number">5</span> seconds
<span class="hljs-attribute">2015</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">23</span>:<span class="hljs-number">57</span>.<span class="hljs-number">856622</span> <span class="hljs-number">7</span>f<span class="hljs-number">4</span>a<span class="hljs-number">5</span>a<span class="hljs-number">36</span>a<span class="hljs-number">7</span>a<span class="hljs-number">0</span> -<span class="hljs-number">1</span> accepter.accepter.bind unable to bind to <span class="hljs-number">101.67.163.20:6789</span>: (<span class="hljs-number">99</span>) Cannot assign requested address
<span class="hljs-attribute">2015</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">23</span>:<span class="hljs-number">57</span>.<span class="hljs-number">856657</span> <span class="hljs-number">7</span>f<span class="hljs-number">4</span>a<span class="hljs-number">5</span>a<span class="hljs-number">36</span>a<span class="hljs-number">7</span>a<span class="hljs-number">0</span> -<span class="hljs-number">1</span> accepter.accepter.bind was unable to bind after <span class="hljs-number">3</span> attempts: (<span class="hljs-number">99</span>) Cannot assign requested address
<span class="hljs-attribute">2015</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">23</span>:<span class="hljs-number">57</span>.<span class="hljs-number">856670</span> <span class="hljs-number">7</span>f<span class="hljs-number">4</span>a<span class="hljs-number">5</span>a<span class="hljs-number">36</span>a<span class="hljs-number">7</span>a<span class="hljs-number">0</span> -<span class="hljs-number">1</span> unable to bind monitor to <span class="hljs-number">101.67.163.20:6789</span>/<span class="hljs-number">0</span>
<span class="hljs-attribute">failed</span>: &#x27;ssh ceph-<span class="hljs-number">10</span> ulimit -n <span class="hljs-number">32768</span>;  /usr/bin/ceph-mon -i a --pid-file /var/run/ceph/mon.a.pid -c /etc/ceph/ceph.conf --cluster ceph &#x27;
</code></pre>
<p>è¿™æ˜¯ç”±äºipåœ°å€æ›´æ¢çš„åŸå› ï¼Œæ£€æŸ¥ä¸€ä¸‹ã€‚</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/ceph/">ceph</a>
                    
                      <a class="hover-with-bg" href="/categories/ceph/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/">åˆ†å¸ƒå¼å­˜å‚¨</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/">ç³»ç»Ÿæ¶æ„</a>
                    
                      <a class="hover-with-bg" href="/tags/ceph/">ceph</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/10/24/CMake%20%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Cmakeå­¦ä¹ </span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/10/18/VIMdict/">
                        <span class="hidden-mobile">VIMå‘½ä»¤æŸ¥è¯¢</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    function loadValine() {
      addScript('https://cdn.staticfile.org/valine/1.4.14/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "8oX7VCxy9tyFQIvF8qwLorP0-gzGzoHsz",
          app_key: "F0939INl4cKXpCw2HgTIUb6B",
          placeholder: "è¯´ç‚¹ä»€ä¹ˆ,ï¼ˆæ”¯æŒMarkdownï¼‰",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: false,
          recordIP: false,
          serverURLs: "https://8ox7vcxy.lc-cn-n1-shared.com",
        });
      });
    }
    waitElementVisible('vcomments', loadValine);
  </script>
  <noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments
      powered by Valine.</a></noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "ã€æ¨èã€‘Cephæ‰‹åŠ¨é…ç½®é›†ç¾¤éƒ¨ç½²&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  








  <script  src="https://cdn.staticfile.org/mermaid/8.5.0/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>




  

  

  

  

  

  





<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!--<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>
</html>
